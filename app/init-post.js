/**
 * @license SmartBuilder4 HTML5 widget framework, Copyright (c) 2014
 *          SuddenlySmart;
 * @author Kent Xu
 */

/*!
 * jQuery UI Effects 1.11.2
 * http://jqueryui.com
 *
 * Copyright 2014 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/category/effects-core/
 */

/*!
 * jQuery Color Animations v2.1.2
 * https://github.com/jquery/jquery-color
 *
 * Copyright 2014 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * Date: Wed Jan 16 08:47:09 2013 -0600
 */

/**
 * @license SmartBuilder4 HTML5 widget framework, Copyright (c) 2014 SuddenlySmart;
 * @author Kent Xu
 */

/**
 * @license SmartBuilder4 HTML5 widget framework, Copyright (c) 2014 SuddenlySmart;
 * @author Kent Xu
 * SlideSet
 */

/**
 * @license SmartBuilder4 HTML5 widget framework, Copyright (c) 2014 SuddenlySmart;
 * @author Kent Xu
 * Slide
 */

/**
 * jquery.timer.js
 *
 * Copyright (c) 2011 Jason Chavannes <jason.chavannes@gmail.com>
 *
 * http://jchavannes.com/jquery-timer
 *
 * Permission is hereby granted, free of charge, to any person
 * obtaining a copy of this software and associated documentation
 * files (the "Software"), to deal in the Software without
 * restriction, including without limitation the rights to use, copy,
 * modify, merge, publish, distribute, sublicense, and/or sell copies
 * of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
 * BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
 * ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
 * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */

define("sb4core/sbobjfactory",["./DataUtil","jquery","underscore","jqueryui/widget","util/jquery-color"],function(t,e,i){function s(t){this.engine=t}return s.prototype.create=function(t,e,i){this.div=t,this.data=e;var s=this._createObj(t,e,i);return s},s.prototype._createObj=function(t,e,i){var s=e.eClass,r=null;return"http://axon.smartbuilder.com/model/lo#//Frame"==s?r=this._createFrame(t,e,i):"http://axon.smartbuilder.com/model/lo#//SlideSet"==s?r=this._createSlideSet(t,e,i):"http://axon.smartbuilder.com/model/lo#//Slide"==s?r=this._createSlide(t,e,i):"http://axon.smartbuilder.com/model/lo#//Widget"==s&&(r=this._createWidget(t,e,i)),null!=r&&this.engine.objctx.add(e.id,r.data("sb4-"+r.data("sb4type"))),r},s.prototype._createFrame=function(t,e,i){var s,r={_p:null==i?null:i.data("sb4-"+i.data("sb4type"))};this._parseBaseOptions(e,r),this._parseBounds(e.bounds,r);var n="com.smartbuilder.axon.widget.frame";return this._parseDataEntries(e.data,r),s=this._createSBObj(t,n,r)},s.prototype._createSlide=function(t,e,i){var s=void 0,r={_p:null==i?null:i.data("sb4-"+i.data("sb4type"))};this._parseBaseOptions(e,r);var n="com.smartbuilder.axon.widget.slide";e.type=n,s=this._createSBObj(t,n,r);var o=e.widgets;for(var a in o){var l=this._createObjDiv(t),h=this._createObj(l,o[a],s);this._activateObjDiv(l,void 0!=h)}return s},s.prototype._createSlideSet=function(e,i,s){var r=void 0,n={_p:null==s?null:s.data("sb4-"+s.data("sb4type"))};this._parseBaseOptions(i,n),void 0!=i.mode?n.mode=i.mode:(n.mode=t.getInt(i.type,0),i.mode=n.mode);var o="com.smartbuilder.axon.widget.slideset";i.type=o,r=this._createSBObj(e,o,n);var a=i.slides;for(var l in a){var h=this._createObjDiv(e),c=this._createObj(h,a[l],r);this._activateObjDiv(h,void 0!=c)}return r},s.prototype._createWidget=function(t,e,i){var s=void 0,r={_p:null==i?null:i.data("sb4-"+i.data("sb4type"))};this._parseBaseOptions(e,r),this._parseBounds(e.bounds,r);var n=e.type;return this._parseDataEntries(e.data,r),s=this._createSBObj(t,n,r)},s.prototype._createSBObj=function(t,i,s){var r;void 0==s&&(s={}),s._engine=this.engine;var n=sb4runtime.getWidgetInfo(i);if(void 0!=n){var o=n.widgetsvc.getShortUIKey();if(""!=s._tags){var a=s._tags.split(" ");for(var l in a)e(t).addClass("tag-"+a[l])}delete s._tags;try{e(t).data("sb4type",o),r=e(t)[o](s)}catch(h){r=null}}return r},s.prototype._createObjDiv=function(t){var i=e("<div class='temp'>",{}).appendTo(t);return i},s.prototype._activateObjDiv=function(t,i){i?t.removeClass("temp"):e(t).remove()},s.prototype._parseBounds=function(e,i){null==e&&(e={}),i._x=t.getInt(e.x,0),i._y=t.getInt(e.y,0),i._w=t.getInt(e.w,0),i._h=t.getInt(e.h,0)},s.prototype._parseBaseOptions=function(e,i){i._i=t.getDefaultString(e.id,""),i._n=t.getDefaultString(e.name,""),i._z=t.getInt(e.z,0),i._fxi=t.getInt(e.fxi,""),i._fxo=t.getInt(e.fxo,""),i._tags=t.getDefaultString(e.tags,""),t.isFalse(e.v)&&(i._v=!1),i._d=e},s.prototype._parseDataEntries=function(t,e){var s=t;if(s&&"http://axon.smartbuilder.com/model/lo#//DataModel"==s.eClass&&s.entries){var r=s.entries;for(var n in r){var o=r[n].id;if("_prf"==o){var a={},l=r[n].subs;for(var h in l){var c=l[h],u=c.id,d={},p=[],f=c.subs;for(var g in f){var v=f[g],m=v.id,b=this._parseIData(v),_={};_[m]=b.subs?b:b[m],p.push(_)}d.subs=p,a[u]=i.extend(d,JSON.parse(c.value))}e[o]=a}else{var x=this._parseIData(s.entries[n]);e[o]=x.subs?x:x[o]}}}},s.prototype._parseIData=function(s){var r={},n=s.id,o=void 0,a=s.eClass;if("http://axon.smartbuilder.com/model/lo#//StrData"==a)o=t.getDefaultString(s.value,"");else if("http://axon.smartbuilder.com/model/lo#//BoolData"==a)o=t.isTrue(s.value);else if("http://axon.smartbuilder.com/model/lo#//ColorData"==a)if(null!=s.cid)o="#"+s.cid;else{var l=e.Color(t.getInt(s.R,0),t.getInt(s.G,0),t.getInt(s.B,0),1);o=l.toHexString()}else if("http://axon.smartbuilder.com/model/lo#//NumData"==a)o=t.parseNumber(s.value);else if("http://axon.smartbuilder.com/model/lo#//FontData"==a){var h={};void 0!=s["class"]&&(h["class"]=s["class"]),void 0!=s.name&&(h.fontStyle=0==t.getInt(s.style,0)?"normal":"italic",h.fontWeight=0==t.getInt(s.weight,0)?"normal":"bold",h.fontSize=t.getInt(s.size,10),h.fontFamily=s.name),o=h}else"http://axon.smartbuilder.com/model/lo#//SizeData"==a?o=[t.getInt(s.W,0),t.getInt(s.H,0)]:"http://axon.smartbuilder.com/model/lo#//ResData"==a?o=t.getDefaultString(s.key,""):"http://axon.smartbuilder.com/model/lo#//GSONData"==a&&(o=i.string.isBlank(s.value)?{}:JSON.parse(s.value));r[n]=o;var c=s.subs;if(void 0!=c){var u=[];for(var d in c)u.push(this._parseIData(c[d]));r.subs=u}return r},s}),define("sb4core/ObjContext",["underscore","sb4core/DataUtil"],function(t,e){function i(t){this.extctx=t,this.map={},this.ctxlist=[]}return i.objMap={},i.prototype.getObjMap=function(){return i.objMap},i.prototype.getTopMap=function(s){s=e.parseString(s);var r;return t.str.isBlank(s)||(t.has(i.objMap,s)||(this.getObjMap()[s]={}),r=this.getObjMap()[s]),r},i.prototype.fork=function(){return new i(this)},i.prototype.pop=function(t){return arguments.length>0&&1==t||(this.map=void 0),this.extctx},i.prototype.add=function(t,e){this.map[t]=e},i.prototype.set=function(e,i){var s=!1;return t.has(this.map,e)?(this.map[e]=i,!0):($.each(this.ctxlist,function(t,r){s||(s=r.set(e,i))}),s?!0:void 0!=this.extctx?this.extctx.set(e,i):void 0)},i.prototype.get=function(t,e){var i=this.map[t];return 1!=e&&(void 0==i||null==i)&&($.each(this.ctxlist,function(e,s){void 0==i&&(i=s.get(t))}),void 0==i&&void 0!=this.extctx&&(i=this.extctx.get(t))),i},i.prototype.remove=function(t){var e=this.map[t];return void 0!=e&&delete this.map[t],e},i.prototype.addObjContext=function(e){t.indexOf(this.ctxlist,e)<0&&this.ctxlist.push(e)},i.prototype.removeObjContext=function(t){var e=this;$.each(this.ctxlist,function(i,s){return s===t?(e.ctxlist.splice(i,1),!1):void 0})},i.prototype.contains=function(e){var i=!1;return t.has(this.map,e)?!0:($.each(this.ctxlist,function(t,s){return s.contains(e)?(i=!0,!1):void 0}),i?!0:void 0!=this.extctx?this.extctx.contains(e):!1)},i}),define("sb4core/ClassUtil",["sb4core/Logger"],function(t){function e(){}return e.logger=new t("util",function(){return t.getDefaultPrefix()+" ClassUtil "}),e.invoke=function(t,i,s){var r=null;try{_.isArray(s)||(s=[]),e.logger._info([t,i,s]),void 0!=t&&(r=t[i].apply(t,Array.prototype.slice.call(s,0)))}catch(n){e.logger._warn(n)}return r},e.invokeWgtMethod=function(t,i,s){var r=null;try{e.logger._info([t,i,s]),void 0!=t&&(r=t.data("sb4-"+t.data("sb4type"))[i].apply(t.data("sb4-"+t.data("sb4type")),s))}catch(n){e.logger._warn(n)}return r},e.getJQueryWidgetRef=function(t){var i=null;try{i=t.data("sb4-"+t.data("sb4type"))}catch(s){e.logger._warn(s)}return i},e}),define("sb4core/SB4ParseCore",["jquery","underscore","sb4core/Logger","sb4core/DataUtil"],function(t,e,i,s){function r(t){this.engine=t,this.disableStopPoint=!1;var e=this;this.logger=new i("parse",function(){return i.getDefaultPrefix()+e.engine.id+" "})}return r.WHEN="sb4_when",r.WHEN_CONDITION="sb4_evt",r.EVT_KEY="sb4_evt_k",r.EVT_KEY2="sb4_evt_k2",r.EVTX_KEY="sb4_evtx_k",r.EVTX_KEY2="sb4_evtx_k2",r.PROCEDURES_DEFRETURN="procedures_defreturn",r.EVT_SCENE="sb4_evt_scene",r.EVT_G="sb4_evt_g",r.VAL="sb4_val",r.WGT="sb4_wgt",r.WGT_GETTER="sb4_wgt_getter",r.WGT_SETTER="sb4_wgt_setter",r.TRIGGER="sb4_trigger",r.CONTROLS_FOREACH="controls_forEach",r.CONTROLS_FORRANGE="controls_forRange",r.CONTROLS_FLOW_STATEMENTS="controls_flow_statements",r.CONTROLS_WHILE="sb4_controls_while",r.LOGIC_OPERATION="logic_operation",r.LEXICAL_VARIABLE_SET="lexical_variable_set",r.LEXICAL_VARIABLE_GET="lexical_variable_get",r.LOCAL_DECLARATION_STATEMENT="local_declaration_statement",r.EVT_TIMELINE="sb4_evt_timeline",r.EVT_PATH="sb4_evt_path",r.PROCEDURES_CALLNORETURN="procedures_callnoreturn",r.PROCEDURES_CALLRETURN="procedures_callreturn",r.disableStopPointBlockTypeMap={lexical_variable_get:!0,logic_op2:!0,logic_operation:!0,math_compare:!0,sb4_math_arithmetic:!0,sb4_math_arithmetic2:!0,sb4_val:!0,parseWgt:!0,sb4_wgt_getter:!0,sb4_wgt_method:!0,text_compare:!0,text_join:!0,math_single:!0,lists_create_with:!0,lists_is_list:!0,lists_create_empty:!0,lists_serialize:!0,sb4_branch_numlist:!0,lists_is_in:!0,math_on_list:!0,lists_to_csv_row:!0,lists_length:!0,lists_from_csv_row:!0,lists_is_empty:!0,lists_from_csv_table:!0,lists_pick_random_item:!0,lists_lookup_in_pairs:!0,lists_position_in:!0,lists_select_item:!0,lists_pick:!0,lists_in_list:!0,lists_copy:!0,lists_random:!0,lists_compare_items:!0,sb4_map_get:!0,sb4_map_keys:!0,sb4_map_exist:!0,sb4_map_vals:!0,sb4_map_empty:!0,sb4_map_is:!0,sb4_map_c:!0,sb4_map_froml:!0,sb4_query_map:!0,sb4_map_has:!0,sb4_map_ref:!0,sb4_map_serialize:!0},r.parserMap={lexical_variable_get:"parseLexicalVariableGet",lexical_variable_set:"parseLexicalVariableSet",lists_add_items:"parseListsAddItems",lists_append_list:"parseListsAppendList",lists_compare_items:"parseListsCompareItems",lists_copy:"parseListsCopy",lists_create_empty:"parseListsCreateEmpty",lists_create_with:"parseListsCreateWith",lists_from_csv_row:"parseListsFromCsvRow",lists_from_csv_table:"parseListsFromCsvTable",lists_in_list:"parseListsInList",lists_insert_item:"parseListsInsertItem",lists_is_empty:"parseListsIsEmpty",lists_is_in:"parseListsIsIn",lists_is_list:"parseListsIsList",lists_length:"parseListsLength",lists_lookup_in_pairs:"parseListsLookupInPairs",lists_pick_random_item:"parseListsPickRandomItem",lists_position_in:"parseListsPositionIn",lists_random:"parseListRandom",lists_remove_item:"parseListsRemoveItem",lists_remove_item2:"parseListsRemoveItem2",lists_remove_list:"parseListsRemoveList",lists_replace_item:"parseListsReplaceItem",lists_select_item:"parseListsSelectItem",lists_to_csv_row:"parseListsToCsvRow",lists_to_csv_table:"parseListsToCsvRow",lists_sortm:"parseListsSortm",lists_sort:"parseListsSort",lists_pick:"parsePick",lists_serialize:"parseListsSerialize",lists_deserialize:"parseListsDeserialize",local_declaration_statement:"parseLocalDeclarationStatement",logic_negate:"parseLogicNegate",logic_op2:"parseLogicOp2",logic_operation:"parseLogicOperation",math_atan2:"parseMathAtan2",math_compare:"parseMathCompare",math_divide:"parseMathDivide",math_on_list:"parseMathOnList",math_random_float:"parseMathRandomFloat",math_random_int:"parseMathRandomInt",math_single:"parseMathSingle",math_trig:"parseMathTrig",modify_value:"parseModifyValue",procedures_callnoreturn:"parseProceduresCallReturn",procedures_callreturn:"parseProceduresCallReturn",sb4_ajax:"parseAjax",sb4_ajax_sync:"parseAjaxSync",sb4_branch_byname:"parseBranchByName",sb4_branch_byname2:"parseBranchByName2",sb4_branch_names:"parseBranchNames",sb4_branch_numlist:"parseBranchNumList",sb4_breakpoint:"parseBreakPoint",sb4_build_query:"parseBuildQuery",sb4_close_lesson:"parseCloseLesson",sb4_color_make:"parseColorMake",sb4_color_split:"parseColorSplit",sb4_controls_if:"parseIf",sb4_exit:"parseExit",sb4_fire:"parseFire",sb4_focus:"parseFocus",sb4_func:"parseFunc",sb4_func2:"parseFunc",sb4_callproc:"parseCallProc",sb4_callproc2:"parseCallProc",sb4_goto_branch:"parseGotoBranch",sb4_goto_page:"parseGotoPage",sb4_map_clear:"parseMapClear",sb4_map_deserialize:"parseMapDeserialize",sb4_map_empty:"parseMapEmpty",sb4_map_exist:"parseMapExist",sb4_map_froml:"parseMapFroml",sb4_map_get:"parseMapGet",sb4_map_has:"parsesMapHas",sb4_map_is:"parseMapIs",sb4_map_keys:"parseMapKeys",sb4_map_vals:"parseMapVals",sb4_map_map2var:"parseMapMap2Var",sb4_map_ref:"parseMapRef",sb4_map_remove:"parseMapRemove",sb4_map_serialize:"parseMapSerialize",sb4_map_set:"parseMapSet",sb4_map_var2map:"parsesMapVar2Map",sb4_map_c:"parseMapC",sb4_map_m:"parseMapM",sb4_math_arithmetic:"parseMathArithmetic",sb4_math_arithmetic2:"parseMathArithmetic2",sb4_move_countdrag:"parseMoveCountDrag",sb4_move_finddrag:"parseMoveFindDrag",sb4_move_findzone:"parseMoveFindZone",sb4_move_inzone:"parseMoveInZone",sb4_move_isdragdrop:"parseMoveIsDragDrop",sb4_move_layout:"parseMoveLayout",sb4_move_path:"parseMovePath",sb4_move_pos:"parseMovePos",sb4_move_relative:"parseMoveRelative",sb4_move_reset:"parseMoveReset",sb4_move_setdrop:"parseMoveSetDrop",sb4_move_setmdrag:"parseMoveSetMDrag",sb4_move_udlr:"parseMove",sb4_page_bynum:"parsePageByNum",sb4_pagename_bynum:"parsePageNameByNum",sb4_pagenum:"parsePageNum",sb4_print:"parsePrint",sb4_query_map:"parseQueryMap",sb4_reload_scene:"parseReloadScene",sb4_scene_count:"parseSceneCount",sb4_scene_name:"parseSceneName",sb4_show:"parseShowWithEffect",sb4_show_ind:"parseShowInd",sb4_showex:"parseShowWithEffect",sb4_showfx:"parseShowfx",sb4_tag:"parseTag",sb4_tagx:"parseTagx",sb4_timeline:"parseTimeLine",sb4_timeline_goto:"parseTimeLineGoto",sb4_trigger:"parseTrigger",sb4_val:"parseVal",sb4_volume:"parseVolume",sb4_wait:"parseWait",sb4_msg:"parseMsg",sb4_wgt:"parseWgt",sb4_wgt_getter:"parseWgtGetter",sb4_wgt_getter_a:"parseWgtGetterA",sb4_wgt_method:"parseWgtMethod",sb4_wgt_method_a:"parseWgtMethodA",sb4_wgt_setter:"parseWgtSetter",sb4_wgt_setter_a:"parseWgtSetterA",sb4_xapi_actor:"parseXApiActor",sb4_xapi_stg:"parseGetXApiSts",sb4_xapi_stmt1:"parseXapiStmt1",sb4_xapi_stmt2:"parseXapiStmt2",sb4_xapi_stmt3:"parseXapiStmt3",sb4_xapi_stmt4:"parseXapiStmt4",sb4_xapi_stmtb:"parseXapiStmtb",sb4_xapi_stmtc:"parseXapiStmtc",sb4_xapi_stmtco:"parseXapiStmtco",sb4_xapi_stmtg:"parseGetXApiStmt",sb4_xapi_stmtl:"parseXapiStmtl",sb4_xapi_stmtn:"parseXapiStmtn",sb4_xapi_stmto:"parseXapiStmto",sb4_xapi_stmtpa:"parseXapiStmtpa",sb4_xapi_stmts:"parseSetXApiStmt",sb4_xapi_stmtsc:"parseXapiStmtsc",sb4_xapi_sts:"parseSetXApiSts",sb4_xapi_stm:"parseSetXApiStm",sb4_xapi_wstmts:"parseXApiWstmts",sb4_xapi_spf:"parseXApiSpf",sb4_xapi_gpf:"parseXApiGpf",sb4_xapi_mpf:"parseXApiMpf",sb4_xapi_apfr:"parseXApiApfr",sb4_xapi_gpfr:"parseXApiGpfr",text_changeCase:"parseTextChangeCase",text_compare:"parseTextCompare",text_contains:"parseTextContains",text_isEmpty:"parseTextIsEmpty",text_join:"parseTextJoin",text_length:"parseTextLength",text_replace_all:"parseTextReplaceAll",text_segment:"parseTextSegment",text_split:"parseTextSplit",text_split_at_spaces:"parseTextSplitAtSpaces",text_trim:"parseTextTrim"},r.prototype.parse=function(e){var i=this,s=t.parseXML(e),n=t(s),o=n.find("block").filter(function(){return t(this).attr("type")==r.WHEN?this:void 0});this.parseWhen(o);var a=n.find("block").filter(function(){return t(this).attr("type")==r.PROCEDURES_DEFRETURN?this:void 0});this.parseProceduresDefReturn(a)},r.prototype.SIMPLE_EVTMAP={},r.prototype.SIMPLE_EVTMAP[r.EVT_SCENE]=!0,r.prototype.SIMPLE_EVTMAP[r.WHEN_CONDITION]=!0,r.prototype.SIMPLE_EVTMAP[r.EVT_KEY]=!0,r.prototype.SIMPLE_EVTMAP[r.EVT_KEY2]=!0,r.prototype.parseWhen=function(i){var n=this;t.each(i,function(i,o){n.logger._debug("parseWhen .... ");var a={};if("true"!=t(o).attr("disabled")){t(o).find("block").filter(function(){return r.prototype.SIMPLE_EVTMAP[t(this).attr("type")]&&"true"!=t(this).attr("disabled")}).each(function(){var e=t(this).find("mutation");if(t(this).attr("type")==r.EVT_KEY2){if(void 0!=e){var i=t(this).find("field").html();""==i&&(i="[any]");var s=e.attr("oid")+"."+i;a[s]=!0}"key_d"==e.attr("oid")?SB4API.KEY_DOWN_YES=!0:"key_u"==e.attr("oid")&&(SB4API.KEY_UP_YES=!0)}else{if(void 0!=e){var s=e.attr("oid")+"."+e.attr("v");a[s]=!0}t(this).attr("type")==r.EVT_KEY&&("key_d"==e.attr("oid")?SB4API.KEY_DOWN_YES=!0:"key_u"==e.attr("oid")&&(SB4API.KEY_UP_YES=!0))}}),t(o).find("block").filter(function(){return t(this).attr("type")==r.EVT_PATH&&"true"!=t(this).attr("disabled")?this:void 0}).each(function(){var e=t(this).find("mutation").attr("pid"),i=s.parseNumber(t(this).find("field ").html());0>=i&&(i=-1);var r=t(this).find("mutation").attr("oid")+"."+e+"_"+i;a[r]=!0}),t(o).find("block").filter(function(){return t(this).attr("type")==r.EVT_TIMELINE&&"true"!=t(this).attr("disabled")?this:void 0}).each(function(){var e=s.parseNumber(t(this).find("field ").html());0>=e&&(e=-1);var i="timeline."+e;a[i]=!0}),t(o).find("block").filter(function(){return t(this).attr("type")==r.EVT_G&&"true"!=t(this).attr("disabled")?this:void 0}).each(function(){var e="flow.evt://"+t(this).find("field").html();a[e]=!0});var l=t(this).find("statement").first(),h={};t(o).find("block").filter(function(){return 0==t(this).attr("type").indexOf("sb4_evtx")&&"true"!=t(this).attr("disabled")?this:void 0}).each(function(){var e="";if("sb4_evtx_a"==t(this).attr("type"))e=t(this).find("mutation").attr("oid")+"."+t(this).find("mutation").attr("t")+"."+t(this).find("mutation").attr("v")+"."+t(this).attr("type");else if(t(this).attr("type")==r.EVTX_KEY){var i=t(this).find("mutation");e="."+i.attr("t")+"."+i.attr("v")+"."+t(this).attr("type")}else if(t(this).attr("type")==r.EVTX_KEY2){var i=t(this).find("mutation"),s=t(this).children("field[name='v']").text();""==s&&(s="[any]"),e="."+i.attr("t")+"."+s+"."+r.EVTX_KEY}else if("sb4_evtx_path"==t(this).attr("type")){var o=t(this).children("field[name='num']").text();"end"==o&&t(this).children("field[name='num']").text("-1"),e=t(this).find("mutation").attr("oid")+"."+t(this).attr("type")}else e=t(this).children("mutation").length>0?t(this).find("mutation").attr("oid")+"."+t(this).attr("type"):"."+t(this).attr("type");n.engine.registerDynamicEvent(e,t(this),l)});var c=e.keys(a);c.length>0&&n.engine.registerEvent(c,l),n.logger._debug("parseWhen end "+c)}})},r.prototype.parseProceduresDefReturn=function(e){var i=this;t.each(e,function(e,s){if(i.logger._debug("procedures .... "),"true"!=t(s).attr("disabled")){var r=t(s),n={};n.name=r.children("field[name=NAME]").text(),n.statement=r.children("statement[name=RETURN]"),n.argNames=[],t.each(r.children("mutation").children("arg"),function(e,i){n.argNames.push(t(i).attr("name"))});var o=i.engine.objctx.get("_frame");o.engine.objctx.add("[fn:"+n.name+"]",n),i.logger._debug("procedures end ")}})},r.prototype.parseBlock=function(t,i){var s=this;if(0==t.length||"true"==t.attr("disabled")){var n=t.children("next").first();return void 0!=n&&n.length>0?s.parseBlock(n.children("block"),i):i}var o=null,a=s.engine.objctx.get("flow");s.logger._debug("current flow is  "+a),"BREAK"!=a&&"CONTINUE"!=a&&("true"==t.attr("disabled")||null!=r.parserMap[t.attr("type")]&&(o=s[r.parserMap[t.attr("type")]].apply(s,[t,i]))),t.attr("type")==r.CONTROLS_FOREACH?o=s.parseControlsForEach(t,i):t.attr("type")==r.CONTROLS_FORRANGE?o=s.parseControlsForRange(t,i):t.attr("type")==r.CONTROLS_FLOW_STATEMENTS?o=s.parseControlsFlowStatements(t,i):t.attr("type")==r.CONTROLS_WHILE&&(o=s.parseControlsWhile(t,i)),null==o&&(o=i);var l=null;l=s.disableStopPoint||e.has(r.disableStopPointBlockTypeMap,t.attr("type"))?o:s.createStopPoint(o,t);var n=t.children("next").first();return void 0!=n&&n.length>0?s.parseBlock(n.children("block"),l):l},r.prototype.arrayToObject=function(i){var s={};return e.isArray(i)&&!e.isEmpty(i)&&t.each(i,function(t,r){e.isArray(r)&&i.length>=2&&(s[r[0]]=r[1])}),s},r.prototype.createStopPoint=function(e,i){var s=this,r=e.then(function(e){var r=t.Deferred(),n=r.then(function(){return SB4API.debug&&null!=i&&s.engine._recordBlockResult(i.attr("id")+"."+i.attr("type"),e),e});return s.engine.addStopPoint(r),"dead"!=s.engine.status&&"sleep"!=s.engine.status&&(s.engine.status="idle"),n});return r},r.prototype.setDisableStopPoint=function(t){this.disableStopPoint=t},r}),define("sb4core/DeferredTask",["sb4core/Logger"],function(t){function e(e,i,s){this.c=e,this.tail=i,this.id=s,this.logger=new t("task",function(){return t.getDefaultPrefix()+s+" "})}return e.prototype._process=function(){if(this.logger._debug("tail state is  : "+this.tail.state()),"pending"==this.c.state())this.c.resolve();else if("resolved"==this.tail.state()||"rejected"==this.tail.state())return!0},e}),function(t){"function"==typeof define&&define.amd?define("jqueryui/effect",["jquery"],t):t(jQuery)}(function(t){var e="ui-effects-",i=t;return t.effects={effect:{}},function(t,e){function i(t,e,i){var s=c[e.type]||{};return null==t?i||!e.def?null:e.def:(t=s.floor?~~t:parseFloat(t),isNaN(t)?e.def:s.mod?(t+s.mod)%s.mod:0>t?0:s.max<t?s.max:t)}function s(e){var i=l(),s=i._rgba=[];return e=e.toLowerCase(),f(a,function(t,r){var n,o=r.re.exec(e),a=o&&r.parse(o),l=r.space||"rgba";return a?(n=i[l](a),i[h[l].cache]=n[h[l].cache],s=i._rgba=n._rgba,!1):void 0}),s.length?("0,0,0,0"===s.join()&&t.extend(s,p.transparent),i):p[e]}function r(t,e,i){return i=(i+1)%1,1>6*i?t+(e-t)*i*6:1>2*i?e:2>3*i?t+(e-t)*(2/3-i)*6:t}var n="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",o=/^([\-+])=\s*(\d+\.?\d*)/,a=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[t[1],t[2],t[3],t[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[2.55*t[1],2.55*t[2],2.55*t[3],t[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(t){return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(t){return[t[1],t[2]/100,t[3]/100,t[4]]}}],l=t.Color=function(e,i,s,r){return new t.Color.fn.parse(e,i,s,r)},h={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},c={"byte":{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},u=l.support={},d=t("<p>")[0],p,f=t.each;d.style.cssText="background-color:rgba(1,1,1,.5)",u.rgba=d.style.backgroundColor.indexOf("rgba")>-1,f(h,function(t,e){e.cache="_"+t,e.props.alpha={idx:3,type:"percent",def:1}}),l.fn=t.extend(l.prototype,{parse:function(r,n,o,a){if(r===e)return this._rgba=[null,null,null,null],this;(r.jquery||r.nodeType)&&(r=t(r).css(n),n=e);var c=this,u=t.type(r),d=this._rgba=[];return n!==e&&(r=[r,n,o,a],u="array"),"string"===u?this.parse(s(r)||p._default):"array"===u?(f(h.rgba.props,function(t,e){d[e.idx]=i(r[e.idx],e)}),this):"object"===u?(r instanceof l?f(h,function(t,e){r[e.cache]&&(c[e.cache]=r[e.cache].slice())}):f(h,function(e,s){var n=s.cache;f(s.props,function(t,e){if(!c[n]&&s.to){if("alpha"===t||null==r[t])return;c[n]=s.to(c._rgba)}c[n][e.idx]=i(r[t],e,!0)}),c[n]&&t.inArray(null,c[n].slice(0,3))<0&&(c[n][3]=1,s.from&&(c._rgba=s.from(c[n])))}),this):void 0},is:function(t){var e=l(t),i=!0,s=this;return f(h,function(t,r){var n,o=e[r.cache];return o&&(n=s[r.cache]||r.to&&r.to(s._rgba)||[],f(r.props,function(t,e){return null!=o[e.idx]?i=o[e.idx]===n[e.idx]:void 0})),i}),i},_space:function(){var t=[],e=this;return f(h,function(i,s){e[s.cache]&&t.push(i)}),t.pop()},transition:function(t,e){var s=l(t),r=s._space(),n=h[r],o=0===this.alpha()?l("transparent"):this,a=o[n.cache]||n.to(o._rgba),u=a.slice();return s=s[n.cache],f(n.props,function(t,r){var n=r.idx,o=a[n],l=s[n],h=c[r.type]||{};null!==l&&(null===o?u[n]=l:(h.mod&&(l-o>h.mod/2?o+=h.mod:o-l>h.mod/2&&(o-=h.mod)),u[n]=i((l-o)*e+o,r)))}),this[r](u)},blend:function(e){if(1===this._rgba[3])return this;var i=this._rgba.slice(),s=i.pop(),r=l(e)._rgba;return l(t.map(i,function(t,e){return(1-s)*r[e]+s*t}))},toRgbaString:function(){var e="rgba(",i=t.map(this._rgba,function(t,e){return null==t?e>2?1:0:t});return 1===i[3]&&(i.pop(),e="rgb("),e+i.join()+")"},toHslaString:function(){var e="hsla(",i=t.map(this.hsla(),function(t,e){return null==t&&(t=e>2?1:0),e&&3>e&&(t=Math.round(100*t)+"%"),t});return 1===i[3]&&(i.pop(),e="hsl("),e+i.join()+")"},toHexString:function(e){var i=this._rgba.slice(),s=i.pop();return e&&i.push(~~(255*s)),"#"+t.map(i,function(t){return t=(t||0).toString(16),1===t.length?"0"+t:t}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),l.fn.parse.prototype=l.fn,h.hsla.to=function(t){if(null==t[0]||null==t[1]||null==t[2])return[null,null,null,t[3]];var e=t[0]/255,i=t[1]/255,s=t[2]/255,r=t[3],n=Math.max(e,i,s),o=Math.min(e,i,s),a=n-o,l=n+o,h=.5*l,c,u;return c=o===n?0:e===n?60*(i-s)/a+360:i===n?60*(s-e)/a+120:60*(e-i)/a+240,u=0===a?0:.5>=h?a/l:a/(2-l),[Math.round(c)%360,u,h,null==r?1:r]},h.hsla.from=function(t){if(null==t[0]||null==t[1]||null==t[2])return[null,null,null,t[3]];var e=t[0]/360,i=t[1],s=t[2],n=t[3],o=.5>=s?s*(1+i):s+i-s*i,a=2*s-o;return[Math.round(255*r(a,o,e+1/3)),Math.round(255*r(a,o,e)),Math.round(255*r(a,o,e-1/3)),n]},f(h,function(s,r){var n=r.props,a=r.cache,h=r.to,c=r.from;l.fn[s]=function(s){if(h&&!this[a]&&(this[a]=h(this._rgba)),s===e)return this[a].slice();var r,o=t.type(s),u="array"===o||"object"===o?s:arguments,d=this[a].slice();return f(n,function(t,e){var s=u["object"===o?t:e.idx];null==s&&(s=d[e.idx]),d[e.idx]=i(s,e)}),c?(r=l(c(d)),r[a]=d,r):l(d)},f(n,function(e,i){l.fn[e]||(l.fn[e]=function(r){var n=t.type(r),a="alpha"===e?this._hsla?"hsla":"rgba":s,l=this[a](),h=l[i.idx],c;return"undefined"===n?h:("function"===n&&(r=r.call(this,h),n=t.type(r)),null==r&&i.empty?this:("string"===n&&(c=o.exec(r),c&&(r=h+parseFloat(c[2])*("+"===c[1]?1:-1))),l[i.idx]=r,this[a](l)))})})}),l.hook=function(e){var i=e.split(" ");f(i,function(e,i){t.cssHooks[i]={set:function(e,r){var n,o,a="";if("transparent"!==r&&("string"!==t.type(r)||(n=s(r)))){if(r=l(n||r),!u.rgba&&1!==r._rgba[3]){for(o="backgroundColor"===i?e.parentNode:e;(""===a||"transparent"===a)&&o&&o.style;)try{a=t.css(o,"backgroundColor"),o=o.parentNode}catch(h){}r=r.blend(a&&"transparent"!==a?a:"_default")}r=r.toRgbaString()}try{e.style[i]=r}catch(h){}}},t.fx.step[i]=function(e){e.colorInit||(e.start=l(e.elem,i),e.end=l(e.end),e.colorInit=!0),t.cssHooks[i].set(e.elem,e.start.transition(e.end,e.pos))}})},l.hook(n),t.cssHooks.borderColor={expand:function(t){var e={};return f(["Top","Right","Bottom","Left"],function(i,s){e["border"+s+"Color"]=t}),e}},p=t.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(i),function(){function e(e){var i,s,r=e.ownerDocument.defaultView?e.ownerDocument.defaultView.getComputedStyle(e,null):e.currentStyle,n={};if(r&&r.length&&r[0]&&r[r[0]])for(s=r.length;s--;)i=r[s],"string"==typeof r[i]&&(n[t.camelCase(i)]=r[i]);else for(i in r)"string"==typeof r[i]&&(n[i]=r[i]);return n}function s(e,i){var s={},r,o;for(r in i)o=i[r],e[r]!==o&&(n[r]||(t.fx.step[r]||!isNaN(parseFloat(o)))&&(s[r]=o));return s}var r=["add","remove","toggle"],n={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};t.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(e,s){t.fx.step[s]=function(t){("none"!==t.end&&!t.setAttr||1===t.pos&&!t.setAttr)&&(i.style(t.elem,s,t.end),t.setAttr=!0)}}),t.fn.addBack||(t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t.effects.animateClass=function(i,n,o,a){var l=t.speed(n,o,a);return this.queue(function(){var n=t(this),o=n.attr("class")||"",a,h=l.children?n.find("*").addBack():n;h=h.map(function(){var i=t(this);return{el:i,start:e(this)}}),a=function(){t.each(r,function(t,e){i[e]&&n[e+"Class"](i[e])})},a(),h=h.map(function(){return this.end=e(this.el[0]),this.diff=s(this.start,this.end),this}),n.attr("class",o),h=h.map(function(){var e=this,i=t.Deferred(),s=t.extend({},l,{queue:!1,complete:function(){i.resolve(e)}});return this.el.animate(this.diff,s),i.promise()}),t.when.apply(t,h.get()).done(function(){a(),t.each(arguments,function(){var e=this.el;t.each(this.diff,function(t){e.css(t,"")})}),l.complete.call(n[0])})})},t.fn.extend({addClass:function(e){return function(i,s,r,n){return s?t.effects.animateClass.call(this,{add:i},s,r,n):e.apply(this,arguments)}}(t.fn.addClass),removeClass:function(e){return function(i,s,r,n){return arguments.length>1?t.effects.animateClass.call(this,{remove:i},s,r,n):e.apply(this,arguments)}}(t.fn.removeClass),toggleClass:function(e){return function(i,s,r,n,o){return"boolean"==typeof s||void 0===s?r?t.effects.animateClass.call(this,s?{add:i}:{remove:i},r,n,o):e.apply(this,arguments):t.effects.animateClass.call(this,{toggle:i},s,r,n)}}(t.fn.toggleClass),switchClass:function(e,i,s,r,n){return t.effects.animateClass.call(this,{add:i,remove:e},s,r,n)}})}(),function(){function i(e,i,s,r){return t.isPlainObject(e)&&(i=e,e=e.effect),e={effect:e},null==i&&(i={}),t.isFunction(i)&&(r=i,s=null,i={}),("number"==typeof i||t.fx.speeds[i])&&(r=s,s=i,i={}),t.isFunction(s)&&(r=s,s=null),i&&t.extend(e,i),s=s||i.duration,e.duration=t.fx.off?0:"number"==typeof s?s:s in t.fx.speeds?t.fx.speeds[s]:t.fx.speeds._default,e.complete=r||i.complete,e}function s(e){return!e||"number"==typeof e||t.fx.speeds[e]?!0:"string"!=typeof e||t.effects.effect[e]?t.isFunction(e)?!0:"object"!=typeof e||e.effect?!1:!0:!0}t.extend(t.effects,{version:"1.11.2",save:function(t,i){for(var s=0;s<i.length;s++)null!==i[s]&&t.data(e+i[s],t[0].style[i[s]])},restore:function(t,i){var s,r;for(r=0;r<i.length;r++)null!==i[r]&&(s=t.data(e+i[r]),void 0===s&&(s=""),t.css(i[r],s))},setMode:function(t,e){return"toggle"===e&&(e=t.is(":hidden")?"show":"hide"),e},getBaseline:function(t,e){var i,s;switch(t[0]){case"top":i=0;break;case"middle":i=.5;break;case"bottom":i=1;break;default:i=t[0]/e.height}switch(t[1]){case"left":s=0;break;case"center":s=.5;break;case"right":s=1;break;default:s=t[1]/e.width}return{x:s,y:i}},createWrapper:function(e){if(e.parent().is(".ui-effects-wrapper"))return e.parent();var i={width:e.outerWidth(!0),height:e.outerHeight(!0),"float":e.css("float")},s=t("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),r={width:e.width(),height:e.height()},n=document.activeElement;try{n.id}catch(o){n=document.body}return e.wrap(s),(e[0]===n||t.contains(e[0],n))&&t(n).focus(),s=e.parent(),"static"===e.css("position")?(s.css({position:"relative"}),e.css({position:"relative"})):(t.extend(i,{position:e.css("position"),zIndex:e.css("z-index")}),t.each(["top","left","bottom","right"],function(t,s){i[s]=e.css(s),isNaN(parseInt(i[s],10))&&(i[s]="auto")}),e.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),e.css(r),s.css(i).show()},removeWrapper:function(e){var i=document.activeElement;return e.parent().is(".ui-effects-wrapper")&&(e.parent().replaceWith(e),(e[0]===i||t.contains(e[0],i))&&t(i).focus()),e},setTransition:function(e,i,s,r){return r=r||{},t.each(i,function(t,i){var n=e.cssUnit(i);n[0]>0&&(r[i]=n[0]*s+n[1])}),r}}),t.fn.extend({effect:function(){function e(e){function i(){t.isFunction(n)&&n.call(r[0]),t.isFunction(e)&&e()}var r=t(this),n=s.complete,a=s.mode;(r.is(":hidden")?"hide"===a:"show"===a)?(r[a](),i()):o.call(r[0],s,i)}var s=i.apply(this,arguments),r=s.mode,n=s.queue,o=t.effects.effect[s.effect.toLowerCase()];return t.fx.off||!o?r?this[r](s.duration,s.complete):this.each(function(){s.complete&&s.complete.call(this)}):n===!1?this.each(e):this.queue(n||"fx",e)},show:function(t){return function(e){if(s(e))return t.apply(this,arguments);var r=i.apply(this,arguments);return r.mode="show",this.effect.call(this,r)}}(t.fn.show),hide:function(t){return function(e){if(s(e))return t.apply(this,arguments);var r=i.apply(this,arguments);return r.mode="hide",this.effect.call(this,r)}}(t.fn.hide),toggle:function(t){return function(e){if(s(e)||"boolean"==typeof e)return t.apply(this,arguments);var r=i.apply(this,arguments);return r.mode="toggle",this.effect.call(this,r)}}(t.fn.toggle),cssUnit:function(e){var i=this.css(e),s=[];return t.each(["em","px","%","pt"],function(t,e){i.indexOf(e)>0&&(s=[parseFloat(i),e])}),s}})}(),function(){var e={};
t.each(["Quad","Cubic","Quart","Quint","Expo"],function(t,i){e[i]=function(e){return Math.pow(e,t+2)}}),t.extend(e,{Sine:function(t){return 1-Math.cos(t*Math.PI/2)},Circ:function(t){return 1-Math.sqrt(1-t*t)},Elastic:function(t){return 0===t||1===t?t:-Math.pow(2,8*(t-1))*Math.sin((80*(t-1)-7.5)*Math.PI/15)},Back:function(t){return t*t*(3*t-2)},Bounce:function(t){for(var e,i=4;t<((e=Math.pow(2,--i))-1)/11;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*e-2)/22-t,2)}}),t.each(e,function(e,i){t.easing["easeIn"+e]=i,t.easing["easeOut"+e]=function(t){return 1-i(1-t)},t.easing["easeInOut"+e]=function(t){return.5>t?i(2*t)/2:1-i(-2*t+2)/2}})}(),t.effects}),define("sb4core/parse/core/text_join",["sb4core/SB4ParseCore","sb4core/DataUtil"],function(t,e){t.prototype.parseTextJoin=function(t,i){var s=this,r=i.then(function(){s.logger._info(t.attr("id")+"."+t.attr("type")+" start ... ");var i=t.children("value");if(i.length>0){var r="",n=head=$.Deferred(),o=$.Deferred(),a=0;$.each(i,function(t,l){n=s.parseBlock($(l).find("block:first"),n).then(function(t){r=_.str.join("",r,e.parseString(t)),a+=1,a==i.length&&o.resolve()})}),head.resolve();var l=o.then(function(){return r});return l}});return r}}),define("sb4core/parse/core/sb4_wgt_setter",["sb4core/SB4ParseCore","sb4core/ClassUtil"],function(t,e){t.prototype.parseWgtSetter=function(t,i){var s=this,r=i.then(function(){s.logger._info(t.attr("id")+"."+t.attr("type")+" start ... ");var i=t.find("mutation").attr("oid"),r="set"+_.str.capitalize(t.find("mutation").attr("m"));s.logger._debug(t.attr("id")+"."+t.attr("type")+" parseWgtSetter ..."+i+" "+r);var n=t.children("value").find("block:first"),o=$.Deferred(),a=s.parseBlock(n,o).then(function(t){var n=s.engine.objctx.get(i);e.invoke(n,r,[t])});return o.resolve(),a});return r}}),define("sb4core/parse/core/sb4_math_arithmetic2",["sb4core/SB4ParseCore","sb4core/DataUtil"],function(t,e){t.prototype.parseMathArithmetic2=function(t,i){var s=this,r=i.then(function(){s.logger._debug(t.attr("id")+"."+t.attr("type")+" start ... ");var i=t.children("field[name=OP]").text(),r=t.children("value");if(r.length>0){var n=[],o=$.Deferred(),a=$.Deferred(),l=0;o.then(function(){$.each(r,function(t,i){var o=$.Deferred();s.parseBlock($(i).find("block:first"),o).then(function(i){n[t]=e.parseNumber(i),l+=1,l==r.length&&a.resolve()}),o.resolve()})});var h=a.then(function(){if(n.length>=2){if("ADD"==i){var e=n.shift();return $.each(n,function(t,i){e+=i}),e}if("MINUS"==i){var e=n.shift();return $.each(n,function(t,i){e-=i}),e}if("MULTIPLY"==i){var e=n.shift();return $.each(n,function(t,i){e*=i}),e}if("DIVIDE"==i){var e=n.shift();return $.each(n,function(t,i){e/=i}),e}if("POWER"==i){var e=n.shift();return $.each(n,function(t,i){e=Math.pow(e,i)}),e}return s.logger._warn(t.attr("id")+"."+t.attr("type")+" op is error "),!1}return 1==n.length?n[0]:0});return o.resolve(),h}});return r}}),define("sb4core/parse/core/sb4_goto_branch",["sb4core/SB4ParseCore"],function(t){t.prototype.parseGotoBranch=function(t,e){var i=this,s=e.then(function(){i.logger._info(t.attr("id")+"."+t.attr("type")+" start ... ");var e={};e.v=t.children("field[name=v]").text();var s=i.engine.objctx.get("_frame"),r=$.Deferred();return r.reject(),r.fail(function(){i.engine.interrupt("gotoPage"),s.onEnginePageEvent(t.attr("type"),e)}),r});return s}}),define("sb4core/parse/core/sb4_wgt_getter",["sb4core/SB4ParseCore","sb4core/ClassUtil"],function(t,e){t.prototype.parseWgtGetter=function(t,i){var s=this,r=i.then(function(){s.logger._info(t.attr("id")+"."+t.attr("type")+" start ... ");var i=t.find("mutation").attr("oid"),r="get"+_.str.capitalize(t.find("mutation").attr("m"));s.logger._debug(t.attr("id")+"."+t.attr("type")+" parseWgtGetter ..."+i+" "+r);var n=s.engine.objctx.get(i),o=e.invoke(n,r,[]);return o});return r}}),define("sb4core/parse/core/text_compare",["sb4core/SB4ParseCore","sb4core/DataUtil"],function(t,e){t.prototype.parseTextCompare=function(t,i){var s=this,r=i.then(function(){s.logger._info(t.attr("id")+"."+t.attr("type")+" start ... ");var i=t.children("field[name=OP]").text().trim(),r=$.Deferred(),n=s.parseBlock(t.children("value[name=TEXT1]").find("block:first"),r),o=$.Deferred(),a=s.parseBlock(t.children("value[name=TEXT2]").find("block:first"),o),l=$.when(n,a).then(function(r,n){s.logger._debug(t.attr("id")+"."+t.attr("type")+" "+r+" parseTextCompare "+n);var o=e.parseString(r),a=e.parseString(n);return"LT"==i?a>o:"EQUAL"==i?o==a:"GT"==i?o>a:(s.logger._debug(t.attr("id")+"."+t.attr("type")+" op is error "),!1)});return r.resolve(),o.resolve(),l});return r}}),define("sb4core/parse/core/sb4_wgt_method",["sb4core/SB4ParseCore","sb4core/ClassUtil"],function(t,e){t.prototype.parseWgtMethod=function(t,i){var s=this,r=i.then(function(){s.logger._info(t.attr("id")+"."+t.attr("type")+" start ... ");var i=t.find("mutation").attr("oid"),r=t.find("mutation").attr("m"),n=[];$.each(t.children(),function(t,e){("field"==$(e).prop("tagName")||"value"==$(e).prop("tagName"))&&n.push(e)}),n=_.sortBy(n,function(t){return $(t).attr("name")});var o=$.Deferred(),a=[],l=$.Deferred(),h=l;$.each(n,function(t,e){h=h.then(function(t){var i=$(e).attr("name"),r=i.split("-")[1];if("value"==$(e).prop("tagName")){var n=$.Deferred(),o=s.parseBlock($(e).find("block:first"),n).then(function(t){a[r]=t});return n.resolve(),o}a[r]=$(e).html()})}),s.logger._debug(t.attr("id")+"."+t.attr("type")+" parseWgtMethod ..."+i+" "+r+" ",a);var c=o.then(function(){var t=s.engine.objctx.get(i);return e.invoke(t,r,a)});return h.then(function(){o.resolve()}),l.resolve(),c});return r}}),define("sb4core/parse/core/sb4_goto_page",["sb4core/SB4ParseCore","sb4core/DataUtil"],function(t,e){t.prototype.parseGotoPage=function(t,i){var s=this,r=i.then(function(){s.logger._info(t.attr("id")+"."+t.attr("type")+" start ... ");var i={},r=s.engine.objctx.get("_frame"),n=t.children("field[name=v]").html();i.id=e.parseString(n);var o=$.Deferred();return o.reject(),o.fail(function(){s.engine.interrupt("gotoPage"),r.onEnginePageEvent("sb4_goto_scene_by_id",i)}),o});return r}}),define("sb4core/parse/core/sb4_math_arithmetic",["sb4core/SB4ParseCore","sb4core/DataUtil"],function(t,e){t.prototype.parseMathArithmetic=function(t,i){var s=this,r=i.then(function(){s.logger._info(t.attr("id")+"."+t.attr("type")+" start ... ");var i=$.Deferred(),r=$.Deferred(),n=t.children("field[name=OP]").text(),o=s.parseBlock(t.children("value[name=A]").find("block:first"),i),a=s.parseBlock(t.children("value[name=B]").find("block:first"),r);i.resolve(),r.resolve();var l=$.when(o,a).then(function(i,r){s.logger._debug(t.attr("id")+"."+t.attr("type")+" "+i+" : "+r);var o=e.parseNumber(i),a=e.parseNumber(r);return"ADD"==n?o+a:"MINUS"==n?o-a:"MULTIPLY"==n?o*a:"DIVIDE"==n?o/a:"POWER"==n?Math.pow(o,a):(s.logger._warn(t.attr("id")+"."+t.attr("type")+" op is error "),!1)});return l});return r}}),define("sb4core/parse/core/math_compare",["sb4core/SB4ParseCore","sb4core/DataUtil"],function(t,e){t.prototype.parseMathCompare=function(t,i){var s=this,r=i.then(function(){s.logger._info(t.attr("id")+"."+t.attr("type")+" start ... ");var i=$.Deferred(),r=$.Deferred(),n=t.children("field[name=OP]").text(),o=s.parseBlock(t.children("value[name=A]").find("block:first"),i),a=s.parseBlock(t.children("value[name=B]").find("block:first"),r);i.resolve(),r.resolve();var l=$.when(o,a).then(function(i,r){if(s.logger._debug(t.attr("id")+"."+t.attr("type")+" "+i+" : "+r),null==n)return s.logger._warn(t.attr("id")+"."+t.attr("type")+" op is error "),!1;if("S"==n.charAt(n.length-1)){if(i=e.parseString(i),r=e.parseString(r),"EQS"==n)return i==r;if("NEQS"==n)return i!=r;if("LTS"==n)return r>i;if("LTES"==n)return r>=i;if("GTS"==n)return i>r;if("GTES"==n)return i>=r}else{if(_.isObject(i)||_.isObject(r))return i instanceof $.Color||r instanceof $.Color?(i=e.parseColor(i),r=e.parseColor(r),"EQ"==n||"LTE"==n||"GTE"==n?i.is(r):"NEQ"==n?!i.is(r):!1):"EQ"==n||"LTE"==n||"GTE"==n?i===r:"NEQ"==n?i!==r:!1;if(null==i&&(i=""),null==r&&(r=""),"EQ"==n)return i==r;if("NEQ"==n)return i!=r;if("LT"==n)return r>i;if("LTE"==n)return r>=i;if("GT"==n)return i>r;if("GTE"==n)return i>=r}});return l});return r}}),define("sb4core/parse/core/sb4_showex",["sb4core/SB4ParseCore","sb4core/ClassUtil","sb4core/DataUtil"],function(t,e,i){t.prototype.parseShowWithEffect=function(t,s){var r=this,n=s.then(function(){r.logger._info(t.attr("id")+"."+t.attr("type")+" start ... ");var s=t.children("field[name=OP]").text().trim(),n=t.children("field[name=EFFECT]").text(),o=$.Deferred(),a=1e3,l=[],h=0,c=t.children("value[name=WGT]").children("block");if(c.length>0){$.each(c,function(t,e){var i=$.Deferred();r.parseBlock($(e),i).then(function(t){l=l.concat(t),h+=1,h==c.length&&o.resolve()}),i.resolve()});var u=o.then(function(){return _.union(l)}).then(function(t){var r=i.parseWidgetArray(t);$.each(r,function(t,i){var r=[];r.push(n),e.invoke(i,s,r)})});return u}});return n}}),define("sb4core/parse/core/sb4_controls_if",["sb4core/SB4ParseCore","sb4core/DataUtil"],function(t,e){t.prototype.parseIf=function(t,i){var s=this;s.logger._info(t.attr("id")+"."+t.attr("type")+" start ... ");var r=t.children("value"),n=$.Deferred(),o=function(i,a){if(i<r.length){var l=$(r[i]).next();s.parseBlock($(r[i]).find("block:first"),a).then(function(t){if(e.isTrue(t)){var r=$.Deferred(),a=s.parseBlock(l.find("block:first"),r).then(function(){n.resolve()});return r.resolve(),a}var h=$.Deferred();return h.resolve(),i+=1,o(i,h)})}else{var h=t.children("statement[name=ELSE]");if(void 0!=h&&h.length>0){var c=$.Deferred(),u=s.parseBlock(h.find("block:first"),c).then(function(){n.resolve()});return c.resolve(),u}n.resolve()}},a=o(0,i);return n}}),define("sb4core/parse/core/logic_operation",["sb4core/SB4ParseCore","sb4core/DataUtil"],function(t,e){t.prototype.parseLogicOperation=function(t,i){var s=this,r=i.then(function(){s.logger._info(t.attr("id")+"."+t.attr("type")+" start ... ");var i=$.Deferred(),r=$.Deferred(),n=t.children("field[name=OP]").text(),o=s.parseBlock(t.children("value[name=A]").find("block:first"),i),a=s.parseBlock(t.children("value[name=B]").find("block:first"),r);i.resolve();var l=$.when(o).then(function(i){s.logger._debug(t.attr("id")+"."+t.attr("type")+" op1 = "+i);var o=e.parseBoolean(i);return"AND"==n?o?(r.resolve(),$.when(a).then(function(i){return s.logger._debug(t.attr("id")+"."+t.attr("type")+" op2 = "+i),e.parseBoolean(i)})):!1:o?!0:(r.resolve(),$.when(a).then(function(i){return s.logger._debug(t.attr("id")+"."+t.attr("type")+" op2 = "+i),e.parseBoolean(i)}))});return l});return r}}),define("sb4core/parse/core/sb4_wgt",["sb4core/SB4ParseCore"],function(t){t.prototype.parseWgt=function(t,e){var i=this,s=e.then(function(){i.logger._info(t.attr("id")+"."+t.attr("type")+" start ... ");var e=t.find("mutation").attr("oid");return i.logger._debug(t.attr("id")+"."+t.attr("type")+" parseWgtGetter ..."+e),i.engine.objctx.get(e)});return s}}),define("sb4core/parse/core/sb4_val",["sb4core/SB4ParseCore","sb4core/DataUtil"],function(t,e){t.prototype.parseVal=function(t,i){var s=this,r=i.then(function(){s.logger._info(t.attr("id")+"."+t.attr("type")+" start ... ");var i=t.find("mutation").attr("vtype"),r=t.children("field[name=V]").text();return"BOOL"==i?r=e.parseBoolean(r):"TXT"==i?r=e.parseString(r):"COLOR"==i?r=e.parseString(r):"NUM"==i&&(r=e.parseNumber(r)),s.logger._debug(t.attr("id")+"."+t.attr("type")+" "+i+" parseVal  value= "+r),r});return r}}),define("sb4core/parse/core/logic_op2",["sb4core/SB4ParseCore","sb4core/DataUtil"],function(t,e){t.prototype.parseLogicOp2=function(t,i){var s=this,r=i.then(function(){s.logger._debug(t.attr("id")+"."+t.attr("type")+" start ... ");var i=t.children("field[name=OP]").text(),r=t.children("value");if(r.length>0){var n=[],o=$.Deferred(),a=$.Deferred();o.then(function(){$.each(r,function(t,i){var o=$.Deferred();s.parseBlock($(i).find("block:first"),o).then(function(t){n.push(e.parseBoolean(t)),n.length==r.length&&a.resolve()}),o.resolve()})});var l=a.then(function(){if(n.length>=1){if("AND"==i){var t=!0;return $.each(n,function(e,i){return i?void 0:(t=!1,!1)}),t}var t=!1;return $.each(n,function(e,i){return i?(t=!0,!1):void 0}),t}return!1});return o.resolve(),l}return!1});return r}}),define("sb4core/parse/core/lexical_variable_get",["sb4core/SB4ParseCore"],function(t){t.prototype.parseLexicalVariableGet=function(t,e){var i=this,s=e.then(function(){i.logger._info(t.attr("id")+"."+t.attr("type")+" start ... ");var e=t.children("field[name=VAR]").text();return i.engine.objctx.get(e)});return s}}),define("sb4core/parse/core/lexical_variable_set",["sb4core/SB4ParseCore"],function(t){t.prototype.parseLexicalVariableSet=function(t,e){var i=this,s=e.then(function(){i.logger._info(t.attr("id")+"."+t.attr("type")+" start ... ");var e=t.children("field[name=VAR]").text(),s=$.Deferred(),r=i.parseBlock(t.children("value[name=VALUE]").find("block:first"),s).then(function(t){0==e.indexOf("global ")?i.engine.objctx.set(e,t):i.engine.objctx.contains(e)?i.engine.objctx.set(e,t):i.engine.objctx.add(e,t)});return s.resolve(),r});return s}}),define("sb4core/parse/parse_core",["sb4core/parse/core/text_join","sb4core/parse/core/sb4_wgt_setter","sb4core/parse/core/sb4_math_arithmetic2","sb4core/parse/core/sb4_goto_branch","sb4core/parse/core/sb4_wgt_getter","sb4core/parse/core/text_compare","sb4core/parse/core/sb4_wgt_method","sb4core/parse/core/sb4_goto_page","sb4core/parse/core/sb4_math_arithmetic","sb4core/parse/core/math_compare","sb4core/parse/core/sb4_showex","sb4core/parse/core/sb4_controls_if","sb4core/parse/core/logic_operation","sb4core/parse/core/sb4_wgt","sb4core/parse/core/sb4_val","sb4core/parse/core/logic_op2","sb4core/parse/core/lexical_variable_get","sb4core/parse/core/lexical_variable_set"],function(){}),define("sb4core/SB4Engine",["jquery","underscore","sb4core/Logger","sb4core/ClassUtil","sb4core/DataUtil","sb4core/SB4ParseCore","sb4core/DeferredTask","underscore_str","jqueryui/core","jqueryui/effect","sb4core/parse/parse_core"],function(t,e,i,s,r,n,o){function a(t,e,s,o){void 0==t&&(t=""),this.id=t,void 0==t&&(t="-"),this.name=o,this.timer=-1,this.tick=r.parseNumber(e),this.tick=this.tick<=0?8:this.tick,e>a.MAX_TITCK&&(this.tick=a.MAX_TITCK),this.logger=new i("engine",function(){return i.getDefaultPrefix()+t+" "+o+" "}),this.status=a.STATUS_SLEEP,this.taskQueue=new l,this.subEngines=[],this.objctx=s,this.initObjctx=s,this.idleCount=0,this.maxIdleCount=1e3,this.startFlag=!0,this.results=[],this.eventMap={},this.dynamicEventMap={},this.eventIdleCount=0,this.maxEventIdleCount=10,this.stopped=!0,this.parse=new n(this),this.eventQueue=[],this.lastParsedEventQueue=[],this.lastBlockResultQueue=[],this.statementQueue=[],this.listenerQueue=[],this.stopPoints=[],this.burst=a.BURST,this.logger._info("SB4Engine init .. "+t)}function l(){this.queue=[]}function h(t,e,i,s){this.c=t,this.method=e,this.arguments=i,this.id=s}return a.BURST=20,a.STATUS_SLEEP="sleep",a.STATUS_DEAD="dead",a.STATUS_IDLE="idle",a.STATUS_BUSY="busy",a.MODE_GOTO_PAGE="gotoPage",a.MAX_TITCK=50,a.prototype._workProcess=function(){var t=this;if(this.status==a.STATUS_DEAD)return this.logger._debug("SB4Engine is dead, ignoring _work tick"),!1;if(this.status==a.STATUS_BUSY)return this.logger._debug(" is busy"),!1;if(this.status==a.STATUS_SLEEP)return this.logger._debug(" is sleep"),!1;{if(!(this.taskQueue.length()>0)){if(this.statementQueue.length>0){this.idleCount=0;var i=this.statementQueue.shift();return this._processStatement(i),!1}var s=!1;if(this.eventQueue.length>0){var r=this.eventQueue.shift();this._parseEvent(r)}else this.idleCount=this.idleCount+1,s=!0;return this.idleCount>this.maxIdleCount&&(this.status=a.STATUS_SLEEP,clearInterval(this.timer),clearTimeout(this.timer),this.timer=-1,s=!0),!s}this.status=a.STATUS_BUSY,this.idleCount=0;var n=this.taskQueue.first(),o=e.clone(this.stopPoints);if(this.stopPoints=[],e.size(o)>0&&e.each(o,function(e,i){t.logger._debug("stop point deferred resolve"),e.resolve()}),this.status==a.STATUS_SLEEP)return this.logger._debug(" is sleep after resolve stop point deferred"),!1;try{n._process()&&this.taskQueue&&(this.taskQueue.shift(),this.taskQueue.length()>0?(this.status=a.STATUS_BUSY,this.idleCount=0,o=e.clone(this.stopPoints),this.stopPoints=[],e.size(o)>0&&e.each(o,function(e,i){t.logger._debug("stop point deferred resolve"),e.resolve()}),n=this.taskQueue.first(),(null==n||n._process())&&(this.status=a.STATUS_IDLE)):this.status=a.STATUS_IDLE)}catch(l){if(null!=this.taskQueue&&this.taskQueue.length()>0){var h=this.taskQueue.shift();e.isFunction(h.c.reject)&&(h.c.reject(),this.logger._warn("remove error task"))}this.status!=a.STATUS_DEAD&&(this.status=a.STATUS_IDLE),this.logger._warn("engine work process error: "+l.name+" : "+l.message)}}},a.prototype.start=function(i){if(this.logger._debug(" start, isParentCall: "+i+" ,startFlag:"+this.startFlag),this.idleCount=0,i||(this.startFlag=!0),(!i||this.startFlag)&&this.status==a.STATUS_SLEEP){this.status=a.STATUS_IDLE;var s=this;this.timer=setInterval(function(){for(var t=s.burst;--t>0;){var e=s._workProcess();if(0==e)break}},this.tick),1==this.stopped&&e.each(e.values(this.objctx.map),function(t,i){r.isWgt(t)&&e.isFunction(t._play)&&t._play()}),this.stopped=!1}this.status!=a.STATUS_DEAD&&t.each(this.subEngines,function(t,e){e.status==a.STATUS_SLEEP&&e.start(!0)})},a.prototype.stop=function(i){if(this.logger._info(" stop "+i),this.status!=a.STATUS_DEAD&&t.each(this.subEngines,function(t,e){e.stop(!0)}),i||(this.startFlag=!1),this.status!=a.STATUS_DEAD){if(this.status==a.STATUS_SLEEP){var s=this;0==this.stopped&&e.each(e.keys(this.objctx.map),function(t,i){var n=s.objctx.map[t];r.isWgt(n)&&n.options._i==t&&e.isFunction(n._stop)&&n._stop()})}this.status=a.STATUS_SLEEP,clearInterval(this.timer),clearTimeout(this.timer),this.timer=-1,this.idleCount=0,this.stopped=!0}},a.prototype.destroy=function(){this.logger._info(" destroy "),this.status!=a.STATUS_DEAD&&t.each(this.subEngines,function(t,e){e.destroy()}),this.stop(),this.status=a.STATUS_DEAD,this.timer=void 0,this.taskQueue=void 0,this.subEngines=void 0,this.objctx=void 0,this.eventQueue=void 0,this.statementQueue=void 0,this.eventMap=void 0,this.dynamicEventMap=void 0,this.parse=void 0,this.lastParsedEventQueue=void 0,this.lastBlockResultQueue=void 0},a.prototype.addEngine=function(t){this.subEngines.push(t)},a.prototype.addSubEngine=function(t,i){e.str.isBlank(t)&&(t=e.uniqueId(this.id+"_"));var s=new a(t,1.1*this.tick,this.objctx.fork(),i);return this.subEngines.push(s),s},a.prototype._purgeSubEngine=function(){if(this.status!=a.STATUS_DEAD)for(var t=this.subEngines.length-1;t>=0;t--)this.subEngines[t].status==a.STATUS_DEAD&&(this.logger._debug("  _purgeSubEngine, removed "+this.subEngines[t].id),this.subEngines.splice(t,1))},a.prototype.isSubEnginesInState=function(t){var i=e.find(this.subEngines,function(e){return void 0!=e&&e.status!=t?!0:void 0});return void 0!=i?!1:!0},a.prototype.getSubEngineByID=function(i){var s;return!e.str.isBlank(i)&&e.size(this.subEngines)>0&&t.each(this.subEngines,function(t,e){i==e.id&&(s=e)}),s},a.prototype._longTaskFinish=function(t){this.logger._debug("_longTaskFinish ",t,this.results),this.status!=a.STATUS_DEAD&&(void 0!=t&&this.results.push(t),this.status=a.STATUS_IDLE)},a.prototype.addEngineEventListener=function(t){e.contains(this.listenerQueue,t)||"onEngineEvent"in t&&this.listenerQueue.push(t)},a.prototype.removeEngineEventListener=function(e){var i=this;t.each(this.listenerQueue,function(t,s){return s===e?(i.listenerQueue.splice(t,1),!1):void 0})},a.prototype.registerEvent=function(e,i){if(this.status!=a.STATUS_DEAD){var s=this;t.each(e,function(e,r){var n=s.eventMap[r];if(void 0==n&&(n=[],s.eventMap[r]=n),t.isArray(i))for(var o=0;o<i.length;o++)i[o].id=r,n.push(i[o]);else i.id=r,n.push(i)})}},a.prototype.registerDynamicEvent=function(t,e,i){if(this.status!=a.STATUS_DEAD){var s={};s.condition=e,s.expr=i;var r=this.dynamicEventMap[t];r?r.push(s):(r=[],r.push(s),this.dynamicEventMap[t]=r)}},a.prototype.addEvent=function(i,s,r){var n=this;this.status!=a.STATUS_DEAD&&(this.eventQueue.push([i,s,r]),this.logger._info(" addEvent ",i,s,r),"flow"==i&&e.string.startsWith(s,"evt://")&&null!=r&&r.broadcast&&SB4API.onGlobalEventListener(i+"."+s,r["[evtval]"]),null!=r&&r.broadcast?(this.status==a.STATUS_SLEEP&&this.start(),t.each(this.listenerQueue,function(t,e){e.onEngineEvent(n,i,s,r)})):"flow"==i&&"load"==s||(this.status==a.STATUS_SLEEP&&this.start(),t.each(this.listenerQueue,function(t,e){e.onEngineEvent(n,i,s,r)})))},a.prototype._parseEvent=function(i){var s=!0,o=this,a=i[0],l=r.parseString(i[1]),h=i[2];o.objctx.remove("[evt_k.key]"),o.objctx.remove("[evt_k]");var c=a+"."+l;if(0==l.indexOf("sb4_evtx")){if("sb4_evtx_a"==l)c=a+"."+h.src.options._d.type+"."+h.v+"."+l;else if(l==n.EVTX_KEY){var u=SB4API.LEGACY_KEYMAP[h.evt.key];void 0==u&&(u=h.evt.key),c=a+"."+h.op+"."+u+"."+l,o.objctx.add("[evt_k.key]",u),o.objctx.add("[evt_k]",h.evt)}var d=this.dynamicEventMap[c];if(l==n.EVTX_KEY&&(d=e.union(d,this.dynamicEventMap[a+"."+h.op+".[any]."+l])),d&&d.length>0){var p=!1;if(h&&h.remove&&(p=h.remove())){var f=[];t.each(o.eventQueue,function(t,e){var i=e[0],s=r.parseString(e[1]),n=i+"."+s;"sb4_evtx_a"==l&&(n=i+"."+e[2].src.options._d.type+"."+e[2].v+"."+s),c==n&&f.push(e)}),t.each(f,function(t,i){o.eventQueue=e.without(o.eventQueue,i)})}t.each(d,function(r,n){var a={},c=t.Deferred(),u=c;t.each(t(n.condition).children(),function(e,i){"value"==t(i).prop("tagName")?u=u.then(function(){o.parse.setDisableStopPoint(!0);var e=t.Deferred();return next1=o.parse.parseBlock(t(i).find("block:first"),e),next2=next1.then(function(e){o.parse.setDisableStopPoint(!1),a[t(i).attr("name")]=e}),e.resolve(),next2}):"field"==t(i).prop("tagName")?u=u.then(function(){a[t(i).attr("name")]=t(i).html()}):"mutation"==t(i).prop("tagName")&&(u=u.then("sb4_evtx_path"==l?function(){a.src=o.objctx.get(t(i).attr("pid"))}:function(){t(i).attr("name")&&(a[t(i).attr("name")]=t(i).attr(t(i).attr("name")))}))}),u=u.then(function(){o.logger._info("sb4_evtx result ",a);var r=e.keys(a);if(r.length>0){var l=!0;t.each(r,function(i,s){e.isArray(h[s+"_list"])&&e.isArray(a[s])?t.each(h[s+"_list"],function(t,i){e.contains(a[s],i)||(l=!1)}):"[any]"==h[s]||e.isEqual(a[s],h[s])||(l=!1)}),l&&(h&&h.src?o.objctx.add("[source]",h.src):o.objctx.get(i[0])?o.objctx.add("[source]",o.objctx.get(i[0])):o.objctx.add("[source]",null),s=!1,o._recordEvent(i),o.statementQueue.push(n.expr))}}),c.resolve()})}else{var g=h.WGT;g&&("sb4_evtx_a"==l&&(c=h.v+"."+l),this.objctx.get(g.options._i,!0)&&g.addIgnoreEvent(c))}}else{var v=this.eventMap[c];if(("key_d"==a||"key_u"==a)&&(v=e.union(v,this.eventMap[a+".[any]"]),o.objctx.add("[evt_k.key]",l),o.objctx.add("[evt_k]",h)),void 0!=v&&v.length>0)t.each(v,function(s,n){var a=!1;if(h&&h.remove&&(a=h.remove())){var l=[];t.each(o.eventQueue,function(t,e){var i=e[0],s=r.parseString(e[1]),n=i+"."+s;c==n&&l.push(e)}),t.each(l,function(t,i){o.eventQueue=e.without(o.eventQueue,i)})}o._recordEvent(i),o.statementQueue.push(n)}),s=!1;else{var g=this.objctx.get(a,!0);g&&g.addIgnoreEvent(l)}h&&h.src?o.objctx.add("[source]",h.src):o.objctx.get(i[0])?o.objctx.add("[source]",o.objctx.get(i[0])):o.objctx.add("[source]",null),h&&o.objctx.add("[evtval]",h["[evtval]"])}if(s)if(this.eventQueue.length>0&&this.eventIdleCount<this.maxEventIdleCount){this.eventIdleCount++;var i=this.eventQueue.shift();this._parseEvent(i)}else this.eventIdleCount=0;else this.eventIdleCount=0},a.prototype.parseXml=function(t){this.status!=a.STATUS_DEAD&&this.parse.parse(t)},a.prototype.addFunctionTask=function(e,i,r,n){var a=t.Deferred(),l=a.then(function(){return s.invoke(e,i,r)}),h=this.parse.createStopPoint(l),c=new o(a,h,n);this.taskQueue.push(c)},a.prototype._processStatement=function(i){if(this.logger._debug(" _processStatement ",i),e.isFunction(i)){var s=t.Deferred(),r=s.then(function(){return i()}),a=this.parse.createStopPoint(r),l=new o(s,a,"");this.taskQueue.push(l)}else{this.parse=new n(this);var h=this,s=t.Deferred();try{var r=this.parse.parseBlock(i.find("block:first"),s);r=this.parse.createStopPoint(r);var l=new o(s,r,i.id);r.fail(function(){h.logger._info("fail task and change status to idle")}),this.taskQueue.push(l)}catch(c){throw c}}},a.prototype.fork=function(i){var s=this.addSubEngine(e.uniqueId(this.id+"_"),i);for(t.each(this.listenerQueue,function(t,e){s.addEngineEventListener(e)});this.taskQueue.length()>0;)s.taskQueue.push(this.taskQueue.shift());return s.parse=this.parse,this.parse.engine=s,this.addDestroySubEngineTask(s),this.objctx=this.initObjctx,this.status=a.STATUS_IDLE,s},a.prototype.addDestroySubEngineTask=function(t){var e=this,i=function(){t.isSubEnginesInState(a.STATUS_DEAD)?(t.parse.engine=e,t.destroy(),e._purgeSubEngine()):(t.statementQueue.push(i),t.status=a.STATUS_IDLE)};t.statementQueue.push(i)},a.prototype.interrupt=function(t){a.MODE_GOTO_PAGE==t&&(this.taskQueue.shift(),this.status=a.STATUS_IDLE)},a.prototype.getWgtByID=function(t){return this.objctx.get(t)},a.prototype.invokeWidgetMethod=function(t,e,i){return s.invokeWgtMethod(t,e,i)},a.prototype._recordEvent=function(t){e.size(this.lastParsedEventQueue)>=10&&this.lastParsedEventQueue.pop();var i=t[2],s;s=i&&i.src?i.src:this.objctx.get(t[0])?this.objctx.get(t[0]):t[0],e.isObject(s)&&(s=s.options._n);var r={};r.obj=s,r.name=t[1],this.lastParsedEventQueue.push(r)},a.prototype.addStopPoint=function(t){this.stopPoints.push(t)},a.prototype._recordBlockResult=function(t,i){i=r.stringify(i),e.size(this.lastBlockResultQueue)>=10&&this.lastBlockResultQueue.pop();var s={};s[t]=i,this.lastBlockResultQueue.push(s)},l.prototype.shift=function(){return this.queue.shift()},l.prototype.push=function(t){this.queue.push(t)},l.prototype.unshift=function(t){this.queue.unshift(t)},l.prototype.first=function(){return e.first(this.queue)},l.prototype.length=function(){return this.queue.length},h.prototype._process=function(){return s.invoke(this.c,this.method,this.arguments)},a}),define("sb4core/textlib",[],function(){function t(t,e,i,s){this.glyphReg=t,this.textReg=e,this.ctx=i.getContext("2d"),this.dscratchpad=s}window.DEBUG,"undefined"==typeof escapeHtmlEntities&&(escapeHtmlEntities=function(t){return t.replace(/[\u00A0-\uffff<>\&]/g,function(t){return"&"+(escapeHtmlEntities.entityTable[t.charCodeAt(0)]||"#"+t.charCodeAt(0))+";"})},escapeHtmlEntities.entityTable={34:"quot",38:"amp",39:"apos",60:"lt",62:"gt",160:"nbsp",161:"iexcl",162:"cent",163:"pound",164:"curren",165:"yen",166:"brvbar",167:"sect",168:"uml",169:"copy",170:"ordf",171:"laquo",172:"not",173:"shy",174:"reg",175:"macr",176:"deg",177:"plusmn",178:"sup2",179:"sup3",180:"acute",181:"micro",182:"para",183:"middot",184:"cedil",185:"sup1",186:"ordm",187:"raquo",188:"frac14",189:"frac12",190:"frac34",191:"iquest",192:"Agrave",193:"Aacute",194:"Acirc",195:"Atilde",196:"Auml",197:"Aring",198:"AElig",199:"Ccedil",200:"Egrave",201:"Eacute",202:"Ecirc",203:"Euml",204:"Igrave",205:"Iacute",206:"Icirc",207:"Iuml",208:"ETH",209:"Ntilde",210:"Ograve",211:"Oacute",212:"Ocirc",213:"Otilde",214:"Ouml",215:"times",216:"Oslash",217:"Ugrave",218:"Uacute",219:"Ucirc",220:"Uuml",221:"Yacute",222:"THORN",223:"szlig",224:"agrave",225:"aacute",226:"acirc",227:"atilde",228:"auml",229:"aring",230:"aelig",231:"ccedil",232:"egrave",233:"eacute",234:"ecirc",235:"euml",236:"igrave",237:"iacute",238:"icirc",239:"iuml",240:"eth",241:"ntilde",242:"ograve",243:"oacute",244:"ocirc",245:"otilde",246:"ouml",247:"divide",248:"oslash",249:"ugrave",250:"uacute",251:"ucirc",252:"uuml",253:"yacute",254:"thorn",255:"yuml",402:"fnof",913:"Alpha",914:"Beta",915:"Gamma",916:"Delta",917:"Epsilon",918:"Zeta",919:"Eta",920:"Theta",921:"Iota",922:"Kappa",923:"Lambda",924:"Mu",925:"Nu",926:"Xi",927:"Omicron",928:"Pi",929:"Rho",931:"Sigma",932:"Tau",933:"Upsilon",934:"Phi",935:"Chi",936:"Psi",937:"Omega",945:"alpha",946:"beta",947:"gamma",948:"delta",949:"epsilon",950:"zeta",951:"eta",952:"theta",953:"iota",954:"kappa",955:"lambda",956:"mu",957:"nu",958:"xi",959:"omicron",960:"pi",961:"rho",962:"sigmaf",963:"sigma",964:"tau",965:"upsilon",966:"phi",967:"chi",968:"psi",969:"omega",977:"thetasym",978:"upsih",982:"piv",8226:"bull",8230:"hellip",8242:"prime",8243:"Prime",8254:"oline",8260:"frasl",8472:"weierp",8465:"image",8476:"real",8482:"trade",8501:"alefsym",8592:"larr",8593:"uarr",8594:"rarr",8595:"darr",8596:"harr",8629:"crarr",8656:"lArr",8657:"uArr",8658:"rArr",8659:"dArr",8660:"hArr",8704:"forall",8706:"part",8707:"exist",8709:"empty",8711:"nabla",8712:"isin",8713:"notin",8715:"ni",8719:"prod",8721:"sum",8722:"minus",8727:"lowast",8730:"radic",8733:"prop",8734:"infin",8736:"ang",8743:"and",8744:"or",8745:"cap",8746:"cup",8747:"int",8756:"there4",8764:"sim",8773:"cong",8776:"asymp",8800:"ne",8801:"equiv",8804:"le",8805:"ge",8834:"sub",8835:"sup",8836:"nsub",8838:"sube",8839:"supe",8853:"oplus",8855:"otimes",8869:"perp",8901:"sdot",8968:"lceil",8969:"rceil",8970:"lfloor",8971:"rfloor",9001:"lang",9002:"rang",9674:"loz",9824:"spades",9827:"clubs",9829:"hearts",9830:"diams",338:"OElig",339:"oelig",352:"Scaron",353:"scaron",376:"Yuml",710:"circ",732:"tilde",8194:"ensp",8195:"emsp",8201:"thinsp",8204:"zwnj",8205:"zwj",8206:"lrm",8207:"rlm",8211:"ndash",8212:"mdash",8216:"lsquo",8217:"rsquo",8218:"sbquo",8220:"ldquo",8221:"rdquo",8222:"bdquo",8224:"dagger",8225:"Dagger",8240:"permil",8249:"lsaquo",8250:"rsaquo",8364:"euro"}),CanvasRenderingContext2D.prototype.clear=CanvasRenderingContext2D.prototype.clear||function(t){t&&(this.save(),this.setTransform(1,0,0,1,0,0)),this.clearRect(0,0,this.canvas.width,this.canvas.height),t&&this.restore()},t.prototype._applyFontformat=function(t,e,i){if(null!=e){if(void 0!=e["class"]&&t.addClass(e["class"]),void 0!=e.fontSize){var s=parseInt(e.fontSize*i);t.css("font-size",s+"px")}void 0!=e.fontFamily&&t.css("font-family",'"'+e.fontFamily+'"'),void 0!=e.fontWeight&&t.css("font-weight",e.fontWeight),void 0!=e.fontStyle&&t.css("font-style",e.fontStyle)}},t.prototype.stringToHtml=function(t){for(var e=[],i=t.split(/\n/),s=jQuery(document.createElement("div")),r=0;r<i.length;r++)e.push(i[r]);return e.join("<br>")},t.prototype.drawDivText=function(t,e,i,s,r,n,o,a,l,h,c){var u=s,d=r;d=d.replace(new RegExp("\r\n","g"),"\n"),d=d.replace(new RegExp("\r","g"),"\n"),d=escapeHtmlEntities(d),d=d.replace(new RegExp("  ","g")," &nbsp;"),r=d,r=this.stringToHtml(r),s=$(this.dscratchpad),s.css({}),s.css({visibility:"hidden",position:"absolute",height:"auto",width:"auto"}),void 0!=h&&h>0&&(s.css("display","block"),s.css("width",h)),this._applyFontformat(s,o,n),null!=l&&s.css("color",l),1==a?s.css("text-align","center"):2==a?s.css("text-align","right"):s.css("text-align","left");var p=[];$(this.dscratchpad).css("word-wrap","break-word"),$(this.dscratchpad).html(r);var f=$(this.dscratchpad).get(0).getBoundingClientRect();return p[0]=Math.ceil(f.width),p[1]=Math.ceil(f.height),$(this.dscratchpad).empty(),$(this.dscratchpad).css("word-wrap","normal"),s=$(u),s.css("word-wrap","break-word"),this._applyFontformat(s,o,n),null!=l&&s.css("color",l),1==a?s.css("text-align","center"):2==a?s.css("text-align","right"):s.css("text-align","left"),h>=0&&(s.width(p[0]),s.height(p[1])),s.html(r),null!=c&&""!=c&&(s.off("click"),s.click(function(){SB4API.linkLib.handleLinkData(t,c)})),p.push(!1),c&&(s.removeClass("notouch"),s.addClass("cursor_pointer")),p},t.prototype.drawDivRichText=function(t,e,i,s,r,n,o,a,l,h){s=$(s),o&&this._applyFontformat(s,o,n),s.html(r),$("a",s).length>0&&(s.removeClass("notouch"),$("a",s).each(function(){var e=$(this).attr("href");_.string.startsWith(e,"evt://")&&($(this).removeAttr("onclick"),$(this).click(function(e){e.preventDefault();var i=$(this).attr("href");if(i){var s=i.split("::");if(void 0!=s[2]&&""!=s[2]){var r=s[2].split(",");void 0==s[0]&&(s[0]=""),void 0==s[1]&&(s[1]=""),s[1]=_.string.trim(r[0]," '");var n=r.splice(1);s[2]=_.string.trim(n.join()," '")}SB4API.linkLib.openHyperLink(t,s[0],s[1],s[2])}}))})),s.css("width",h)},t.prototype.drawText=function(t,e,i,s,r,n,o,a,l,h,c,u,d){if((void 0==r||""==r)&&(a=!1,r=""),$(s).addClass("notouch"),void 0==a||1==a){var p=e+"."+i;
this.ctx.clear();var f=void 0;if(this.textReg&&(f=this.getTextRegData(p)),f){var g=this.feelText(f,n);this.ctx.canvas.width=g[0],this.ctx.canvas.height=g[1];var v=this.drawTextByCode(p,n,c,d),m=$("canvas:first-child",s);0==m.length?(m=document.createElement("canvas"),$(s).append(m)):m=m[0],m.id=e+"."+i,m.width=g[0],m.height=g[1],$(m).addClass("notouch"),m.height<10&&$(m).addClass("text");var b=m.getContext("2d");b.drawImage(this.ctx.canvas,0,0);var x=this.glyphReg.linkData;if(_.isEmpty(x)&&null!=d&&(x=d),!_.isEmpty(x)&&v.length>0){$(s).removeClass("notouch"),$(m).removeClass("notouch");var y=null;null!=d?($(s).addClass("cursor_pointer"),y=function(e){if((1==e.which||"mousemove"==e.type)&&"mousemove"!=e.type){var i=_.find(v,function(t){return e.offsetX>=t[0]&&e.offsetX<=t[2]&&e.offsetY>=t[1]&&e.offsetY<=t[3]});void 0!=i&&SB4API.linkLib.handleLinkData(t,d)}}):y=function(e){if(1==e.which||"mousemove"==e.type){var i=_.find(v,function(t){return e.offsetX>=t[0]&&e.offsetX<=t[2]&&e.offsetY>=t[1]&&e.offsetY<=t[3]});if(void 0==i)return void $(s).removeClass("cursor_pointer");if("mousemove"==e.type)return void $(s).addClass("cursor_pointer");var r=x[i[4]];if(void 0!=r){var n=r.split("::");if(void 0!=n[2]&&""!=n[2]){var o=n[2].split(",");void 0==n[0]&&(n[0]=""),void 0==n[1]&&(n[1]=""),n[1]=_.string.trim(o[0]," '");var a=o.splice(1);n[2]=_.string.trim(a.join()," '")}SB4API.linkLib.openHyperLink(t,n[0],n[1],n[2])}}},m.addEventListener("mousedown",y,!1),m.addEventListener("mousemove",y,!1)}return g}return o?this.drawDivRichText(t,e,i,s,r,n,l,h,c,u):this.drawDivText(t,e,i,s,r,n,l,h,c,u,d)}return o?this.drawDivRichText(t,e,i,s,r,n,l,h,c,u):this.drawDivText(t,e,i,s,r,n,l,h,c,u,d)},t.prototype.thinStroke=function(t){return t;var e=Math.floor(t);return e===t&&(e=t+.5),e},t.prototype.drawGlyph=function(t,e,i,s,r,n){for(var o=this.getGlyphData(t),a=o.length,l=0,h=0;a>h;h++){switch(t=o[h],t.o){case 1:var c=r*t.d[0]+i,u=n*t.d[1]+s;c=this.thinStroke(c),u=this.thinStroke(u),e.moveTo(c,u);break;case 2:var c=r*t.d[0]+i,u=n*t.d[1]+s;c=this.thinStroke(c),u=this.thinStroke(u),e.lineTo(c,u);break;case 3:var d=r*t.d[0]+i,p=n*t.d[1]+s,f=r*t.d[2]+i,g=n*t.d[3]+s,v=r*t.d[4]+i,m=n*t.d[5]+s;e.bezierCurveTo(d,p,f,g,v,m),l=Math.max(l,n*t.d[5]+s);break;case 4:e.closePath()}t.o>0&&4!=t.o&&null==t.d,t.o>0&&null!=t.d&&(l=Math.max(l,n*t.d[1]+s))}return l},t.prototype.getGlyphData=function(t){var e=this.glyphReg.data[t];if(void 0==e&&(e=[]),e instanceof Array)return e;for(var i=e.split(","),s=[],r=0;r<i.length;r++){var n=i[r],o={};o.o=n.length%6==0?2:parseInt(n.substring(0,1),10),o.d=[];var a;if(a=n.length%6==0?n:n.substring(1),a.length>0)for(var l=a.length/6,h=0;l>h;h++){var c=a.substring(6*h,6*(h+1)),u=(this.revertDate(this.clearChars(c.substring(0,3)))/10).toString(),d=(this.revertDate(this.clearChars(c.substring(3,6)))/10).toString();o.d.push(u,d)}s.push(o)}return this.glyphReg.data[t]=s,this.glyphReg.data[t]},t.prototype.revertDate=function(t){if(t.length>1){var e,i=parseInt(t,36),s=parseInt(t.charAt(0),36);if(0==s)e=parseInt(t.substring(1),36);else{var r=this.isPositive(i);e=-1==r.positive?-1*(Math.pow(36,r.digit)-i):i}return e}var e=parseInt(t,36);return e>18&&(e=-1*(36-e)),e},t.prototype.isPositive=function(t){var e={},i=0,s=0,r=18*Math.pow(36,i),n=Math.pow(36,i+1);do t>=s&&r>=t?e.positive=1:t>r&&n>t&&(e.positive=-1),i++,s=Math.pow(36,i),r=18*Math.pow(36,i)-1,n=Math.pow(36,i+1);while(t>=s);return 0==e.positive,e.digit=i,e},t.prototype.clearChars=function(t){for(;t.length>1&&"#"==t.charAt(0);)t=t.substring(1);return t},t.prototype.getTextRegData=function(t){var e=this.textReg[t];if(void 0==e)return void 0;if(null!=e.refid&&(t="@"+e.refid,e=this.textReg[t],void 0==e))return void 0;if("object"==typeof e&&e.chars instanceof Array)return e;for(var i={},s=[],r=e.chars.split(","),n=-1,o=-1,a=-1,l=0;l<r.length;l++){var h={},c=r[l],u=c.split("|"),d={};4==u[0].length?(h.mode=0,d.width=parseInt(u[0].substring(0,2),36),d.height=parseInt(u[0].substring(2,4),36)):(h.mode=parseInt(u[0].charAt(0)),d.width=parseInt(u[0].substring(1,3),36),d.height=parseInt(u[0].substring(3,5),36)),h.size=d;var p={};p.x=this.revertDate(u[1]),p.y=this.revertDate(u[2]),h.pos=p,"0"==u[3]?a=-1:""==u[3]?-1!=a&&(h.link=a):(a=u[3],h.link=a),""==u[4]?h.color=n:(n=u[4],h.color=n),h.vectorCode=u[5],7==u.length&&(""==u[6]?h.bgcolor=o:(o=u[6],h.bgcolor=o)),s.push(h)}return i.chars=s,i.size=e.size,this.textReg[t]=i,this.textReg[t]},t.prototype.drawTextByCode=function(t,e,i,s){null==e&&(e=1);var r=void 0,n=[],o=this.getTextRegData(t);if(o){for(var t=0;t<o.chars.length;t++){var a=o.chars[t],l=a.vectorCode,h=this.getGlyphData(l),c=null;if(h.length>0&&0==h[0].o&&(c=h[0].d),void 0!=i?r=i.toString():void 0!=a.color&&(r=this.glyphReg.colorData[a.color],r=this.hex2RGBA(r)),null!=c){if(this.ctx.beginPath(),a.bgcolor){var u=this.glyphReg.colorData[a.bgcolor];u=this.hex2RGBA(u),this.ctx.fillStyle=u,this.ctx.fillRect(a.pos.x,a.pos.y,a.size.width,a.size.height)}this.ctx.beginPath(),this.ctx.fillStyle=r;var d=a.size.width/c[0],p=a.size.height/c[1];this.drawGlyph(l,this.ctx,a.pos.x*e,a.pos.y*e,d*e,p*e),this.ctx.fill()}if(void 0!=a.mode)switch(a.mode){case 1:this.ctx.beginPath(),this.ctx.arc(a.pos.x,a.pos.y,a.size.width/2,0,2*Math.PI,!0),this.ctx.fillStyle=r,this.ctx.fill(),this.ctx.closePath();break;case 2:break;case 4:}void 0!=s&&""!=s?n.push([a.pos.x,a.pos.y,a.pos.x+a.size.width,a.pos.y+a.size.height,s]):void 0!=a.link&&n.push([a.pos.x,a.pos.y,a.pos.x+a.size.width,a.pos.y+a.size.height,a.link])}return n}},t.prototype.feelText=function(t,e){void 0==e&&(e=1);var i=[0,0],s=!0;t.size&&(i[0]=t.size.width,t.size.width>=0&&(s=!1));for(var r=0;r<t.chars.length;r++){var n=t.chars[r],o=n.vectorCode,a=this.getGlyphData(o);if(0!=a.length){var l=null;if(0==a[0].o&&(l=a[0].d),null!=l){var h=n.pos.x+n.size.width,c=n.pos.y+n.size.height;s&&h>i[0]&&(i[0]=h),c>i[1]&&(i[1]=c)}}}return i[0]=i[0]*e,i[1]=i[1]*e,i},t.prototype.hex2RGBA=function(t){if(void 0==t)return"rgba(0, 0, 0, 0)";var e="rgba(0, 0, 0, 0)";if(6==t.length)e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t),e={r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16),a:255};else{if(8!=t.length)return e;e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t),e={r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16),a:parseInt(e[4],16)}}return"rgba("+e.r+","+e.g+","+e.b+","+e.a/255+")"};var e=document.createElement("div");e.id="textLibDiv",$(e).css("display","none");var i=document.createElement("canvas");i.id="textLibCanvas",i.width=2e3,i.height=2e3,i.style="border:0px solid #ffffff;",e.appendChild(i),document.body.appendChild(e);var s=document.createElement("div");s.id="divTextDiv",$(s).css({visibility:"hidden",position:"absolute",height:"auto",width:"auto"}),document.body.appendChild(s);var r=document.getElementById("textLibCanvas"),n=new t({},{},r,s);return n}),define("sb4core/SB4Debug",["sb4core/DataUtil"],function(t){function e(t){this.loEngine=t,this.breakPoint=!1,this.objctx=null}return e.prototype.getDebugInfo=function(){loEngine=_.clone(this.loEngine);var e=loEngine.subEngines[0],i=_.clone(e.objctx.get("_frame")),s=i.scene,r={};r.engine=this.getDebugEngine(i.sceneLocalEngine),r.folders=this.getSlideSets(i,e);var n={};return n["Page:["+s.name+"]"]=r,n["Global Variables"]=this.getGlobalVars(e),n["Local Variables"]=this.getLocalVars(this.objctx),t.stringifyStageJsonModel(n)},e.prototype.getDebugEngine=function(t){var e={};return e.id=t.id,e.status=t.status,e.lastParsedEvents=t.lastParsedEventQueue,e.lastBlockResults=t.lastBlockResultQueue,e},e.prototype.getGlobalVars=function(t){var e={},i="global ",s=t.objctx.map,r=_.keys(t.objctx.map);return _.each(r,function(t,r){0==t.indexOf(i)&&(e[t]=s[t]?s[t]:"[undefined]")}),e},e.prototype.getLocalVars=function(t){var e={},i=this;return null==t||_.has(t.map,"[ctx_type]")||(_.size(t.ctxlist)>0&&_.each(t.ctxlist,function(t,s){e=_.extend(i.getLocalVars(t),e)}),void 0!=t.extctx&&(e=_.extend(this.getLocalVars(t.extctx),e)),e=_.extend(e,t.map)),e},e.prototype.getSlideSets=function(e,i){var s=this,r=[],n=e.scene,o=_.indexBy(n.layers,"id"),a=e.mastermap;return _.each(n.slides,function(n,l){var h=t.trimRefString(n.$ref),c,u;o[h]?(u=o[h],c="L: "+u.name,u=s.parseSlideSet(o[h],e.sceneLocalEngine)):(u=a[h],c="M: "+u.name,u=s.parseSlideSet(a[h],i.getSubEngineByID(h)),u.engine=s.getDebugEngine(i.getSubEngineByID(h)));var d={};d[c]=u,r.push(d)}),r},e.prototype.parseSlideSet=function(e,i){var s=t.stringifyStageJsonModel(e);return e=JSON.parse(s),_.has(e,"slides")&&(e.layers=_.map(e.slides,function(t){var e={},s;return _.has(t,"widgets")&&(t.widgets=_.map(t.widgets,function(t){null==i.objctx.get(t.id)&&(t["._error"]=!0);var e={};return e[t.name]=_.pick(t,"id","type","._error"),e})),e[t.name]=_.pick(t,"widgets"),e})),_.pick(e,"layers")},e.prototype.onBreakPoint=function(e,i){this.onBreakPointExt&&(this.breakPoint=!0,this.objctx=i,this.loEngine.stop(!1),e.info=this.getDebugInfo(),this.onBreakPointExt(t.stringifyStageJsonModel(e)))},e.prototype.start=function(){this.breakPoint=!1,this.objctx=null,this.loEngine.start()},e}),define("sb4core/loplayer",["underscore","./sbobjfactory","sb4core/loloader","sb4core/ObjContext","sb4core/SB4Engine","sb4core/textlib","sb4core/SB4Debug"],function(t,e,i,s,r,n,o){var a={factory:null,play:function(){var a=t.find(i.lo.meta.entries,function(t){return"id"==t.id}),l="";null!=a&&(l=a.value),SB4API.getOrientation=function(){var t=window.orientation;if("number"==typeof t&&"object"==typeof window.onorientationchange)switch(t){case 90:case-90:t="landscape";break;default:t="portrait"}else t=window.innerWidth>window.innerHeight?"landscape":"portrait";return t},SB4API.isMobile={Android:function(){return navigator.userAgent.match(/Android/i)},AndroidNonTablet:function(){return SB4API.isMobile.Android()&&navigator.userAgent.match(/Mobile/i)&&!navigator.userAgent.match(/Kindle/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},iPhone:function(){return navigator.userAgent.match(/iPhone/i)},iOSNonTablet:function(){return navigator.userAgent.match(/iPhone|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return SB4API.isMobile.Android()||SB4API.isMobile.BlackBerry()||SB4API.isMobile.iOS()||SB4API.isMobile.Opera()||SB4API.isMobile.Windows()},anyPhone:function(){return SB4API.isMobile.AndroidNonTablet()||SB4API.isMobile.BlackBerry()||SB4API.isMobile.iOSNonTablet()||SB4API.isMobile.Opera()||SB4API.isMobile.Windows()}};var h=t.find(i.lo.meta.entries,function(t){return"profile"==t.id}),c=t.map(h.subs,function(t){var e=JSON.parse(t.value);return e.id=t.id,e});SB4API.profile={},SB4API.profile.selectProfile=function(){var e;if(SB4API.isMobile.any()){var i=document.documentElement.clientWidth,s=[],r=[],n=[],o=[],a=[],l;t.each(SB4API.profile.list,function(t,e){"PHONE"==t.t?t.w>t.h?s.push(t):n.push(t):"TABLET"==t.t?t.w>t.h?r.push(t):o.push(t):a.push(t)}),l="landscape"==SB4API.getOrientation()?SB4API.isMobile.anyPhone()&&s.length>0?s:r.length>0?r:a:SB4API.isMobile.anyPhone()&&n.length>0?n:o.length>0?o:a;var h=t.filter(l,function(t){return t.w<=i}),c=0;if(t.each(h,function(t,e){t.w>c&&(c=t.w)}),h=t.filter(h,function(t){return t.w==c}),0==h.length)e=l[0];else if(1==h.length)e=h[0];else if(h.length>1){h=t.sortBy(h,function(t){return t.h});var u=document.documentElement.clientHeight;e=t.find(h.reverse(),function(t){return t.h<u}),null==e&&(e=t.last(h))}}else{var i=document.documentElement.clientWidth,a=[],d=[];t.each(SB4API.profile.list,function(t,e){"PC"==t.t?a.push(t):d.push(t)});var h=t.filter(a,function(t){return t.w<=i});0==h.length&&(h=t.filter(d,function(t){return t.w<=i}));var c=0;if(t.each(h,function(t,e){t.w>c&&(c=t.w)}),h=t.filter(h,function(t){return t.w==c}),0==h.length)e=SB4API.profile.list[0];else if(1==h.length)e=h[0];else if(h.length>1){h=t.sortBy(h,function(t){return t.h});var u=document.documentElement.clientHeight;e=t.find(h.reverse(),function(t){return t.h<u}),null==e&&(e=t.last(h))}}if(SB4API.isMobile.any()){var p=document.querySelector('meta[name="viewport"]'),f;f="landscape"==SB4API.getOrientation()?SB4API.isMobile.anyPhone()?.9*Math.max(screen.height,screen.width)/e.w:Math.max(screen.height,screen.width)/e.w:screen.width/e.w,p.setAttribute("content","width="+e.w+", initial-scale="+f+",maximum-scale="+f+", minimum-scale="+f+" ,user-scalable=no")}return e},SB4API.profile.list=t.sortBy(c,function(t){return t.w}),SB4API.profile.current=SB4API.profile.selectProfile();var u=function(e,i){if(e){t.has(i,e.id)&&(e.time=i[e.id]);var s=e.flows;t.isArray(s)&&t.each(s,function(t,e){u(t,i)}),u(e.subflow,i)}},d=function(){SB4API.alignToBody(),H._util.floatWidgetsPosition()},p=t.throttle(d,250,{leading:!1}),f=function(){var t=SB4API.profile.current,e=SB4API.profile.selectProfile();if(t.id!=e.id){SB4API.profile.current=e,u(H.options._d,e.hMap),SB4API.showLoading(),H.preloadResourcesBeforeChangeProfile(),H.changeProfile(e),SB4API.hideLoading();var i={};i.broadcast=!1,i["[evtval]"]=e.d;for(var s=0;s<H.engine.subEngines.length;s++)H.engine.subEngines[s].addEvent("flow","pchange",i)}else p();if($("#playButton").length>0){var r=parseInt((document.documentElement.clientWidth-$("#playButton").width())/2)+"px",n=parseInt((document.documentElement.clientHeight-$("#playButton").height())/2)+"px";$("#playButton").css("left",r),$("#playButton").css("top",n)}},g="number"==typeof window.orientation&&"object"==typeof window.onorientationchange;if(g){var v=t.throttle(f,400,{leading:!1});window.addEventListener("orientationchange",v,!1)}else{var v=t.throttle(f,200,{leading:!1});$(window).resize(v)}window.onscroll=p,i.lo.lib&&(assetmap=t.clone(i.lo.lib)),SB4API.txtLib=n,SB4API.txtLib.glyphReg=i.text.glyphReg,SB4API.txtLib.textReg=i.text.textReg;var m=new s;if(t.isObject(SB4API.lms)&&SB4API.lms.type>0){var b=$.sb4.com_smartbuilder_axon_widget_data_track();b.lmsEnable=!0,m.add("scorm",b)}if(SB4XAPI.tincan){var _=$.sb4.com_smartbuilder_axon_widget_data_xapi();_.xapiEnable=!0,m.add("xapi",_),SB4XAPI.launchLesson()}if(!SB4API.queryMap){for(var x=window.location.search.substring(1),y={},w=x.split("&"),S=0;S<w.length;S++){var T=w[S].split("=");y[decodeURIComponent(T[0])]=decodeURIComponent(T[1])}SB4API.queryMap=y}var E=assetmap.audios,I=assetmap.videos;if(E>0||I>0){var C=$("<div id='media'></div>");C.hide(),C.appendTo("body");var A=E,B=I;if(A>=32&&(A=32),B>=32&&(B=32),"undefined"!=typeof window.orientation){for(var k=0;A>k;k++){var P=$("<audio  src ='app/empty.mp3' class='audio-unused'></audio>");P.appendTo("#media")}for(var k=0;B>k;k++){var O=$("<video src ='app/empty.mp4' class='video-unused'></video>");O.appendTo("#media")}}else{if(E>0){var P=$("<audio  src ='app/empty.mp3' class='audio-unused'></audio>");P.appendTo("#media")}if(I>0){var O=$("<video src ='app/empty.mp4' class='video-unused'></video>");O.appendTo("#media")}}$(document).ready(function(){$("#playFull").show(),$("#playFull").html('<div id="playButton" style="width: 150px;height: 150px;position:absolute;"><svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"	 width="150px" height="150px" viewBox="0 0 92 92" enable-background="new 0 0 92 92" xml:space="preserve"><g>	<path fill="#6B6B6B" d="M46,8c20.953,0,38,17.047,38,38S66.953,84,46,84C25.047,84,8,66.953,8,46S25.047,8,46,8 M46,1		C21.147,1,1,21.147,1,46c0,24.854,20.147,45,45,45c24.851,0,45-20.146,45-45C91,21.147,70.852,1,46,1L46,1z"/>	<path fill="#6B6B6B" d="M38.167,25.147c-0.368,0-0.736,0.085-1.077,0.257c-0.802,0.406-1.309,1.229-1.309,2.129v37.725		c0,0.899,0.506,1.723,1.309,2.129c0.34,0.172,0.71,0.257,1.077,0.257c0.5,0,0.996-0.156,1.414-0.463l25.667-18.863		c0.611-0.45,0.973-1.164,0.973-1.923c0-0.759-0.361-1.473-0.973-1.923L39.58,25.61C39.163,25.304,38.666,25.147,38.167,25.147		L38.167,25.147z"/></g></svg></div>');var t=parseInt((document.documentElement.clientWidth-$("#playButton").width())/2)+"px",e=parseInt((document.documentElement.clientHeight-$("#playButton").height())/2)+"px";$("#playButton").css("left",t),$("#playButton").css("top",e),$("#playFull").on("click",function(){$.each($("audio"),function(t,e){e.play(),e.pause()}),$.each($("video"),function(t,e){e.play(),e.pause(),e.setAttribute("src",""),e.load()}),"undefined"!=typeof window.orientation||$("#media").empty(),$("#playFull").remove();var t=V.subEngines[0],e=t.objctx.get("_frame"),i=e.objctx.get("playFull_newLayers"),s=e.objctx.get("playFull_scene");e.afterRenderScene(i,s),e.objctx.remove("playFull_newLayers"),e.objctx.remove("playFull_scene")})})}else $("#playFull").remove(),$(document).ready(function(){t.isObject(SB4API.lms)&&SB4API.lms.type>0&&$(window).on("beforeunload",function(){return unloadPage("incomplete")})});var D=t.find(i.lo.meta.entries,function(t){return"bgchoice"==t.id});if(0==D.value){var L=t.find(i.lo.meta.entries,function(t){return"bgcolor"==t.id});null!=L.cid?$("body").css("background-color","#"+L.cid):$("body").css("background-color","rgb("+L.R+","+L.G+","+L.B+")")}else{var M=t.find(i.lo.meta.entries,function(t){return"bgimage"==t.id});$("body").css("background-image","url("+SB4API.util.getWidgetAssetURI(M.key)+")"),$("body").css("background-repeat","repeat")}SB4API.topSB4EngienContext=m;var V=new r(l,null,m);if(V.objctx.add("[ctx_type]","lo"),this.factory=new e(V),window.location.hash){var R={};R.eClass="http://axon.smartbuilder.com/model/lo#//StrData",R.id="selectedScene",R.value=window.location.hash.substring(1),i.lo.frame.data.entries.push(R)}var j=this.factory._createObjDiv($("#playerstage"));$(j).css("visibility","hidden");var W=i.lo.frame;W.bounds.w=SB4API.profile.current.w,W.bounds.h=SB4API.profile.current.h,u(W.flow,SB4API.profile.current.hMap);var N=this.factory.create(j,W),F=t.find(i.lo.meta.entries,function(t){return"align"==t.id}),Q="",U="";if(0==F.value?(Q="left, top",U="left, top"):1==F.value?(Q="center top",U="center top"):(Q="right, top",U="right, top"),SB4API.alignToBody=function(){SB4API.isMobile.any()?"landscape"==SB4API.getOrientation()?$(j).css("left",parseInt(($("body").width()-$(j).width())/2)+"px"):$(j).css("left","0px"):$(j).position({my:Q,at:U,collision:"fit",of:"body"}),$(j).css("top","0px")},SB4API.alignToBody(),"undefined"==typeof window.orientation){var z=t.debounce(SB4API.alignToBody,300);$(window).resize(z)}this.factory._activateObjDiv(j,void 0!=N),$(j).css("visibility","inherit");var H=m.get(N.attr("id")),q=new o(V);SB4API.debug=q,$(document).keydown(function(t){if(SB4API.KEY_DOWN_YES){t.broadcast=!0;var e=SB4API.LEGACY_KEYMAP[t.key];void 0==e&&(e=t.key),H.onEngineEvent(V,"key_d",t.key,t)}}),$(document).keyup(function(t){if(SB4API.KEY_UP_YES){t.broadcast=!0;var e=SB4API.LEGACY_KEYMAP[t.key];void 0==e&&(e=t.key),H.onEngineEvent(V,"key_u",t.key,t)}}),$("#lesson_begin").focus(function(){SB4TabOrder.current="begin",0!=t.size(SB4TabOrder.previousOrder)&&0==t.size(SB4TabOrder.nextOrder)&&(SB4TabOrder.nextOrder=SB4TabOrder.previousOrder.slice(0),SB4TabOrder.nextOrder=SB4TabOrder.nextOrder.reverse(),SB4TabOrder.previousOrder=[])}),$("#lesson_end").focus(function(){SB4TabOrder.current="end",0==t.size(SB4TabOrder.previousOrder)&&0!=t.size(SB4TabOrder.nextOrder)&&(SB4TabOrder.previousOrder=SB4TabOrder.nextOrder.slice(0),SB4TabOrder.previousOrder=SB4TabOrder.previousOrder.reverse(),SB4TabOrder.nextOrder=[])});var G=$("#tab_previous"),J=$("#tab_next"),X=function(){if("end"==SB4TabOrder.current)return void G.triggerHandler("focus");if(SB4TabOrder.current="",""!=SB4TabOrder.focusElement){var t=SB4TabOrder.focusElement,e=H._util.getStageObjectInstanceByElement($("#"+t));e&&(e.setAccessibilityHidden(!0),e.setTabIndex(-1)),SB4TabOrder.previousOrder.length>0?SB4TabOrder.previousOrder.splice(0,0,t):SB4TabOrder.previousOrder.push(t)}for(var i=!1;!i;)if(SB4TabOrder.nextOrder.length>0){var s=SB4TabOrder.nextOrder.shift(),r=H._util.getStageObjectInstanceByElement($("#"+s));if(r){var n=r.getScreenReaderTabElement();n&&n.length>0&&(SB4TabOrder.focusElement=s,r.setAccessibilityHidden(!1),i=!0,setTimeout(function(){r.setFocus()},100))}i||(SB4TabOrder.previousOrder.length>0?SB4TabOrder.previousOrder.splice(0,0,s):SB4TabOrder.previousOrder.push(s))}else SB4TabOrder.focusElement="",i=!0,setTimeout(function(){$("#lesson_end").focus()},100);var o=$(this)};J.focus(X);var K=function(){if("begin"==SB4TabOrder.current)return void J.triggerHandler("focus");if(SB4TabOrder.current="",""!=SB4TabOrder.focusElement){var t=SB4TabOrder.focusElement,e=H._util.getStageObjectInstanceByElement($("#"+t));e&&(e.setAccessibilityHidden(!0),e.setTabIndex(-1)),SB4TabOrder.nextOrder.length>0?SB4TabOrder.nextOrder.splice(0,0,t):SB4TabOrder.nextOrder.push(t)}for(var i=!1;!i;)if(SB4TabOrder.previousOrder.length>0){var s=SB4TabOrder.previousOrder.shift(),r=H._util.getStageObjectInstanceByElement($("#"+s));if(r){var n=r.getScreenReaderTabElement();n&&n.length>0&&(SB4TabOrder.focusElement=s,i=!0,r.setAccessibilityHidden(!1),setTimeout(function(){r.setFocus()},100))}i||(SB4TabOrder.nextOrder.length>0?SB4TabOrder.nextOrder.splice(0,0,s):SB4TabOrder.nextOrder.push(s))}else SB4TabOrder.focusElement="",i=!0,setTimeout(function(){$("#lesson_begin").focus()},100);var o=$(this)};G.focus(K)}};return a}),define("sb4core/syscheck",["modernizr"],function(){SB4API.preferXHR="file:"==window.location.protocol?!1:!0;var t=[];if("undefined"!=typeof Modernizr){var e=Modernizr;e.svg||t.push("svg"),e.canvas||t.push("canvas"),e.audio||t.push("audio"),e.video||t.push("video"),t.length>0&&alert("Warning: Your browser does not support the following required HTML5 features: "+t)}return t}),define("sb4core/linkhandler",[],function(){var t={generateWindowParam:function(t){var e="";return null==t?e:((null!=t.w||null!=t.h)&&(e="toolbar=no,menubar=no,fullscreen=no,",e=e+"width="+parseInt(t.w)+",",e=e+"height="+parseInt(t.h)+","),e)},openHyperLink:function(t,e,i,s){if(void 0!=e&&""!=e){if(0==e.indexOf("evt://"))return void(null!=t&&t.fireGlobalEvent(e));if((null==i||""==i)&&(i="_blank"),SB4API._EMBEDDED)return void $.notify("Opening a URL("+e+") is not supported in authoring preview mode.","warn");var r=null;return r=null!=s&&""!=s?window.open(e,i,s):window.open(e,i)}},handleLinkData:function(t,e){if(_.isObject(e)){var i=[];if(i[0]=e.link,_.string.isBlank(i[0]))return;if(null!=e.subs){var s=e.subs[0].t,r=e.subs[1].o;if(!_.string.isBlank(r)){var n=r.split(",");s=_.string.trim(n[0]," '");var o=n.splice(1);r=_.string.trim(o.join()," '")}this.openHyperLink(t,e.link,s,r)}else this.linkLib.openHyperLink(t,e.link,"","")}}};return SB4API.linkLib=t,t}),define("widgets/com.smartbuilder.axon.widget.frame/timeline",["jquery","underscore","sb4core/Logger","sb4core/DataUtil"],function(t,e,i,s){function r(t,e){this.engine=t,this.maxWaitCount=20,this.waitCount=0,this.gotoTimer=-1,this.endTime=0,this.time=0,this.timer=-1,this.points=[],this.tick=50,this.data=e?JSON.parse(e):{},this.ascStartTimeWgts=[],this.ascEndTimeWgts=[],this.nextStartTime=-1,this.nextEndTime=-1,this.lastTickTime=-1,this.activeWgts={},this.logger=new i("timeline",function(){return i.getDefaultPrefix()+" timeline "}),this.status=this.STATUS_IDLE,this.refAudio=void 0,this._init()}return r.prototype.STATUS_DEAD="dead",r.prototype.STATUS_STOP="stop",r.prototype.STATUS_PROCESS="process",r.prototype.STATUS_IDLE="idle",r.prototype._init=function(){if(this.logger._debug("init ... "),e.isEmpty(this.data))return this.logger._warn("timeline not data"),void this.play("destroy");this.endTime=this.data.endTime,this._createPoints(this.data._qPoint,0);var i=this._parseData(this.data._children);this.data.wgts=i,this.data.wgts.length>0&&(this._parseAscStartTimeWgts(this.data.wgts,0),this._parseAscEndTimeWgts(this.data.wgts,0)),this._modifyNextStartTime(),this._modifyNextEndTime(),t.each(i,function(t,e){e.obj._timelineStop(!1)}),this.logger._debug("init  ok ")},r.prototype._parseData=function(i){var s=[],r=this;return t.each(i,function(i,n){t.each(n.ranges,function(t,i){var o={};o.id=n.id,o.obj=r.getWgtByID(o.id),o.start=i.start,o.end=i.end,o.isAudio="com.smartbuilder.axon.widget.audio"!=o.obj.options._d.type||e.string.isBlank(o.obj.src)?!1:!0,o.isFixToEnd=1==i.isFixToEnd?i.isFixToEnd:o.end==r.endTime?!0:!1,o.obj&&s.push(o)})}),s},r.prototype._createPoints=function(i,s){var r=[];e.isArray(i)&&i.length>0&&(t.each(i,function(t,e){e.time>=s&&r.push(e)}),this.points=e.sortBy(r,function(t){return t.time}))},r.prototype._parseAscStartTimeWgts=function(t,i){var s=e.filter(t,function(t){return t.start>=i});s=e.sortBy(s,function(t){return t.start}),s=e.groupBy(s,function(t){return t.start}),this.ascStartTimeWgts=e.values(s)},r.prototype._parseAscEndTimeWgts=function(t,i){var s=e.filter(t,function(t){return!t.isFixToEnd});s=e.sortBy(s,function(t){return t.start}),s=e.sortBy(s,function(t){return t.end}),s=e.groupBy(s,function(t){return t.end}),this.ascEndTimeWgts=e.values(s)},r.prototype._timelineGoto=function(i){this._timelineStop(!0);var r=s.parseNumber(i);0>r&&(r=0),r=10*r,r=100*Math.floor(r),this.time=r,this._createPoints(this.data._qPoint,r),this.data.wgts.length>0&&(this._parseAscStartTimeWgts(this.data.wgts,r),this._parseAscEndTimeWgts(this.data.wgts,r)),this._modifyNextStartTime(),this._modifyNextEndTime(),this._updateActiveWgts(r);var n=this;n._clearRefAudio(),t.each(e.values(this.activeWgts),function(t,e){return e.isAudio?(n.refAudio=e,!1):void 0});var n=this;this.gotoTimer=setInterval(function(){n._processGoto()},this.tick)},r.prototype._timelinePlay=function(){if(!(this.timer>0||e.isEmpty(this.data))){this.logger._debug("play "),this.status=this.STATUS_PROCESS;var i=this;this.lastTickTime=t.now();var s=e.values(this.activeWgts);s.length>0&&t.each(s,function(t,e){e.obj._timelineGoto(i.time-e.start),e.obj._timelinePlay()}),this._process(),this.timer=setInterval(function(){i._process()},this.tick)}},r.prototype._process=function(){var i=this;if(this.points.length>0&&this.time>=this.points[0].time&&(this.engine.addEvent("timeline",this.points[0].index),this.points.shift()),this.time>this.endTime)return void this._timelineStop(!1);var s=!0;if(-1!=this.nextEndTime&&this.time>=this.nextEndTime&&this.ascEndTimeWgts.length>0){var r=this.ascEndTimeWgts.shift();e.isArray(r)&&(t.each(r,function(t,e){void 0!=i.activeWgts[e.id]&&(e.obj._timelineStop(!1),delete i.activeWgts[e.id],i.refAudio&&i.refAudio.id==e.id&&i._clearRefAudio())}),this._modifyNextEndTime())}var n=t.now(),o=this.time+n-this.lastTickTime;if(-1!=this.nextStartTime&&this.time>=this.nextStartTime&&this.ascStartTimeWgts.length>0){this.logger._debug("correction time "+this.time+" to "+this.nextStartTime),this.time=this.nextStartTime;var r=this.ascStartTimeWgts[0];r=r.concat(e.values(this.activeWgts));var a=!1;if(void 0==this.refAudio&&t.each(r,function(t,e){return e.isAudio?(i.refAudio=e,a=!0,!1):void 0}),e.isArray(r)){if(a){var l=r.length;t.each(r,function(t,s){s.obj._timelineStop(e.contains(e.keys(i.activeWgts),s.id)?!0:!1),s.obj._timelineGoto(i.time-s.start)&&l--,s.obj._timelineGoto(i.time-s.start)})}else r=e.without(r,this.refAudio),l=r.length,t.each(r,function(t,e){e.obj._timelineGoto(i.time-e.start),l--});0==l?(this.ascStartTimeWgts.shift(),t.each(r,function(t,s){e.contains(e.keys(i.activeWgts),s.id)||(i.activeWgts[s.id]=s),s.obj._timelinePlay()}),this.lastTickTime=t.now(),this._modifyNextStartTime(),this.time=o):(s=!1,a&&i._clearRefAudio())}}s?this._addTime():this.lastTickTime=t.now()},r.prototype._timelineStop=function(i){if(this.logger._debug("stop ... "),this.status!=this.STATUS_STOP){if(this.status=this.STATUS_STOP,clearInterval(this.timer),clearInterval(this.gotoTimer),this.timer=-1,this.gotoTimer=-1,this._addTime(),e.isObject(this.activeWgts)){var s=e.values(this.activeWgts);s.length>0&&t.each(s,function(t,e){e.obj._timelineStop(!i&&e.isFixToEnd?!0:i)})}i||(this.activeWgts={}),this.logger._debug("stop ok ")}},r.prototype._destroy=function(){this._timelineStop(!1),this.status=this.STATUS_DEAD,this.engine=void 0,this.waitCount=0,this.gotoTimer=-1,this.endTime=0,this.time=0,this.timer=-1,this.points=void 0,this.data=void 0,this.ascStartTimeWgts=void 0,this.ascEndTimeWgts=void 0,this.nextStartTime=-1,this.nextEndTime=-1,this.lastTickTime=-1,this.activeWgts=void 0,this.refAudio=void 0,this.logger._debug("destroy")},r.prototype._addTime=function(){if(void 0==this.refAudio){var e=t.now();this.time+=e-this.lastTickTime,this.lastTickTime=e}else{var i=Math.floor(1e3*this.refAudio.obj.getCurrentTime()+this.refAudio.start);this.time=this.time==i&&this.time+100>=this.refAudio.end?i+100:i,this.lastTickTime=t.now()}this.logger._debug("time is "+this.time+"ms")},r.prototype._modifyNextStartTime=function(){this.nextStartTime=this.ascStartTimeWgts.length>0?this.ascStartTimeWgts[0][0].start:-1,this.logger._debug("next start time is "+this.nextStartTime+"ms")},r.prototype._modifyNextEndTime=function(){this.nextEndTime=this.ascEndTimeWgts.length>0?this.ascEndTimeWgts[0][0].end:-1,this.logger._debug("next end time is "+this.nextEndTime+"ms")},r.prototype._updateActiveWgts=function(e){var i=this;i.activeWgts={},t.each(this.data.wgts,function(t,s){e>=s.start&&e<=s.end?i.activeWgts[s.id]=s:s.obj._timelineStop(!1)})},r.prototype._processGoto=function(){var i=this,s=e.values(this.activeWgts),r=s.length;t.each(s,function(t,e){e.obj._timelineStop(!0),e.obj._timelineGoto(i.time-e.start)&&r--}),0==r?(t.each(s,function(t,e){e.obj._timelinePlay()}),this.waitCount=0,clearInterval(this.gotoTimer),this.gotoTimer=-1,this.play("play")):this.waitCount>this.maxWaitCount?(clearInterval(this.gotoTimer),this.gotoTimer=-1,this.play("play")):this.waitCount++},r.prototype.play=function(t){"play"==t?this._timelinePlay():"stop"==t?this._timelineStop(!0):this._destroy()},r.prototype.getWgtByID=function(t){return this.engine.getWgtByID(t)},r.prototype.getStatus=function(){return this.status},r.prototype.getTime=function(){return this.time>this.endTime?this.endTime:this.time},r.prototype.isAutoPlay=function(){return this.data&&this.data.autoplay===!1?!1:!0},r.prototype._clearRefAudio=function(){this.refAudio=void 0},r}),define("wgt/com.smartbuilder.axon.widget.frame/s",["module","sb4core/sbobj","sb4core/sbobjfactory","sb4core/DataUtil","underscore","sb4core/ObjContext","sb4core/SB4Engine","sb4core/SB4Decode","sb4core/data","widgets/com.smartbuilder.axon.widget.frame/timeline","underscore_str"],function(t,e,i,s,r,n,o,a,l,h){var c=t.config(),u=c.widgetsvc,d=u.getShortUIKey(),p=new createjs.LoadQueue(SB4API.preferXHR);p.setMaxConnections(10);var f=new createjs.LoadQueue(SB4API.preferXHR);f.setMaxConnections(10);var g=[],v;return $.widget(u.getFullUIKey(),$.sb4[e],{options:{},_create:function(){this.pageNumIdMap=l.lo.pageNumIdMap,this.pageIdNumMap=l.lo.pageIdNumMap,this.pageNumNameMap=l.lo.pageNumNameMap,this.element.addClass(d);var t=this.options;this._super(),this.totalSceneCount=this.getFlowSceneCount(t._d.flow.subflow),null==t.hasBG?this.element.css("background-color","#FFFFFF"):1==t.hasBG&&this.element.css("background-color",s.parseColor(t.bgcolor)),this.element.css("overflow","hidden"),this.objctx=t._engine.objctx.fork(),this.objctx.add("_frame",this),SB4API.topSB4EngienContext.add(["[frame]"],this),this.scene=null,this.subFlowMap={},this._initSubFlowMap(this.options._d.flow.subflow,"root"),this.engine=new o(t._i,null,this.objctx,"frame"),this.engine.objctx.add("[ctx_type]","frame"),t._engine.addEngine(this.engine),this.factory=new i(this.engine),this.mastermap=r.indexBy(t._d.slides,"id");var e=this.objctx,n=t._d.blockDefRegistry;void 0!=n&&r.each(n.defs,function(t){e.add("global "+t.name)});var a;t.selectedScene?(a=this._findHashSceneByID(this.options._d.flow.subflow,t.selectedScene),t.selectedScene=null,null==a&&(a=this._selectNextScene({cmd:"restart"}))):a=this._selectNextScene({cmd:"restart"}),a=this._findFinalScene(a),a&&this._revertScene(a)},_selectNextScene:function(t){var e=null,i=this.options._d;if("restart"==t.cmd)e=i.flow;else if("sb4_goto_branch"==t.cmd){var s=this.scene.flows;
if("_next"==t.v)e=void 0==this.scene.flows||r.isEmpty(s)?this._findNextSceneAfterSubflow(this.scene.id):s[0];else if("_nextRandom"==t.v)e=void 0==this.scene.flows||r.isEmpty(s)?this._findNextSceneAfterSubflow(this.scene.id):r.sample(s);else if("_prev"==t.v){var n=this._findSceneId(this.scene.id);e=this._findPrevSceneByBranchID(this.options._d.flow.subflow,n)}else r.str.isBlank(t.v)||(e=r.find(s,function(e){return e.id==t.v}))}else"global_sb4_goto_scene"==t.cmd?e=this._findHashSceneByID(this.options._d.flow.subflow,t.v):"reload"==t.cmd&&(e=this.scene);return e},_findHashSceneByID:function(t,e){if(r.str.isBlank(e)||null==t)return null;var i=t.subflow;if(null!=i){if(i.id==e)return i;if(n=this._findHashSceneByID(i,e),null!=n)return n}if(t.id==e)return t;var s=t.flows,n=null;if(null!=s)for(var o in s)if(n=this._findHashSceneByID(s[o],e),null!=n)break;return n},_findSceneByID:function(t,e){if(r.str.isBlank(e)||null==t)return null;if(t.id==e)return t;var i=t.flows;if(void 0==i)return null;var s=null;for(var n in i)if(s=this._findSceneByID(i[n],e),null!=s)break;return s},_findPrevSceneByBranchID:function(t,e){if(r.str.isBlank(e)||null==t)return null;var i=t.flows;for(var s in i)if(i[s].id==e)return t;var n=null;for(var s in i)if(n=this._findPrevSceneByBranchID(i[s],e),null!=n)break;if(null==n){var o=t.subflow;null!=o&&(o.id==e?n=t:o.flows&&(n=this._findPrevSceneByBranchID(o,e)))}return n},_findSceneId:function(t){var e=this._findHashSceneByID(this.options._d.flow.subflow,this.subFlowMap[t]);if(null!=e){var i=e.subflow;if(r.str.isBlank(t)||null==i)return null;if(null!=e&&i.id==t)return t=e.id,this._findSceneId(t)}return t},_findNextSceneAfterSubflow:function(t){var e=null,i=this._findHashSceneByID(this.options._d.flow.subflow,this.subFlowMap[t]);return null!=i&&(e=void 0!=i.flows&&r.size(i.flows)>0?i.flows[0]:this._findNextSceneAfterSubflow(i.id)),e},_renderScene:function(t){if(null==t)return void SB4API.hideLoading();var e=this.scene;this.scene=t;var n=this.scene.id;this.options._h=t.time&&t.time>0?t.time:SB4API.profile.current.h,this.element.height(this.options._h),$("body").scrollTop(0),SB4API.hideLoading(),SB4API.currentScene={name:this.scene.name,id:n,num:this.pageIdNumMap[n]},r.isObject(SB4XAPI.tincan)&&SB4XAPI.pageVisit(this.scene.name,this.pageIdNumMap[n]);var o=this,a=t.slides,l=t.layers,h=[];void 0!=l&&(h=h.concat(l));var c=r.map(this.mastermap,function(t,e){return t});h=h.concat(c);var u=r.indexBy(h,"id"),d=[];for(var p in a){var f=a[p],g=u[s.trimRefString(f.$ref)];void 0!=g&&d.push(g)}var v=r.indexBy(d,"id"),m={};this.element.children(".com_smartbuilder_axon_widget_slide, .com_smartbuilder_axon_widget_slideset").each(function(t,e){var i=$(e),s=i.attr("id");v[s]&&i.hasClass("sceneMasterLayer")&&(m[s]=i)});var b={};b["[evtval]"]=SB4API.profile.current.d,this.sceneLocalEngine=this.engine.addSubEngine(n,"local"),this.sceneLocalEngine.objctx.add("[ctx_type]","local"),this.sceneLocalEngine.eventQueue.push(["flow","load",b]),r.each(r.keys(m),function(t,e){var i=o.engine.getSubEngineByID(t);i&&(i.eventQueue.push(["flow","change",b]),o.sceneLocalEngine.objctx.addObjContext(i.objctx))});var _=[];for(var x in d){var y=d[x].id,w=null;if(m[y])w=$("#"+y,this.element);else{var S=null,T="sceneLocalLayer";if(this.mastermap[y]){var E=this.engine.addSubEngine(y,this.mastermap[y].name);E.objctx.add("[ctx_type]","master"),E.eventQueue.push(["flow","load",b]),E.addEngineEventListener(o),o.sceneLocalEngine.objctx.addObjContext(E.objctx),S=new i(E),T="sceneMasterLayer"}else S=new i(this.sceneLocalEngine);var I=S._createObjDiv(this.element),C=S._createObj(I,d[x],this.element);C.addClass(T),S._activateObjDiv(I,void 0!=C),_.push($(C)),w=C,m[y]=w,"sceneMasterLayer"==T&&d[x].actions&&$.each(d[x].actions,function(t,e){E.parseXml(e.val)})}w.css("zIndex",x)}t.actions&&$.each(t.actions,function(t,e){o.sceneLocalEngine.parseXml(e.val)}),this.sceneLocalEngine.addEngineEventListener(this);var A={};A.id=n,A.name=t.name,SB4API.flowcontext.setContext(A),SB4API.flowcontext.fireEvent();var B=[];r.each(SB4API.cacheSvgIdList,function(t,e){0==$("."+t).length?$("#svg_"+t).remove():B.push(t)}),SB4API.cacheSvgIdList=B,0==$("#playFull").length?this.afterRenderScene(_,t):(this.engine.objctx.add("playFull_newLayers",_),this.engine.objctx.add("playFull_scene",t))},afterRenderScene:function(t,e){this.engine.start();var i=this;$.each(t,function(t,e){i.sceneLocalEngine.invokeWidgetMethod(e,"_onStageReady"),i.sceneLocalEngine.invokeWidgetMethod(e,"_onParentShowHide",[!0,!0])}),this.timeline=new h(this.sceneLocalEngine,e.timeline),this.timeline.isAutoPlay()&&this.timeline.play("play"),this._util.calculateTabindex(),this.engine.objctx.add("_timeline",this.timeline)},onEngineEvent:function(t,e,i,s){("onHide"==i||"onShow"==i||"onMove"==i)&&(this.debounce||(this.debounce=r.debounce(this._util.calculateTabindex,300)),this.debounce());var s=r.clone(s);if(null!=s&&s.broadcast){s.broadcast=!1;for(var n=0;n<this.engine.subEngines.length;n++)t!=this.engine.subEngines[n]&&this.engine.subEngines[n].addEvent(e,i,s)}else"flow"==e?(s.cmd=i,("sb4_goto_branch"==i||"restart"==i||"global_sb4_goto_scene"==i||"reload"==i)&&this.onEnginePageEvent(i,s)):this.mastermap[t.id]},onEnginePageEvent:function(t,e){var i=this,s;"sb4_goto_branch"==t||"restart"==t||"global_sb4_goto_scene"==t||"reload"==t?(e.cmd=t,this.cmd=t,s=this._selectNextScene(e)):"sb4_goto_scene_by_name"==t?s=this.gotoSceneByName(this.options._d.flow.subflow,e.name):"sb4_goto_branch_by_name"==t?s=this.gotoBranchByName(e.name):"sb4_goto_scene_by_id"==t&&(s=this._findHashSceneByID(this.options._d.flow.subflow,e.id)),s=this._findFinalScene(s),s&&(this.engine.stop(),i._revertScene(s))},_findFinalScene:function(t){if(t=this.getSenceSubFlow(t),null==t)return null;var e=this.scene;return"restart"!=this.cmd&&"reload"!=this.cmd&&null!=e&&e.id==t.id?null:t},_destroy:function(){this.engine.destroy(),this.engine=null,this.mastermap=void 0,this.objctx=null,this.factory=null,this._super()},_revertScene:function(t){if(null!=t){this.cmd=null;var e=this,i=t.slides,n=[];for(var o in i){var h=i[o],c=s.trimRefString(h.$ref);void 0!=c&&n.push(c)}this.timeline&&this.timeline.play("destroy"),this.sceneLocalEngine&&this.sceneLocalEngine.destroy(),this.element.children(".com_smartbuilder_axon_widget_slide, .com_smartbuilder_axon_widget_slideset").each(function(t,i){var s=$(i),o=s.attr("id");if(r.contains(n,o)&&s.hasClass("sceneMasterLayer"));else{if(s.hasClass("sceneMasterLayer")){var a=e.engine.getSubEngineByID(o);a&&a.destroy()}var l=e._getElementWidgetInstance(i);l.destroy(),s.remove()}}),this.engine._purgeSubEngine(),SB4API.showLoading();var u=function m(i){var s=[],n=r.keys(e.mastermap);n.length>0&&void 0==e.mastermap[n[0]].eClass&&(r.isArray(master)||(master=a.decodeSb4Data(master)),a.revertLoColor(master,l.text.glyphReg.colorData),l.lodict.id&&a.revertTextWgtId(master,l.lodict.id),a.decodeLO(master,l.lodict),this.mastermap=r.indexBy(master,"id"),$.each(master,function(t,e){if(e.textReg){var i=r.keys(e.textReg);$.each(i,function(t,i){var s=i.split(".")[0],n=e.textReg[i];if(r.isObject(n)&&r.has(n,"refid")){var o=n.refid;n.refid=l.lodict.id[o.substring(0,o.indexOf("."))]+o.substring(o.indexOf("."))}SB4API.txtLib.textReg[l.lodict.id[s]+i.substring(s.length)]=n})}}),e.mastermap=r.indexBy(master,"id"));var o;o=l.lodict.id?d[t.id]:t.id,"undefined"==typeof local&&(local=void 0),void 0==local&&(local=t.layers),void 0!=local&&p.getResult(o)&&(r.isObject(local)||(local=a.decodeSb4Data(local)),a.revertLoColor(local,l.text.glyphReg.colorData),l.lodict.id&&a.revertTextWgtId(local,l.lodict.id),a.decodeLO(local,l.lodict),local.textReg&&(SB4API.txtLib.textReg=r.extend(SB4API.txtLib.textReg,local.textReg)),t.actions=local.actions,t.layers=local.layers),e._preloadResources(t,s)};if(p.removeAllEventListeners(),p.on("complete",u),t.layers)this._preloadResources(t,[]);else{var d=r.invert(l.lodict.id),f=[],g=r.keys(this.mastermap);g.length>0&&void 0==this.mastermap[g[0]].eClass&&f.push({src:"app/master.js",id:"master"});var v={};l.lodict.id?(v.src="app/scene_"+d[t.id]+".js",v.id=d[t.id]):(v.src="app/scene_"+t.id+".js",v.id=t.id),f.push(v),p.loadManifest(f)}}},_preloadResources:function(t,e){var i=this,s=function(e){t["preloadResources"+SB4API.profile.current.id]=!0,i._renderScene(t)},n=function(t){};if(t["preloadResources"+SB4API.profile.current.id])this._renderScene(t);else if(this._findPreloadResources(t,e),r.isEmpty(e))t["preloadResources"+SB4API.profile.current.id]=!0,i._renderScene(t);else{for(var o=[],a=0;a<e.length;a++)o.push({id:e[a],src:e[a]});f.loadManifest(o),f.removeAllEventListeners(),f.on("complete",s),f.on("error",n)}},_findPreloadResources:function(t,e){var i=this,n=[];this._findWgts(t.layers,n);var o=r.map(t.layers,function(t){return t.id});$.each(t.slides,function(t,e){var a=s.trimRefString(e.$ref);null==a||r.contains(o,a)||i._findWgts(i.mastermap[a].slides,n)}),$.each(n,function(t,s){null!=s.data.entries&&i._findPreloadResourcesByWgt(s.data.entries,e,s.type)})},_isAlreadyPreload:function(t,e){return t=SB4API.util.getWidgetAssetURI(t,e),r.contains(g,t)?!0:(g.push(t),!1)},_findPreloadResourcesByWgt:function(t,e,i){var s=this,n=SB4API.profile.current.id,o=r.find(t,function(t){return"_prf"==t.id});if(o){var a=r.find(o.subs,function(t){return t.id==n});if(a){var l=a.subs;if(r.isArray(l)){var h=r.map(l,function(t){return t.id}),c=r.reject(t,function(t){return r.contains(h,t.id)});t=l.concat(c)}}}s._isPreloadRes(t)?$.each(t,function(t,n){"http://axon.smartbuilder.com/model/lo#//ResData"==n.eClass&&n.key&&(s._isAlreadyPreload(n.key,i)||e.push(r.last(g)))}):$.each(t,function(t,n){"pload"==n.id&&"http://axon.smartbuilder.com/model/lo#//ResData"==n.eClass&&(s._isAlreadyPreload(n.key,i)||e.push(r.last(g)),r.isArray(n.subs)&&$.each(n.subs,function(t,n){s._isAlreadyPreload(n.key,i)||e.push(r.last(g))}))})},_findWgts:function(t,e){var i=this;if(r.isArray(t))$.each(t,function(t,s){i._findWgts(s,e)});else if(r.isObject(t))if(r.isArray(t.widgets)&&!r.isEmpty(t.widgets))$.each(t.widgets,function(t,i){e.push(i)});else for(var s in t)"object"==typeof t[s]&&this._findWgts(t[s],e)},_isPreloadRes:function(t){var e=!1;return null!=t?$.each(t,function(t,i){"preload"==i.id&&1==i.value&&(e=!0)}):e=!0,e},_timelineGoto:function(t){return this.timeline._timelineGoto(t)},_timelinePlay:function(){this.timeline.play("play")},_timelineStop:function(){this.timeline.play("stop")},gotoSceneByName:function(t,e){var i=this.findSceneByName(t,e);return i},findSceneByName:function(t,e){if(null==t)return null;var i=t.subflow;if(null!=i){if(i.name.toLowerCase()==e.toLowerCase())return i;if(r=this.findSceneByName(i,e),null!=r)return r}if(t.name.toLowerCase()==e.toLowerCase())return t;var s=t.flows,r=null;if(null!=s)for(var n in s)if(r=this.findSceneByName(s[n],e),null!=r)break;return r},_initSubFlowMap:function(t,e){if(null==t)return null;this.subFlowMap[t.id]=e;var i=t.subflow;null!=i&&this._initSubFlowMap(i,t.id);var s=t.flows;if(null!=s)for(var r in s)this._initSubFlowMap(s[r],e)},exitFlow:function(){var t=this._findExitFlowNextScene(this.scene);this._revertScene(this.getSenceSubFlow(t))},_findExitFlowNextScene:function(t){var e=this.subFlowMap[t.id];if("root"!=e){var i=this._findHashSceneByID(this.options._d.flow.subflow,e);if(null!=i)return r.isArray(i.flows)&&r.size(i.flows)>0?i.flows[0]:this._findExitFlowNextScene(i)}},getBranchNames:function(){var t=this.scene.flows;return r.size(t)>0?r.map(t,function(t){return t.name}):[]},getBranchNums:function(){var t=this.scene.flows;if(r.size(t)>0){var e=this;return r.map(t,function(t){return e.pageIdNumMap[t.id]})}return[]},getSenceSubFlow:function(t){return null!=t&&null!=t.subflow?(t=t.subflow,this.getSenceSubFlow(t)):t},gotoBranchByName:function(t){var e=this.scene.flows,i=null;if(null!=e)for(var s in e)if(e[s].name.toLowerCase()==t.toLowerCase()){i=e[s];break}return i},getFlowSceneCount:function(t){var e=1,i=t.subflow;null!=i&&(e=e+this.getSubFlowSceneCount(i)-1);var s=t.flows;if(null!=s){var r=this;$.each(s,function(t,i){e+=r.getFlowSceneCount(i)})}return e},getSubFlowSceneCount:function(t){var e=1,i=t.flows;if(null!=i){var s=this;$.each(i,function(t,i){e+=s.getFlowSceneCount(i)})}return e},_play:function(){this._super()&&this.timeline&&this.timeline.play("play")},_stop:function(){this._super(),this.timeline.play("stop")},_isPlaying:function(){return this._super(),void 0!=this.timeline&&this.timeline.getStatus()==this.timeline.STATUS_PROCESS?!0:!1},changeProfile:function(t){this.options._w=t.w;var e=this.scene.id,i=t.hMap;this.options._h=i[e]?i[e]:t.h,this.element.width(this.options._w),this.element.height(this.options._h),SB4API.alignToBody(),$("body").scrollTop(0),this._super(t)},preloadResourcesBeforeChangeProfile:function(){var t=this,e=function(e){t.scene["preloadResources"+SB4API.profile.current.id]=!0},i=function(t){};if(!t.scene["preloadResources"+SB4API.profile.current.id]){var s=[];if(this._findPreloadResources(t.scene,s),r.isEmpty(s))t.scene["preloadResources"+SB4API.profile.current.id]=!0;else{for(var n=[],o=0;o<s.length;o++)n.push({id:s[o],src:s[o]});f.loadManifest(n),f.removeAllEventListeners(),f.on("complete",e),f.on("error",i)}}}}),d}),define("wgt/com.smartbuilder.axon.widget.slideset/s",["module","sb4core/sbobj"],function(t,e,i){var s=t.config(),r=s.widgetsvc,n=r.getShortUIKey(),o="com_smartbuilder_axon_widget_slide",a="."+o;return $.widget(r.getFullUIKey(),$.sb4[e],{options:{mode:0},_create:function(){this.element.addClass(n),this._super(),this.idx=-1,this.list=null},_onStageReady:function(){var t=this,e=this.options,i=e._engine;this.element.children(a).each(function(i,s){if(0==i)return void $(s).removeClass(o);var r=$(s).data("sb4-"+$(s).data("sb4type"));1==e.mode?1==r._vv&&(t.idx=i-1):1==r._vv&&(t.idx=i-1)}),this.list=this.element.children(a),this._super()},_paintWidgetShow:function(t){var e=this;if(_.has(t,"idx")){var i=t.idx;this.element.children(a).each(function(i,s){var r=$(s).data("sb4-"+$(s).data("sb4type"));0==r._vv&&r.hide(t.hidefx,e)});var s=!0;this.element.children(a).each(function(i,r){var n=$(r).data("sb4-"+$(r).data("sb4type"));1==n._vv&&n.show(t.showfx,e),0==n.visited&&(s=!1)}),this.idx=i,e.fireEvent("onLayerChange"),1==s&&1!=e.firedAllVisisted&&(e.firedAllVisisted=!0,e.fireEvent("onAllLayerViewed"))}this._super()},showSlide:function(t){t=this._util.parseInt(t);var e=this._getSlideRef(t);null!=e&&this._showSlide(!0,e)},hideSlide:function(t){t=this._util.parseInt(t);var e=this._getSlideRef(t);null!=e&&this._showSlide(!1,e)},showNextPrevSlide:function(t){if(this.idx<0&&(this.idx=-1),"_next"==t){if(this.idx+2>this.list.length)return;this.showSlide(this.idx+2)}else if("_prev"==t){if(this.idx-1<0)return;this.showSlide(this.idx)}},getVisibleLayerIndexList:function(){var t=[];return 1==this.getVisible()&&this.element.children(a).each(function(e,i){var s=$(i).data("sb4-"+$(i).data("sb4type"));1==s._vv&&t.push(e+1)}),t.join()},getVisibleLayers:function(){var t=[],e=this;return 1==this.getVisible()&&this.element.children(a).each(function(i,s){var r=e._getSlideRef(i+1);1==r._vv&&t.push(r)}),t},_getSlideRef:function(t){if(1>t)return null;var e=this.element.children(a).eq(t-1);return 0==e.length?null:e=e.data("sb4-"+e.data("sb4type"))},_getSlideIdxByRef:function(t){return this.list.index(t.element)},_showSlide:function(t,e,i){var s=this,r=this.options,n=r._engine,o=this._getSlideIdxByRef(e);if(this.element.children(a).each(function(i,s){var n=$(s).data("sb4-"+$(s).data("sb4type"));1==r.mode?n==e&&(n._vv=t):1==t?n._vv=n==e?!0:!1:n==e&&(n._vv=!1)}),0!=r.mode||0!=t||this.idx==o){var l={idx:o};1==t?l.showfx=i:l.hidefx=i,this._firePaintRequest(l)}},getSlideCount:function(){return this.list.length},getSize:function(){return this.options._p.getSize()}}),n}),define("wgt/com.smartbuilder.axon.widget.slide/s",["module","sb4core/sbobj"],function(t,e,i){var s=t.config(),r=s.widgetsvc,n=r.getShortUIKey();return $.widget(r.getFullUIKey(),$.sb4[e],{options:{},_create:function(){this.element.addClass(n),this._super(),this.visited=!1},_onStageReady:function(){var t=this,e=this.options,i=e._engine;this._super()},show:function(t,e){var i=this.options;e==i._p||"_showOrHide"==e?(this.visited=!0,this._super(t,e)):i._p._showSlide(!0,this,t)},hide:function(t,e){var i=this.options;e==i._p||"_showOrHide"==e?this._super(t,e):i._p._showSlide(!1,this,t)},getSize:function(){return this.options._p.getSize()},_refreshFxElement:function(){this.element.children(".axon_sbobj").each(function(t,e){var i=$(e).data("sb4-"+$(e).data("sb4type"));i._refreshFxElement()})}}),n}),define("text!widgets/com.smartbuilder.axon.widget.shape/svg.html",[],function(){return'<div\n	style="position: relative; text-align: center; width: 100%; height: 100%;">\n	<svg aria-hidden="true" focusable="false" xmlns="http://www.w3.org/2000/svg"\n		xmlns:xlink="http://www.w3.org/1999/xlink"\n		xmlns:svg="http://www.w3.org/2000/svg"\n		contentScriptType="text/ecmascript" display="block" width="100%" zoomAndPan="magnify"\n		contentStyleType="text/css" height="100%" preserveAspectRatio="none"\n		version="1.0">\n		'}),define("lib/css!widgets/com.smartbuilder.axon.widget.shape/style",[],function(){}),define("text!widgets/com.smartbuilder.axon.widget.shape/text.html",[],function(){return'</svg>\n<div id="text"></div>\n</div>'}),define("wgt/com.smartbuilder.axon.widget.shape/s",["module","sb4core/sbobj","text!widgets/com.smartbuilder.axon.widget.shape/svg.html","css!widgets/com.smartbuilder.axon.widget.shape/style.css","text!widgets/com.smartbuilder.axon.widget.shape/styles.xml","text!widgets/com.smartbuilder.axon.widget.shape/text.html"],function(t,e,i,s,r,n){var o=t.config(),a=o.widgetsvc,l=a.getShortUIKey();return $.widget(a.getFullUIKey(),$.sb4[e],{options:{},_create:function(){this.element.addClass(l),this._super(),this.applyProfileFlag||(this.clkCnt=0,this.lineWidth=this.options.lineWidth,this.linecolor=this.options.line,this.transparency=this.options.transparency,this.textValue=this.options.text,this.textColorValue=this.options.fontColor,this.scaleValue=100,this.oldscaleValue=this.scaleValue,this.filllist=JSON.parse(this.options.filllist)),this.rootshapeId=_.uniqueId("rootshape_"),this.rootshapeJQueryId="#"+this.rootshapeId,this.rootshapeGroupId=this.rootshapeId+"_g",this.rootshapeShadowId=this.rootshapeId+"_shadow",this.element.addClass("notouch"),this.attr={},this.options.underline&&(this.attr.textDecoration="underline");var t=this.options._x-this.getPosOffset(),e=this.options._y-this.getPosOffset(),i=this.options._w+this.getSizeOffset(),s=this.options._h+this.getSizeOffset();this.element.css("left",t+"px"),this.element.css("top",e+"px"),this.element.css("width",i+"px"),this.element.css("height",s+"px");var r="";if(null!=this.options.image&&this.options.image.length>0){var n=a.getWidgetAssetURI(this.options.image);r='<pattern id="'+this.options._i+'simg" patternUnits="userSpaceOnUse"  width="'+this.options._w+'" height="'+this.options._h+"\"> <image aria-hidden='true' width=\""+this.options._w+'" height="'+this.options._h+'" preserveAspectRatio="none" xlink:href="'+n+'" ></image></pattern>'}if(this.shadowValue=this.options.shadow,this._createShape(r),void 0!=this.shadowValue&&"use"==this.shadowValue.shadow){this.shadowdiv=$("<div>").prependTo(this.element),this.shadowdiv.attr("class","notouch"),this.shadowdiv.html(this._util.createShadowSvg(this.rootshapeShadowId,this.rootshapeGroupId,this.shadowValue,i,s)),this.options.margin>0&&($("#"+this.rootshapeShadowId).attr("x",this.options.margin),$("#"+this.rootshapeShadowId).attr("y",this.options.margin)),this.shadowdiv.attr("style","position:absolute; text-align:center;");var o=this.getShadowBounds();this.setTextStyleValue(this.shadowdiv,o[1],o[0],o[2],o[3]),this.element.find("#"+this.rootshapeId+"_shadow").css("opacity",this._util.getOpacityByTransparency(this.transparency))}this.element.find(this.rootshapeJQueryId).attr("transform","translate("+this.getTranslateValue()+","+this.getTranslateValue()+")"),100!=this.scaleValue&&this.refreshScale(this.scaleValue)},_createShape:function(t){var e=this.options._w+this.getSizeOffset(),s="";if("use"==this.shadowValue.shadow&&(s=this.options.group.replace(/rootshape/g,this.rootshapeGroupId)),this.div=$(i+"<defs>"+t+s+"</defs>"+this.options.group.replace(/rootshape/g,this.rootshapeId)+"</svg></div>"),this.div.appendTo(this.element),$(this.rootshapeJQueryId).attr("style",this.options.styleValue.replace("simg",this.options._i+"simg")),this.options.hand&&$(this.rootshapeJQueryId).css("cursor","pointer"),this.fillcolor)$(this.rootshapeJQueryId).css("fill",this.fillcolor);else if("none"!=this.filllist[0].typeValue){this.element.find(this.rootshapeJQueryId).css("pointer-events","painted");var r=this.filllist[0];if("gradient"==r.typeValue){var n='<linearGradient x1="'+r.x1+'" y1="'+r.y1+'" x2="'+r.x2+'" y2="'+r.y2+'">';_.each(r.stopList,function(t,e){n+='<stop stop-color="rgb('+t.color.red+","+t.color.green+","+t.color.blue+')" offset="'+t.position+'%" stop-opacity="'+(1-t.opacity/100)+'"></stop>'}),n+=" </linearGradient>";var o=this._util.cacheFillSvg(n,"fill_",this.div);this.element.find(this.rootshapeJQueryId).css("fill","url("+o+")")}else if("solid"==r.typeValue||"white"==r.typeValue){var a=r.solidColor,l=$.Color(a.red,a.green,a.blue,1);this.fillColor=this._util.getColorHexString(l),this.element.find(this.rootshapeJQueryId).css("fill","rgb("+a.red+","+a.green+","+a.blue+")")}}else this.element.find(this.rootshapeJQueryId).css("fill","url(#sb4FillNone)");$(this.rootshapeJQueryId).css("stroke-width",this.lineWidth),$(this.rootshapeJQueryId).css("stroke",this.linecolor),$(this.rootshapeJQueryId).css("opacity",this._util.getOpacityByTransparency(this.transparency)),this.setTextStyleValue(this.div,-this.options.margin,-this.options.margin,this.options._w+this.getSizeOffset()+2*this.options.margin,this.options._h+this.getSizeOffset()+2*this.options.margin),this.textflow=$("<div>").appendTo(this.div),this.textflow.attr("class","notouch"),this.textflow.css("opacity",1-this.transparency/100),this.setTextStyleValue(this.textflow,this.options.margin+this.getPosOffset(),this.options.margin+this.getPosOffset(),this.options._w,this.options._h),this.replaceAttrValue(this.textflow,"overflow","hidden"),this.text=$("<div>").appendTo(this.textflow);var h=e-20;this.drawText("shapetext",this.textValue,this.text,this.options.font,this.options.align,this.textColorValue,h,void 0,this.attr,void 0),this.text.attr("class","notouch");var c=this.text.width(),u=this.text.height(),d=(this.options._w-c)/2;switch(this.options.align){case 0:d=10;break;case 2:d=this.options._w-10-c}var p=this.options._h,f=(p-u)/2;u>p&&(f=0),this.setTextStyleValue(this.text,f,d,c,u)},getShadowBounds:function(){var t=1;void 0!=this.scaleValue&&(t=this.scaleValue/100);var e=this.options,i=this.options.margin-this.getSizeOffset(),s=this.shadowValue.size/100,r=4*this.shadowValue.radius,n=this.shadowValue.angle,o=this.shadowValue.distance,a=Math.cos(n*Math.PI/180)*o,l=Math.sin(n*Math.PI/180)*o,h=(e._w+2*i)*s+2*r,c=(e._h+2*i)*s+2*r,u=(e._w-h)/2,d=(e._h-c)/2,p=a+u,f=l+d;return[p*t,f*t,h*t,c*t]},setFillColor:function(t){t=this._util.parseColor(t),this.fillcolor=this._util.getColorHexString(t),this._firePaintRequest({fillcolor:this.fillcolor})},getFillColor:function(){return this.fillcolor?this.fillcolor:this._util.parseColor(this.element.find(this.rootshapeJQueryId).css("fill")).toHexString()},setLineColor:function(t){t=this._util.parseColor(t),this.linecolor=this._util.getColorHexString(t),this._firePaintRequest({linecolor:this.linecolor})},getLineColor:function(){return this.linecolor},setTextColor:function(t){t=this._util.parseColor(t),this.textColorValue=this._util.getColorHexString(t),this._firePaintRequest({textcolor:this.textColorValue})},getTextColor:function(){return this.textColorValue},setLineWeight:function(t){this.lineWidth=this._util.parseInt(t),this._firePaintRequest({linewidth:this.lineWidth})},getLineWeight:function(){return this.lineWidth},setText:function(t){this.textValue=this._util.parseString(t),this._firePaintRequest({text:this.textValue})},getText:function(){return this.textValue},highlight:function(t){var e=this.element.find(this.rootshapeJQueryId),i=this.element.find("#highlightshape");t?0==i.length&&(i=e.clone().appendTo(e.parent()),i.attr("id","highlightshape"),i.css("fill","orange"),i.css("opacity","0.4"),i.attr("class","notouch"),i.css("pointer-events","")):i.length>0&&i.remove()},refreshScale:function(t,e){if(t>0){t/=100;var i=this.options._x-this.getPosOffset()+Math.floor((1-t)*this.options._w/2),s=this.options._y-this.getPosOffset()+Math.floor((1-t)*this.options._h/2),r=(this.options._w+this.getSizeOffset())*t,n=(this.options._h+this.getSizeOffset())*t;this.element.css("left",i+"px"),this.element.css("top",s+"px"),this.element.css("width",r+"px"),this.element.css("height",n+"px"),this.scaleValue=100*t,this.setTextStyleValue(this.div,-this.options.margin*t,-this.options.margin*t,r+2*this.options.margin*t,n+2*this.options.margin*t),this.setTextStyleValue(this.textflow,this.options.margin*t,this.options.margin*t,r,n);var o,a,l=r-20;if(this.textValue==this.options.text)this.drawText("shapetext",this.options.text,this.text,this.options.font,this.options.align,this.textColorValue,l,t,this.attr,void 0),o=this.text.width(),a=this.text.height();else{this.setTextStyleValue(this.text,0,0,r-20,n);var h=this.options.font.fontSize,c=h*t;this.options.font.fontSize=c,this.drawText("shapetext",this.textValue,this.text,this.options.font,this.options.align,this.textColorValue,-1*l),this.options.font.fontSize=h,o=this.text.css("width").replace("px","")+1,a=this.text.css("height").replace("px",""),this.options.underline&&this.replaceAttrValue(this.text,"text-decoration","underline")}var u=(r-o)/2;switch(this.options.align){case 0:u=10;break;case 2:u=r-10-o}var d=(n-a)/2;if(a>n&&(d=0),this.setTextStyleValue(this.text,d,u,o,a),this.element.find(this.rootshapeJQueryId).attr("transform","translate("+this.getTranslateValue()*t+","+this.getTranslateValue()*t+") scale("+t+") "),void 0!=this.shadowValue&&"use"==this.shadowValue.shadow){this.shadowdiv.attr("style","position:absolute; text-align:center;");var p=this.getShadowBounds();this.setTextStyleValue(this.shadowdiv,p[1],p[0],p[2],p[3]),this.element.find("#"+this.rootshapeShadowId).attr("transform","scale("+t*this.shadowValue.size/100+") ")}}},getScale:function(){return this.scaleValue},setScale:function(t){t=this._util.parseNumber(t),t>0&&(this.oldscaleValue=this.scaleValue,this.scaleValue=t,this._firePaintRequest({scale:this.scaleValue}))},getTransparency:function(){return this.transparency},setTransparency:function(t){t=this._util.parseNumber(t),this._util.isValidTransparencyValue(t)&&(this.transparency=t,this._firePaintRequest({transparency:this.transparency}))},setTextStyleValue:function(t,e,i,s,r){var n="center";switch(this.options.align){case 0:n="left";break;case 1:n="center";break;case 2:n="right"}this.replaceAttrValue(t,"position","absolute"),this.removeAttrValue(t,"text-align"),null!=s&&this.replaceAttrValue(t,"width",s),null!=r&&this.replaceAttrValue(t,"height",r),null!=e&&this.replaceAttrValue(t,"top",e),null!=i&&this.replaceAttrValue(t,"left",i),this.replaceAttrValue(t,"text-align",n)},replaceAttrValue:function(t,e,i){if(!(t.length<1)){i=this._util.parseString(i);var s=t.attr("style");if(void 0==s&&(t.attr("style","position:absolute;"),s=t.attr("style")),-1==s.search(e+":absolute"))if(-1==s.search(e))s+="top"==e||"left"==e||"width"==e||"height"==e?e+":"+i+"px;":e+":"+i+";",t.attr("style",s);else{var r=s.substring(0,s.search(e)),n=s.substring(s.indexOf(";",s.search(e))+1,s.length+1);"top"==e||"left"==e||"width"==e||"height"==e?t.attr("style",r+e+":"+i+"px;"+n):t.attr("style",r+e+":"+i+";"+n)}}},removeAttrValue:function(t,e){var i=t.attr("style");if(!(t.length<1)&&(void 0==i&&(t.attr("style","position:absolute;"),i=t.attr("style")),-1!=i.search(e))){var s=i.substring(0,i.search(e)),r=i.substring(i.indexOf(";",i.search(e))+1,i.length+1);t.attr("style",s+r)}},getXAPIResult:function(){var t=this._super();return t.response=this.clkCnt+"",t},_paintWidgetShow:function(t){if(_.has(t,"text")&&(this.text.empty(),this.textValue=t.text,this.refreshScale(this.scaleValue)),_.has(t,"fillcolor")&&(this.fillcolor=t.fillcolor,this.element.find(this.rootshapeJQueryId).css("fill",this.fillcolor)),_.has(t,"linecolor")&&(this.linecolor=t.linecolor,this.element.find(this.rootshapeJQueryId).css("stroke",this.linecolor)),_.has(t,"textcolor")&&(this.textColorValue=t.textcolor,this.refreshScale(this.scaleValue)),_.has(t,"linewidth")){this.lineWidth=t.linewidth,this.element.find(this.rootshapeJQueryId).css("stroke-width",this.lineWidth);var e=$(this.rootshapeJQueryId).find("rect");if(0!=e.length){var i=e.eq(0);0==this.lineWidth?(i.attr("width",this.options._w),i.attr("height",this.options._w)):(i.attr("width",this.options._w-1),i.attr("height",this.options._w-1))}this.refreshScale(this.scaleValue)}if(_.has(t,"scale")&&t.scale>0&&(this.scaleValue=t.scale,this.refreshScale(this.scaleValue)),_.has(t,"transparency")){this.transparency=t.transparency;var s=1-this.transparency/100;this.textflow.css("opacity",s),this.element.find(this.rootshapeJQueryId).css("opacity",s),this.element.find("#"+this.rootshapeId+"_shadow").css("opacity",s)}this._super(t)},getFxElement:function(){return this.element},_refreshFxElement:function(){this.getFxElement().find("use").attr("xlink:href",this.getFxElement().find("use").attr("xlink:href"))},getPos:function(){var t=this._super();return t.left=t.left+this.getPosOffset(),t.top=t.top+this.getPosOffset(),t},setPos:function(t){var e=this._util.parsePosition(t),i={};i.left=Math.round(e[0])-this.getPosOffset(),i.top=Math.round(e[1])-this.getPosOffset(),this._super(i)},_init:function(){this._debug("init called");var t=this;this.element.find(this.rootshapeJQueryId).click(function(){void 0!=t.options.link&&""!=t.options.link&&t.handleLinkData(t.options.link),t.clkCnt++,t.fireEvent("onClick")}),this.element.find(this.rootshapeJQueryId).dblclick(function(){t.fireEvent("onDoubleClick")}),this.element.find(this.rootshapeJQueryId).mouseover(function(){t.fireEvent("onRollover")}),this.element.find(this.rootshapeJQueryId).mouseout(function(){t.fireEvent("onRollout")})},getPosOffset:function(){return Math.floor(this.lineWidth/2)},getSizeOffset:function(){return 2*this.getPosOffset()},getTranslateValue:function(){return this.options.margin+this.lineWidth/2}}),a.getShortUIKey()}),define("wgt/com.smartbuilder.axon.widget.text.text/s",["module","underscore","sb4core/sbobj"],function(t,e,i){var s=t.config(),r=s.widgetsvc,n=r.getShortUIKey();return $.widget(r.getFullUIKey(),$.sb4[i],{options:{text:"",underline:!1,align:0,color:"#000000",link:void 0,font:{fontSize:24,fontFamily:"Arial",fontWeight:"",fontStyle:""},canvasheight:0,fixedheight:!1,canvaswidth:0,outborderweight:0,bordercolor:"#000000",bgcolor:"#000000",transparent:!1},_create:function(){var t=this.options;if(this.element.addClass(n),this._super(),this.applyProfileFlag||(this.flag=!1,this.text=t.text,this.scale=1,this.attr={},this.attr.color=this._util.parseColor(t.color),this.attr.fontFamily=t.font.fontFamily,this.attr.fontWeight=t.font.fontWeight,this.attr.fontStyle=t.font.fontStyle),this.outborderweight=t.outborderweight,this.element.css({left:t._x-this.outborderweight+"px",top:t._y-this.outborderweight+"px"}),this.h=t._h,this.w=t._w,this.attr.textAlign=1==t.align?"center":2==t.align?"right":"left",t.underline&&(this.attr.textDecoration="underline"),t.dir&&(this.attr.dir="rtl"),this.div=$("<div>").appendTo(this.element),this.div.css("position","absolute"),this.div.css("overflow","hidden"),this.styleName=t.styleName,e.str.startsWith(this.styleName,"Heading")){var i=parseInt(this.styleName.substring("Heading".length));0/0!=i&&(this.div.attr("role","heading"),this.div.attr("aria-level",i+""))}if(1!=this.scale){var s=this.scale;this.h=s*t._h,this.w=s*t._w,this.element.css({left:t._x-(s*t._w-t._w)/2,top:t._y-(s*t._h-t._h)/2,width:s*t._w,height:s*t._h})
}},setText:function(t){var e=this.options;this.flag=!0,t=this._util.parseString(t),this.text=t,this._firePaintRequest()},refreshText:function(){var t=this.options,e=this.element;if(t.fixedheight){this.div.css("width","auto"),this.div.css("height","auto");var i=this.div.get(0).offsetHeight;i>this.h?(this.element.css("overflow","hidden"),this.div.css("width",t._w-16+"px"),null==this.scrollbar&&(this.scrollbar=document.createElement("div"),this.element.get(0).appendChild(this.scrollbar)),this.scrollbar.style.width="16px",this.scrollbar.style.height=this.h+"px",this.scrollbar.style.position="absolute",this.scrollbar.style.top="0px",this.scrollbar.style.left=this.w-16+"px",$(this.scrollbar).empty(),$(this.scrollbar).scrollbar(this.div.get(0))):null!=this.scrollbar&&($(this.scrollbar).remove(),this.scrollbar=null)}else 0!=this.div.height()&&(e=this.div),this.div.get(0).scrollHeight>this.div.get(0).clientHeight&&this.div.removeClass("notouch");t.outborderweight>0&&(e.css("border-width",t.outborderweight),e.css("border-color",t.bordercolor),e.css("border-style","solid")),t.transparent&&e.css("background-color",t.bgcolor)},getText:function(){return this.text},getTextColor:function(){return this._util.parseColor(this.attr.color).toHexString(!1)},setTextColor:function(t){var e=this.options;t=this._util.parseColor(t),this.attr.color=t,this._firePaintRequest()},setScale:function(t){var e=this._util.parseNumber(t);e/=100,e>0&&(this.scale=e,this._firePaintRequest({scale:e}))},appendText:function(t){var e=this.options;t=this._util.parseString(t),this.text=this.text+t,this.flag=!0,this._firePaintRequest()},appendTextOnNewLine:function(t){var e=this.options;t=this._util.parseString(t),this.text=this.text+"\n"+t,this.flag=!0,this._firePaintRequest()},isBlank:function(t){return!t||""===$.trim(t)},getPos:function(){var t=this._super();return t.left=t.left+this.outborderweight*this.scale,t.top=t.top+this.outborderweight*this.scale,t},setPos:function(t){t=this._util.parsePosition(t);var e={};e.left=t[0]-this.outborderweight*this.scale,e.top=t[1]-this.outborderweight*this.scale,this._super(e)},arrayRemove:function(t,e){var i=[];if(isNaN(e)||e>t.length)return!1;for(var s=0;s<t.length;s++)t[s]!=t[e]&&i.push(t[s]);return i},_init:function(){this._super()},_paintWidgetShow:function(t){var i=this.options;if(e.has(t,"scale")){var s=this.scale;this.h=s*i._h,this.w=s*i._w,this.element.css({left:i._x-(s*i._w-i._w)/2,top:i._y-(s*i._h-i._h)/2,width:s*i._w,height:s*i._h})}this.flag?(this.drawText("",this.text,this.div,i.font,null,this.attr.color,-this.options.canvaswidth,this.scale,this.attr,i.link),i.dir&&this.div.attr("dir","rtl")):(this.drawText("",this.text,this.div,i.font,null,this.attr.color,this.options.canvaswidth,this.scale,this.attr,i.link),i.dir&&this.div.attr("dir","rtl")),this.refreshText(),this.setScreenReaderElement(this.getTabElementMap()),this.div.hasClass("notouch")&&!this.scrollbar?0==this.getDraggable()&&this.element.addClass("notouch"):this.element.removeClass("notouch"),this._super(t)},getTabElementMap:function(){var t={};return t.texts=this.getTabElementLabel(),t.tabElements=this.createTabElement(),t},getTabElementLabel:function(){var t=[];return t.push(this.text),t},createTabElement:function(){var t=this.options,e=this,i=[];if(t.link){var s=this.getScreenReaderTabElement();if(s){var r=s[0];return r.css("width",this.div.css("width")),r.css("height",this.div.css("height")),s}this.tabDiv?this.tabDiv.empty():(this.tabDiv=$("<div>").appendTo(this.element),this.tabDiv.addClass("notouch"));var r=$("<a>").appendTo(this.tabDiv);r.css("display","block"),r.css("width",this.div.css("width")),r.css("height",this.div.css("height")),r.attr("href",t.link.link),r.click(function(){event.preventDefault(),SB4API.linkLib.handleLinkData(e,t.link)}),i.push(r)}return i},doSetFocus:function(t){var e=this,i=this.options;i.link?this._super(t):(t=$(t),t.attr("tabindex","1"),t.on("blur",function(){t.removeAttr("tabindex"),t.off("blur"),e.div.children("canvas").length>=1&&t.remove()}),t.focus())},focus:function(){var t=this.options;if(t.link){var e=this.getScreenReaderTabElement();if(e&&0!=e.length){var i=e[0];this.doSetFocus(i)}}else if(this.div.children("canvas").length>=1){var s=$("<div>");s.text(this.text),s.css("width",this.div.css("width")),s.css("height",this.div.css("height")),s.css("color","rgba(255,255,255,0)"),s.appendTo(this.element),s.css("position","absolute"),s.addClass("notouch"),this.doSetFocus(s)}else this.doSetFocus(this.div)},setAccessibilityHidden:function(t){this.element.attr("aria-hidden",t);var e=this.getScreenReaderTabElement();if(e&&0!=e.length)for(var i=0;i<e.length;i++){var s=e[i];s.attr("aria-hidden",t)}},_destroy:function(t){this._super(t),this.scrollbar=null}}),r.getShortUIKey()}),define("lib/css!widgets/com.smartbuilder.axon.widget.text.richtext/style",[],function(){}),define("wgt/com.smartbuilder.axon.widget.text.richtext/s",["module","underscore","sb4core/sbobj","css!widgets/com.smartbuilder.axon.widget.text.richtext/style.css"],function(t,e,i){var s=t.config(),r=s.widgetsvc,n=r.getShortUIKey();return $.widget(r.getFullUIKey(),$.sb4[i],{options:{html:"",canvasheight:0,fixedheight:!1,canvaswidth:0,outborderweight:0,bordercolor:"#000000",bgcolor:"#000000",transparent:!1},_create:function(){var t=this.options;this.element.addClass(n),this._super(),this.applyProfileFlag||(this.formathtml=t.html,this.attr={},this.flag=null),this.outborderweight=t.outborderweight,this.element.css({left:t._x-this.outborderweight+"px",top:t._y-this.outborderweight+"px"});var i='<div style="position:absolute">'+this.formathtml+"</div>";this.text="";try{var s=$(i);this.text=s.text(),this.formathtml=s.html();var r=this.getFirstTextNode(s.get(0));this.getFirstTextStyle(s.get(0),r,this.attr)}catch(o){}if(this.div=$("<div>").appendTo(this.element),this.div.css("position","absolute"),this.styleName=t.styleName,e.str.startsWith(this.styleName,"Heading")){var a=parseInt(this.styleName.substring("Heading".length));0/0!=a&&(this.div.attr("role","heading"),this.div.attr("aria-level",a+""))}},createNewHtml:function(t,e,i){var s=null;if(e!=t){s=this.createNewHtml(t,e.parentNode,i);var r=e.cloneNode(!1);s.appendChild(r),s=r}else s=i;return s},delColorStyle:function(t){if(t.hasChildNodes())for(var e=t.childNodes,i=0;i<e.length;i++){var s=e[i];1==s.nodeType&&($(s).css("color",""),this.delColorStyle(s))}},setText:function(t){var i=this.options;this.flag="text",t=this._util.parseString(t),this.text=t;var s=$("<p>");void 0!=this.attr&&e.each(this.attr,function(t,e){s.css(e,t)}),s.text(t),this.formathtml=s.get(0).outerHTML,this._firePaintRequest()},refreshText:function(){var t=this.options,e=this.element;if(t.fixedheight){this.div.css("width","auto"),this.div.css("height","auto");var i=this.div.get(0).offsetHeight;i>t._h?(this.element.css("overflow","hidden"),null==this.scrollbar?(this.div.css("width",t._w-16+"px"),this.scrollbar=document.createElement("div"),this.scrollbar.style.width="16px",this.scrollbar.style.height=t._h+"px",this.scrollbar.style.position="absolute",this.scrollbar.style.top="0px",this.scrollbar.style.left=t._w-16+"px",this.element.get(0).appendChild(this.scrollbar),this.div.css("width",t._w-16+"px")):this.div.css("width",t._w-16+"px"),$(this.scrollbar).empty(),$(this.scrollbar).scrollbar(this.div.get(0)),this.div.removeClass("notouch")):null!=this.scrollbar&&($(this.scrollbar).remove(),this.scrollbar=null)}else 0!=this.div.height()&&(e=this.div),this.div.get(0).scrollHeight>this.div.get(0).clientHeight&&this.div.removeClass("notouch");t.outborderweight>0&&(e.css("border-width",t.outborderweight),e.css("border-color",t.bordercolor),e.css("border-style","solid")),t.transparent&&e.css("background-color",t.bgcolor)},getText:function(){return this.text},setTextColor:function(t){var i=this.options;null==this.flag&&(this.flag="color"),t=this._util.parseColor(t),this.attr.color=t;var s=$("<p>");void 0!=this.attr&&e.each(this.attr,function(t,e){s.css(e,t)}),s.text(this.text),this.formathtml=s.get(0).outerHTML,this._firePaintRequest()},appendTextOnNewLine:function(t){t=this._util.parseString(t),this.flag="append";var i=$("<p>");void 0!=this.attr&&e.each(this.attr,function(t,e){i.css(e,t)}),i.text(t);var s=$("<div>");this.formathtml=this.formathtml+"\n"+i.get(0).outerHTML,s.html(this.formathtml),this.text=s.text(),this._firePaintRequest()},setFormattedText:function(t){this.flag="format",t=this._util.parseString(t),this.formathtml=t;var i=$("<p>");void 0!=this.attr&&e.each(this.attr,function(t,e){i.css(e,t)}),i.html(t),this.text=i.text(),this._firePaintRequest()},getFirstTextStyle:function(t,e,i){if(e!=t){this.getFirstTextStyle(t,e.parentNode,i);var s=e.getAttribute("style"),r=e.getAttribute("dir");this.getFontStyle(s,i,r)}else{var s=t.getAttribute("style"),r=e.getAttribute("dir");this.getFontStyle(s,i,r),void 0==i.fontSize&&(i.fontSize="16px"),void 0==i.fontFamily&&(i.fontFamily="Arial"),void 0==i.color&&(i.color="#000000"),void 0==i.bgcolor&&(i.bgcolor="#ffffff")}},getFirstTextNode:function(t){var e=null;if(t.hasChildNodes())for(var i=t.childNodes,s=0;s<i.length;s++)if(3!=i[s].nodeType){if(e=this.getFirstTextNode(i[s]),null!=e)break}else{var r=i[s].nodeValue;if(!this.isBlank(r)){e=t;break}}return e},isBlank:function(t){return!t||""===$.trim(t)},arrayRemove:function(t,e){var i=[];if(isNaN(e)||e>t.length)return!1;for(var s=0;s<t.length;s++)t[s]!=t[e]&&i.push(t[s]);return i},getPos:function(){var t=this._super();return t.left=t.left+this.outborderweight,t.top=t.top+this.outborderweight,t},setPos:function(t){t=this._util.parsePosition(t);var e={};e.left=t[0]-this.outborderweight,e.top=t[1]-this.outborderweight,this._super(e)},getFontStyle:function(t,e,i){if(null!=t)for(var s=t.split(";"),r=0;r<s.length;r++){var n=s[r].split(":");"font-size"==n[0].trim()?e.fontSize=n[1].trim():"color"==n[0].trim()?e.color=n[1].trim():"font-weight"==n[0].trim()?e.fontWeight=n[1].trim():"font-style"==n[0].trim()?e.fontStyle=n[1].trim():"font-family"==n[0].trim()?e.fontFamily=n[1].trim():"margin-left"==n[0].trim()?e.marginLeft=n[1].trim():"margin-right"==n[0].trim()?e.marginRight=n[1].trim():"text-align"==n[0].trim()?e.textAlign=n[1].trim():"background-color"==n[0].trim()?e.bgcolor=n[1].trim():"text-decoration"==n[0].trim()?e.underline=n[1].trim():"isli"==n[0].trim()&&(e.isli=n[1].trim())}null!=i&&(e.dir=i)},_init:function(){this._debug("init called")},_paintWidgetShow:function(t){null==this.flag?this.drawRichText("",this.formathtml,this.div,null,this.options.canvaswidth):"color"==this.flag?this.drawRichText("",this.formathtml,this.div,null,this.options.canvaswidth,this.attr):"format"==this.flag?this.drawRichText("",this.formathtml,this.div,null,-this.options.canvaswidth,this.attr):"append"==this.flag?this.drawRichText("",this.formathtml,this.div,null,-this.options.canvaswidth,this.attr):this.drawText("",this.text,this.div,null,null,null,-this.options.canvaswidth,null,this.attr),this.refreshText(),this.setScreenReaderElement(this.getTabElementMap()),this.div.hasClass("notouch")&&!this.scrollbar?0==this.getDraggable()&&this.element.addClass("notouch"):this.element.removeClass("notouch"),this._super(t)},getTabElementMap:function(){var t={};return t.texts=this.getTabElementLabel(),t.tabElements=this.createTabElement(),t},getTabElementLabel:function(){var t=[],e='<div style="position:absolute">'+this.formathtml+"</div>";try{var i=$(e),s=$("a",i),r=$("a",this.element);if(r.length>0)return t;if(s.length>0)for(var n=0;n<s.length;n++)t.push(s.eq(n).text())}catch(o){}return t},createTabElement:function(){var t=this.options,i=this,s=[],r='<div style="position:absolute">'+this.formathtml+"</div>";try{var n=$(r),o=$("a",n),a=$("a",this.element);if(a.length>0)for(var l=0;l<a.length;l++){var h=a.eq(l);s.push(h)}else if(o.length>0)for(var l=0;l<o.length;l++){var h=o.eq(l);h.text(""),h.css("display","block"),h.css("width",this.div.css("width")),h.css("height",this.div.css("height"));var c=h.attr("href");e.string.startsWith(c,"evt://")&&(h.removeAttr("onclick"),h.click(function(t){t.preventDefault();var i=$(this).attr("href");if(i){var s=i.split("::");if(void 0!=s[2]&&""!=s[2]){var r=s[2].split(",");void 0==s[0]&&(s[0]=""),void 0==s[1]&&(s[1]=""),s[1]=e.string.trim(r[0]," '");var n=r.splice(1);s[2]=e.string.trim(n.join()," '")}SB4API.linkLib.openHyperLink(wgt,s[0],s[1],s[2])}})),s.push(h),h.appendTo(this.tabDiv)}}catch(u){}return s},doSetFocus:function(t){var e=this,i=this.options;t=$(t),t.attr("tabindex","1"),t.on("blur",function(){t.removeAttr("tabindex"),t.off("blur"),t.remove()}),t.focus()},focus:function(){var t=$("<div>");t.text(this.text),t.css("color","rgba(255,255,255,0)"),t.css("width",this.div.css("width")),t.css("height",this.div.css("height")),t.css("position","absolute"),t.addClass("notouch"),this.element.append(t),this.doSetFocus(t)},setAccessibilityHidden:function(t){this.element.attr("aria-hidden",t);var e=this.getScreenReaderTabElement();if(e&&0!=e.length)for(var i=0;i<e.length;i++){var s=e[i];s.attr("aria-hidden",t)}},_destroy:function(t){this._super(t),this.scrollbar=null}}),r.getShortUIKey()}),define("text!widgets/com.smartbuilder.axon.widget.image/tpl.html",[],function(){return'<img alt="" src="<%- rc.img %>" />'}),define("text!widgets/com.smartbuilder.axon.widget.image/texttpl.html",[],function(){return'<div style="position:absolute;"><%- rc.text %></div>'}),define("lib/css!widgets/com.smartbuilder.axon.widget.image/style",[],function(){}),define("util/jquery-timer",["jquery"],function(jQuery){$.timer=function(func,time,autostart){return this.set=function(func,time,autostart){if(this.init=!0,"object"==typeof func){var paramList=["autostart","time"];for(var arg in paramList)void 0!=func[paramList[arg]]&&eval(paramList[arg]+" = func[paramList[arg]]");func=func.action}return"function"==typeof func&&(this.action=func),isNaN(time)||(this.intervalTime=time),autostart&&!this.active&&(this.active=!0,this.setTimer()),this},this.once=function(t){var e=this;return isNaN(t)&&(t=0),window.setTimeout(function(){e.action()},t),this},this.play=function(t){return this.active||(t?this.setTimer():this.setTimer(this.remaining),this.active=!0),this},this.pause=function(){return this.active&&(this.active=!1,this.remaining-=new Date-this.last,this.clearTimer()),this},this.stop=function(){return this.active=!1,this.remaining=this.intervalTime,this.clearTimer(),this},this.toggle=function(t){return this.active?this.pause():t?this.play(!0):this.play(),this},this.reset=function(){return this.active=!1,this.play(!0),this},this.clearTimer=function(){window.clearTimeout(this.timeoutObject)},this.setTimer=function(t){var e=this;"function"==typeof this.action&&(isNaN(t)&&(t=this.intervalTime),this.remaining=t,this.last=new Date,this.clearTimer(),this.timeoutObject=window.setTimeout(function(){e.go()},t))},this.go=function(){this.active&&(this.action(),this.setTimer())},this.init?new $.timer(func,time,autostart):(this.set(func,time,autostart),this)}}),define("wgt/com.smartbuilder.axon.widget.image/s",["module","sb4core/sbobj","text!widgets/com.smartbuilder.axon.widget.image/tpl.html","text!widgets/com.smartbuilder.axon.widget.image/texttpl.html","css!widgets/com.smartbuilder.axon.widget.image/style.css","util/jquery-timer"],function(t,e,i,s,r,r){var n=t.config(),o=n.widgetsvc,a=o.getShortUIKey();return $.widget(o.getFullUIKey(),$.sb4[e],{options:{textwidth:0,textheight:0,borderweight:0,outborderweight:0,bordercolor:"",captiontext:"",link:"",captionfont:{fontSize:16,fontFamily:"Arial",fontWeight:"",fontStyle:""},captionlocation:2,source:"",transparency:50,preload:!1,imagewidth:0,imageheight:0,shadowoffsetx:0,shadowoffsety:0,shadowradius:0,shadowsize:0,shadowalpha:0,shadowcolor:"#000000",hasshadow:!1,description:"",rotation:0},_create:function(){null==this.stateChangeMap&&(this.stateChangeMap={}),this.captiontextwidth=0,this.element.addClass(a),this._super();var t=this.options;this.applyProfileFlag||(this.scale=1),this.imageLoad=!1,this.currentBoundingWidth=t.currentBoundingWidth,this.currentBoundingHeight=t.currentBoundingHeight,this.currentWidth=t._w,this.currentHeight=t._h,_.has(this.stateChangeMap,"angle")||(this.angle=this.options.rotation),_.has(this.stateChangeMap,"outborderweight")||(this.outborderweight=t.outborderweight),_.has(this.stateChangeMap,"transparency")||(this.transparency=t.transparency),_.has(this.stateChangeMap,"captiontext")||(this.captiontext=t.captiontext),_.has(this.stateChangeMap,"bordercolor")||(this.bordercolor=this._util.parseColor(t.bordercolor)),this.borderweight=t.borderweight,this._createContent()},id:[0],_createShadow:function(){try{var t=this.options,e=t.imagewidth,i=t.imageheight,s=e*t.shadowsize/100,r=i*t.shadowsize/100,n=e*t.shadowsize/100+8*t.shadowradius,o=i*t.shadowsize/100+8*t.shadowradius;this._shadowdiv.css({width:n*this.scale,height:o*this.scale});var a=document.createElementNS("http://www.w3.org/2000/svg","svg");a.setAttribute("focusable","false"),a.setAttribute("width",n*this.scale),a.setAttribute("height",o*this.scale),a.style.postion="absolute",a.style.top=0,a.style.left=0,this._shadowdiv.get(0).appendChild(a);var l=document.createElementNS("http://www.w3.org/2000/svg","defs");a.appendChild(l);var h=document.createElementNS("http://www.w3.org/2000/svg","filter");h.setAttribute("id",this.id[0]),h.setAttribute("x","0"),h.setAttribute("y","0");var c=n/e,u=o/i;h.setAttribute("width",100*c+"%"),h.setAttribute("height",100*u+"%"),l.appendChild(h);var d=document.createElementNS("http://www.w3.org/2000/svg","feOffset");d.setAttribute("result","offOut"),d.setAttribute("in","SourceGraphic"),d.setAttribute("dx",4*t.shadowradius),d.setAttribute("dy",4*t.shadowradius),h.appendChild(d);var p=document.createElementNS("http://www.w3.org/2000/svg","feGaussianBlur");p.setAttribute("result","blurOut"),p.setAttribute("in","offOut"),p.setAttribute("stdDeviation",t.shadowradius),h.appendChild(p);var f=document.createElementNS("http://www.w3.org/2000/svg","rect");f.setAttribute("width",s),f.setAttribute("height",r),f.setAttribute("fill",t.shadowcolor),f.setAttribute("fill-opacity",(100-t.shadowalpha)/100),f.setAttribute("filter","url(#"+this.id[0]+")"),f.setAttribute("transform","scale("+this.scale+")"),a.appendChild(f),this.id[0]++}catch(g){}},getShadowLocation:function(){var t=this.options,e=t.imagewidth,i=t.imageheight,s=e*t.shadowsize/100+8*t.shadowradius,r=i*t.shadowsize/100+8*t.shadowradius,n=(e-s)/2,o=(i-r)/2,a=t.shadowoffsetx+n,l=t.shadowoffsety+o;return[a*this.scale,l*this.scale]},_createContent:function(){this.element.empty();var t=this,e=this.options;this.rotationdiv=$("<div>").appendTo(this.element),this.rotationdiv.css("position","absolute");var s=(e.imagewidth+2*this.outborderweight)*this.scale,n=(e.imageheight+2*this.outborderweight)*this.scale;this.rotationdiv.css({top:-this.outborderweight*this.scale,left:-this.outborderweight*this.scale,width:s,height:n}),this.rotationdiv.css("transform","rotate("+this.angle+"deg)"),_.templateSettings.variable="rc";var a=_.template(i),l={};l=""==e.source?{img:o.getWidgetAssetURI(this.options._i+".png")}:{img:o.getWidgetAssetURI(e.source)},e.hasshadow&&(this._shadowdiv=$("<div>").appendTo(this.rotationdiv),this._shadowdiv.css("position","absolute")),this._borderdiv=$("<div>").appendTo(this.rotationdiv),this._borderdiv.css("position","absolute"),this._inslideborderdiv=$("<div>").appendTo(this.rotationdiv),this._inslideborderdiv.css("position","absolute"),this.element.css({width:e._w*this.scale,height:e._h*this.scale,left:e._x-(e._w*this.scale-e._w)/2,top:e._y-(e._h*this.scale-e._h)/2}),""!=this.captiontext&&(this._textbox=$("<div>").appendTo(this.element),this._textbox.css("position","absolute"),this.drawText("",this.captiontext,this._textbox,e.captionfont,0,"#000000",this.captiontextwidth,this.scale));var h=a(l);this.img=$(h).get(0),this.img.onload=function(){t._borderdiv.text(""),t._borderdiv.css("text-align",""),t._borderdiv.css("line-height",""),t._borderdiv.css("background-color",""),$(t.img).appendTo(t._borderdiv),e.hasshadow&&t._createShadow();var i={x1:0,x2:1,y1:0,y2:1};e.crop&&(i=JSON.parse(e.crop)),t.normalWidth=parseInt(Math.round(e.imagewidth/(i.x2-i.x1))),t.normalHeight=parseInt(Math.round(e.imageheight/(i.y2-i.y1))),t.normalLeft=parseInt(Math.round(t.normalWidth*i.x1)),t.normalTop=parseInt(Math.round(t.normalHeight*i.y1)),$(t.img).attr("width",t.normalWidth*t.scale),$(t.img).attr("height",t.normalHeight*t.scale),$(t.img).css("position","absolute"),$(t.img).css("top",0-t.normalTop),$(t.img).css("left",0-t.normalLeft),t.imageLoad=!0},this._borderdiv.text(e.description),this._borderdiv.css("overflow","hidden"),this._borderdiv.css("text-align","center");var c=e.imagewidth*this.scale,u=e.imageheight*this.scale,d=e.imagewidth*this.scale,p=e.imageheight*this.scale,f=(e.imagewidth-2*this.borderweight)*this.scale,g=(e.imageheight-2*this.borderweight)*this.scale;t._borderdiv.css({width:d,height:p}),t._borderdiv.css("line-height",p+"px"),t._inslideborderdiv.css({width:f,height:g}),0!=this.outborderweight&&(t._borderdiv.css("border-width",this.outborderweight*this.scale+"px"),t._borderdiv.css("border-color",this.bordercolor),t._borderdiv.css("border-style","solid")),0!=this.borderweight&&(t._inslideborderdiv.css("border-width",this.borderweight*this.scale+"px"),t._inslideborderdiv.css("border-color",this.bordercolor),t._inslideborderdiv.css("border-style","solid"));var v=[0,0];""!=this.captiontext&&(0==this.captiontextwidth?(v[0]=e.textwidth*this.scale,v[1]=e.textheight*this.scale):(v=t.measureText(this.captiontext,e.captionfont.fontWeight,e.captionfont.fontFamily,e.captionfont.fontSize),v[0]=v[0]*this.scale,v[1]=v[1]*this.scale,t._textbox.css("overflow","visible"),t._textbox.css("white-space","nowrap"))),this.shadowx=0;var m=0,b=0;this.shadowy=0;var x=0,y=0,w=(e.shadowoffsetx-2*e.shadowradius)*this.scale,S=(e.shadowoffsety-2*e.shadowradius)*this.scale,T=this.getShadowLocation();this.shadowx=T[0],this.shadowy=T[1],m=this.outborderweight*this.scale+(c-v[0])/2,x=1==e.captionlocation?this.outborderweight*this.scale+(u-v[1])/2:0==e.captionlocation?this.outborderweight*this.scale-v[1]-(this._inslideborderdiv.get(0).getBoundingClientRect().height-u)/2*this.scale:this.outborderweight*this.scale+(u+this._inslideborderdiv.get(0).getBoundingClientRect().height)/2*this.scale;var E=this.element.get(0).getBoundingClientRect().top;x=1==e.captionlocation?this.outborderweight*this.scale+(u-v[1])/2:0==e.captionlocation?this.outborderweight*this.scale-v[1]+(this._inslideborderdiv.get(0).getBoundingClientRect().top-E):this.outborderweight*this.scale+this._inslideborderdiv.get(0).getBoundingClientRect().bottom-E,this.shadowx=this.shadowx+this.outborderweight*this.scale,this.shadowy=this.shadowy+this.outborderweight*this.scale,null!=t._textbox&&(t._textbox.css("top",x+"px"),t._textbox.css("left",m+"px")),t._borderdiv.css("top","0px"),t._borderdiv.css("left","0px"),t._inslideborderdiv.css("top",this.borderweight*this.scale+"px"),t._inslideborderdiv.css("left",this.borderweight*this.scale+"px"),e.hasshadow&&(t._shadowdiv.css("top",this.shadowy+"px"),t._shadowdiv.css("left",this.shadowx+"px")),this._inslideborderdiv.addClass("notouch"),this.element.css("opacity",(100-this.transparency)/100),this._borderdiv.mouseover($.proxy(function(){this.fireEvent("onRollover")},this)),this._borderdiv.mouseout($.proxy(function(){this.fireEvent("onRollout")},this)),this._borderdiv.click($.proxy(function(){this.fireEvent("onClick"),this.options.link!=r&&""!=this.options.link&&this.handleLinkData(this.options.link)},this)),this._borderdiv.dblclick($.proxy(function(){this.fireEvent("onDoubleClick")},this)),this.setScreenReaderElement(this.getTabElementMap())},_init:function(){this._debug("init called")},_changeContent:function(){var t=this,e=this.options,i=(e.imagewidth+2*this.outborderweight)*this.scale,s=(e.imageheight+2*this.outborderweight)*this.scale;this.rotationdiv.css({top:-this.outborderweight*this.scale,left:-this.outborderweight*this.scale,width:i,height:s});var r=e.imagewidth*this.scale,n=e.imageheight*this.scale;if(this._inslideborderdiv.css({top:this.borderweight*this.scale,left:this.borderweight*this.scale,width:(e.imagewidth-2*this.borderweight)*this.scale,height:(e.imageheight-2*this.borderweight)*this.scale}),0!=this.borderweight?(this._inslideborderdiv.css("border-width",this.borderweight*this.scale+"px"),this._inslideborderdiv.css("border-color",this.bordercolor),this._inslideborderdiv.css("border-style","solid")):this._inslideborderdiv.css("border",""),this._borderdiv.css({top:0,left:0,width:r,height:n}),this._borderdiv.css("line-height",n+"px"),0!=this.outborderweight&&(this._borderdiv.css("border-width",this.outborderweight*this.scale+"px"),this._borderdiv.css("border-color",this.bordercolor),this._borderdiv.css("border-style","solid")),null!=this._textbox&&this._textbox.remove(),this.imageLoad&&(e.hasshadow&&(this._shadowdiv.empty(),this._createShadow(),this._shadowdiv.css("top",this.shadowy*this.scale+"px"),this._shadowdiv.css("left",this.shadowx*this.scale+"px")),$(this.img).attr("width",t.normalWidth*t.scale),$(this.img).attr("height",t.normalHeight*t.scale),$(this.img).css("top",0-t.normalTop),$(this.img).css("left",0-t.normalLeft)),this.element.css({width:e._w*this.scale,height:e._h*this.scale,left:e._x-(e._w*this.scale-e._w)/2,top:e._y-(e._h*this.scale-e._h)/2}),""!=this.captiontext){var o=e.imagewidth*this.scale,a=e.imageheight*this.scale;this._textbox=$("<div>").appendTo(this.element),this._textbox.css("position","absolute"),this.drawText("",this.captiontext,this._textbox,e.captionfont,0,"#000000",this.captiontextwidth,this.scale);var l=[0,0];0==this.captiontextwidth?(l[0]=e.textwidth*this.scale,l[1]=e.textheight*this.scale):(l=this.measureText(this.captiontext,e.captionfont.fontWeight,e.captionfont.fontFamily,e.captionfont.fontSize),l[0]=l[0]*this.scale,l[1]=l[1]*this.scale,this._textbox.css("overflow","visible"),this._textbox.css("white-space","nowrap"));var h=this.element.get(0).getBoundingClientRect().top,c=0,u=0;c=this.outborderweight*this.scale+(o-l[0])/2,u=1==e.captionlocation?this.outborderweight*this.scale+(a-l[1])/2:0==e.captionlocation?this.outborderweight*this.scale-l[1]+(this._inslideborderdiv.get(0).getBoundingClientRect().top-h):this.outborderweight*this.scale+this._inslideborderdiv.get(0).getBoundingClientRect().bottom-h,this._textbox.css("top",u+"px"),this._textbox.css("left",c+"px")}},setTransparency:function(t){var e=this.options,i=this._util.parseInt(t);i>100&&(i=100),0>i&&(i=0),this.transparency!=i&&(this.transparency=i,this.addChangeState("transparency",this.transparency),this._firePaintRequest({transparency:i}))},getTransparency:function(){var t=this.options;return this.transparency},setBorderWeight:function(t){var e=this._util.parseInt(t);e>5&&(e=5),0>e&&(e=0),this.outborderweight=e,this.addChangeState("outborderweight",this.outborderweight),this._firePaintRequest({change:!0})},getBorderWeight:function(){return this.outborderweight},setBorderColor:function(t){var e=this.options,i=this._util.parseColor(t);this.bordercolor.toHexString()!=i.toHexString()&&(this.bordercolor=i,this.addChangeState("bordercolor",this.bordercolor),this._firePaintRequest({borderColor:i}))},getBorderColor:function(){return this._util.parseColor(this.bordercolor).toHexString(!1)},setScale:function(t){var e=this._util.parseNumber(t);e/=100,e>0&&(this.scale=e,this._firePaintRequest({scale:e}))},getScale:function(){return 100*this.scale},setCaptionText:function(t){var e=this.options,i=this._util.parseString(t);this.captiontext=i,this.captiontextwidth=-1,this.addChangeState("captiontext",this.captiontext),this._firePaintRequest({change:!0})},getCaptionText:function(){return this.captiontext},getPos:function(){var t=this._super();return this.currentBoundingWidth&&this.currentWidth&&(t.left=t.left-(this.currentBoundingWidth-this.currentWidth)/2,t.left=Math.round(t.left),t.top=t.top-(this.currentBoundingHeight-this.currentHeight)/2,t.top=Math.round(t.top)),t},setPos:function(t){if(this.currentBoundingWidth&&this.currentWidth){t=this._util.parsePosition(t);var e=Math.round(t[0]+(this.currentBoundingWidth-this.currentWidth)/2),i=Math.round(t[1]+(this.currentBoundingHeight-this.currentHeight)/2),s={};s.left=e,s.top=i,this._super(s)}else this._super(t)},getFxElement:function(){return this.element},_paintWidgetShow:function(t){if(_.has(t,"borderColor")&&this._borderdiv.css("border-color",t.borderColor),_.has(t,"transparency")&&this.element.css("opacity",(100-t.transparency)/100),_.has(t,"change")&&this._changeContent(),_.has(t,"scale")&&this._changeContent(),_.has(t,"angle")){this.intervalId&&clearInterval(this.intervalId);var e=this,i=this.rotationdiv[0].style.transform,s=i.split("("),r=s[1].substring(0,s[1].length-4);r=parseFloat(r),r=Math.round(r);var n=t.angle,o=n-r;if(0>o&&(o+=360),0!=o){var a=o/10;this.intervalId=setInterval(function(){e.rotateImage(a,o)},40)}}this.currentWidth=this._inslideborderdiv.get(0).offsetWidth,this.currentHeight=this._inslideborderdiv.get(0).offsetHeight,this.currentBoundingWidth=this._inslideborderdiv.get(0).getBoundingClientRect().width,this.currentBoundingHeight=this._inslideborderdiv.get(0).getBoundingClientRect().height,this._super(t)},getTabElementMap:function(){var t={};return t.texts=this.getTabElementLabel(),t.tabElements=this.createTabElement(),t},getTabElementLabel:function(){var t=[];return t.push(this.options.description),t},createTabElement:function(){var t=this.options,e=this,i=[];if(t.link){var s=this.getScreenReaderTabElement();if(s){var n=s[0];return n.css("width",this.element.css("width")),n.css("height",this.element.css("height")),s}this.tabDiv?this.tabDiv.empty():(this.tabDiv=$("<div>").appendTo(this.element),this.tabDiv.addClass("notouch"));var n=$("<a>").appendTo(this.tabDiv);n.css("display","block"),n.css("width",this.element.css("width")),n.css("height",this.element.css("height")),n.attr("href",t.link.link),n.click(function(){event.preventDefault(),e.options.link!=r&&""!=e.options.link&&e.handleLinkData(e.options.link)}),i.push(n)}return i},setAngle:function(t){t=this._util.parseNumber(t),t%=360,t!=this.angle&&(this.angle=t,this.addChangeState("angle",this.angle),this._firePaintRequest({angle:t}))},getAngle:function(){return this.angle},rotateImage:function(t,e){var i=this,s=i.rotationdiv[0].style.transform,n=s.split("("),o=n[1].substring(0,n[1].length-4);o=parseFloat(o),o=10*o,o=Math.round(o),o/=10,o==e?(clearInterval(i.intervalId),i.intervalId=r,i.currentWidth=i._inslideborderdiv.get(0).offsetWidth,i.currentHeight=i._inslideborderdiv.get(0).offsetHeight,i.currentBoundingWidth=i._inslideborderdiv.get(0).getBoundingClientRect().width,i.currentBoundingHeight=i._inslideborderdiv.get(0).getBoundingClientRect().height,i._changeContent()):(o+=t,o%=360,i.rotationdiv.css("transform","rotate("+o+"deg)"))},focus:function(){var t=this.options;if(t.link){var e=this.getScreenReaderTabElement();if(e&&0!=e.length){var i=e[0];this.doSetFocus(i)}}},addChangeState:function(t,e){this.stateChangeMap[t]=e}}),a}),define("text!widgets/com.smartbuilder.axon.widget.button/svg.html",[],function(){return'<div\n	style="position: relative; text-align: center; width: 100%; height: 100%;">\n	<svg aria-hidden="true" focusable="false" xmlns="http://www.w3.org/2000/svg"\n		xmlns:xlink="http://www.w3.org/1999/xlink"\n		xmlns:svg="http://www.w3.org/2000/svg"\n		contentScriptType="text/ecmascript" display="block" width="100%" zoomAndPan="magnify"\n		contentStyleType="text/css" height="100%" preserveAspectRatio="none"\n		version="1.0">\n		'}),define("lib/css!widgets/com.smartbuilder.axon.widget.button/style",[],function(){}),define("text!widgets/com.smartbuilder.axon.widget.button/text.html",[],function(){return'</svg>\n<div id="text"></div>\n</div>'}),define("wgt/com.smartbuilder.axon.widget.button/s",["module","sb4core/sbobj","text!widgets/com.smartbuilder.axon.widget.button/svg.html","css!widgets/com.smartbuilder.axon.widget.button/style.css","text!widgets/com.smartbuilder.axon.widget.button/styles.xml","text!widgets/com.smartbuilder.axon.widget.button/text.html"],function(t,e,i,s,r,n){var o=t.config(),a=o.widgetsvc,l=a.getShortUIKey();
return $("#sb4Svg").append(r),$.widget(a.getFullUIKey(),$.sb4[e],{options:{},_create:function(){this.element.addClass(l),this._super(),this.applyProfileFlag||(this.clkCnt=0,this.lineWidth=this.options.lineWidth,this.disabled=this.options.disabled,this.textValue=this.options.text,this.textColorValue=this._util.parseColor(this.options.fontColor),this.normalColorValue=this.textColorValue,this.transparency=this.options.transparency,this.state=this.options.state),this.rootshapeId=_.uniqueId("rootshape_"),this.rootshapeJQueryId="#"+this.rootshapeId,this.rootshapeGroupId=this.rootshapeId+"_g",this.rootshapeShadowId=this.rootshapeId+"_shadow",this.attr={},this.options.underline&&(this.attr.textDecoration="underline"),this.scaleValue=1;var t=this.options._x-this.getPosOffset(),e=this.options._y-this.getPosOffset(),s=this.options._w+this.getSizeOffset(),r=this.options._h+this.getSizeOffset();if(this.element.css("left",t+"px"),this.element.css("top",e+"px"),this.element.css("width",s+"px"),this.element.css("height",r+"px"),this.shadowValue=this.options.shadow,void 0!=this.shadowValue&&"use"==this.shadowValue.shadow){this.shadowdiv=$("<div>").appendTo(this.element),this.shadowdiv.attr("class","notouch"),this.shadowdiv.html(this._util.createShadowSvg(this.rootshapeShadowId,this.rootshapeGroupId,this.shadowValue,s,r)),this.options.margin>0&&($("#"+this.rootshapeShadowId).attr("x",this.options.margin),$("#"+this.rootshapeShadowId).attr("y",this.options.margin)),this.shadowdiv.attr("style","position:absolute; text-align:center;");var n=this.getShadowBounds();this.setTextStyleValue(this.shadowdiv,n[1],n[0],n[2],n[3])}this.filllist=JSON.parse(this.options.filllist),this.stateFillValue=this.options.statefillvalue,this.toggle=this.options.toggle,this.fillMap={};var o=this;_.map(this.filllist,function(t,e){if("gradient"==t.typeValue){var i='<linearGradient x1="'+t.x1+'" y1="'+t.y1+'" x2="'+t.x2+'" y2="'+t.y2+'">';_.each(t.stopList,function(t,e){i+='<stop stop-color="rgb('+t.color.red+","+t.color.green+","+t.color.blue+')" offset="'+t.position+'%" stop-opacity="'+(1-t.opacity/100)+'"></stop>'}),i+=" </linearGradient>";var s=o._util.cacheFillSvg(i,"fill_",o.element);o.fillMap[e]="url("+s+")"}else o.fillMap[e]=o.stateFillValue[e]});for(var h=_.size(this.filllist);4>h;h++)this.fillMap[h+""]=this.fillMap[0];for(var c="",u="",d=0;4>d;d++){switch(d){case 0:u="normal";break;case 1:u="hover";break;case 2:u="down";break;case 3:u="disabled"}if(null!=this.options[u+"image"]&&this.options[u+"image"].length>0){var p=a.getWidgetAssetURI(this.options[u+"image"]);c+=' <pattern id="'+this.options._i+u+'img" patternUnits="userSpaceOnUse" width="'+this.options._w+'" height="'+this.options._h+'"> <image width="'+this.options._w+'" height="'+this.options._h+'" preserveAspectRatio="none" xlink:href="'+p+'" ></image></pattern>'}}var f="";if("use"==this.shadowValue.shadow&&(f=this.options.group.replace(/rootshape/g,this.rootshapeGroupId)),this.div=$(i+"<defs>"+c+f+"</defs>"+this.options.group.replace(/rootshape/g,this.rootshapeId)+"</svg></div>").appendTo(this.element),$(this.rootshapeJQueryId).attr("style",this.options.styleValue.replace("simg",this.options._i+"simg")),this.options.hand&&$(this.rootshapeJQueryId).css("cursor","pointer"),$(this.rootshapeJQueryId).css("stroke-width",this.lineWidth),this.setTextStyleValue(this.div,-this.options.margin,-this.options.margin,this.options._w+this.getSizeOffset()+2*this.options.margin,this.options._h+this.getSizeOffset()+2*this.options.margin),this.element.addClass("notouch"),this.element.find(this.rootshapeJQueryId).css("pointer-events","painted"),void 0!=this.options.icon&&this.options.icon.isUseIcon){var g=this.options.iconSvg;g&&this._util.cacheIconSvg(g,this.options.icon.imageName);var v=this.options.icon;(void 0==v.viewBox||0==v.viewBox.length)&&(v.viewBox="0 0 32 32"),this.icon=$('<svg focusable="false"viewBox="'+v.viewBox+'"><use id="icon" xlink:href="#'+v.imageName+'" fill="'+this._util.parseColor(v.color)+'"></use></svg>').appendTo(this.div),this.icon.attr("aria-hidden","true"),this.icon.attr("class","notouch");var m=0;switch(v.alignType){case 0:m=this.options.margin+this.getPosOffset()+10;break;case 1:m=(this.options._w+2*this.options.margin+this.getPosOffset()-v.buttonSize)/2;break;case 2:m=this.options._w+this.options.margin+this.getPosOffset()-v.buttonSize-10}this.icon.attr("style","position:absolute;top:"+(this.options._h+2*(this.options.margin+this.getPosOffset())-v.buttonSize)/2+"px;left:"+m+"px;width:"+v.buttonSize+"px;height:"+v.buttonSize+"px;"),this.icon.css("opacity",1-this.transparency/100)}this.textflow=$("<div>").appendTo(this.div),this.textflow.attr("class","notouch"),this.textflow.css("opacity",1-this.transparency/100),this.setTextStyleValue(this.textflow,this.options.margin,this.options.margin,s,r),this.replaceAttrValue(this.textflow,"overflow","hidden"),this.text=$("<div>").appendTo(this.textflow);var b=s-20;this.drawText("shapetext",this.textValue,this.text,this.options.font,this.options.align,this.textColorValue,b,void 0,this.attr,void 0),this.options.showtext?this.text.removeClass("notVisible"):this.text.addClass("notVisible");var x=this.text.width(),y=this.text.height(),w=this.text.get(0).getBoundingClientRect().width,S=this.text.get(0).getBoundingClientRect().height,T=(this.options._w-x)/2;switch(this.options.align){case 0:T=10;break;case 2:T=this.options._w-10-x}var E=(r-y)/2;y>r&&(E=0),this.setTextStyleValue(this.text,E,T,x,y),this.changeState(this.disabled?3:this.state),3!=this.state&&(this.normalShapeStyleValue=this.element.find(this.rootshapeJQueryId).attr("style"),this.normalTransformValue=this.element.find(this.rootshapeJQueryId).attr("transform"),this.normalClassValue=this.element.find(this.rootshapeJQueryId).attr("class")),this.element.find(this.rootshapeJQueryId).attr("transform","translate("+this.getTranslateValue()+","+this.getTranslateValue()+")"),this.applyProfileFlag&&this.fillcolor&&this.setFillColor(this.fillcolor),this.setScreenReaderElement(this.getTabElementMap())},getShadowBounds:function(){var t=1,e=this.options,i=this.options.margin-this.getSizeOffset(),s=this.shadowValue.size/100,r=4*this.shadowValue.radius,n=this.shadowValue.angle,o=this.shadowValue.distance,a=Math.cos(n*Math.PI/180)*o,l=Math.sin(n*Math.PI/180)*o,h=(e._w+2*i)*s+2*r,c=(e._h+2*i)*s+2*r,u=(e._w-h)/2,d=(e._h-c)/2,p=a+u,f=l+d;return[p*t,f*t,h*t,c*t]},clearFillColor:function(){this.element.find("#rootshape").css("fill","")},setFillImage:function(t){var e="normal";if(void 0!=this.filllist[t])switch(t){case 0:e="normal";break;case 1:e="hover";break;case 2:e="down";break;case 3:e="disabled"}this.element.find(this.rootshapeJQueryId).css("fill","url(#"+this.options._i+e+"img)")},setSolidFillColor:function(t){t=this._util.parseColor(t);var e=t.toHexString(255).substring(0,7);this.element.find(this.rootshapeJQueryId).css("fill",e)},setFillColor:function(t){3!=this.state&&(this.setSolidFillColor(t),this.fillcolor=this._util.getColorHexString(t),this._firePaintRequest({fillcolor:t}))},getFillColor:function(){return this.fillcolor?this.fillcolor:this._util.parseColor(this.element.find(this.rootshapeJQueryId).css("fill")).toHexString()},setLineColor:function(t){3!=this.state&&(t=this._util.parseColor(t),this._firePaintRequest({linecolor:t}))},getLineColor:function(){return this._util.parseColor(this.element.find(this.rootshapeJQueryId).css("stroke")).toHexString()},setTextColor:function(t){3!=this.state&&(t=this._util.parseColor(t),this._firePaintRequest({textcolor:t}))},getTextColor:function(){return this.textColorValue},setLineWeight:function(t){3!=this.state&&(this.lineWidth=this._util.parseInt(t),this._firePaintRequest({linewidth:this.lineWidth}))},getLineWeight:function(){return this._util.parseInt(this.lineWidth)},setText:function(t){3!=this.state&&(t=this._util.parseString(t),this.textValue=t,this._firePaintRequest({text:t}))},getText:function(){return this.textValue},getScale:function(){return this.scaleValue},setScale:function(t){if(t=this._util.parseNumber(t),t>0){var e=(this.getPosOffset()+this.options.margin)*t,i=this.options._x-this.getPosOffset()+Math.floor((1-t)*this.options._w/2),s=this.options._y-this.getPosOffset()+Math.floor((1-t)*this.options._h/2),r=(this.options._w+this.getSizeOffset())*t,n=(this.options._h+this.getSizeOffset())*t;this.element.css("left",i+"px"),this.element.css("top",s+"px"),this.element.css("width",r+"px"),this.element.css("height",n+"px"),this.scaleValue=t,this.setTextStyleValue(this.div,-this.options.margin*t,-this.options.margin*t,r+2*this.options.margin*t,n+2*this.options.margin*t),this.setTextStyleValue(this.textflow,e-this.getPosOffset()*t,e-this.getPosOffset()*t,r,n);var o,a,l=r-20;if(1==this.options.align&&(l=r),this.textValue==this.options.text)this.drawText("shapetext",this.options.text,this.text,this.options.font,this.options.align,this.textColorValue,l,t,this.attr,void 0),o=this.text.width(),a=this.text.height();else{this.setTextStyleValue(this.text,0,0,r-20,n);var h=this.options.font.fontSize,c=h*t;this.options.font.fontSize=c,this.drawText("shapetext",this.textValue,this.text,this.options.font,this.options.align,this.textColorValue,-1*l),this.options.font.fontSize=h,o=this.text.css("width").replace("px","")+1,a=this.text.css("height").replace("px",""),this.options.underline&&this.replaceAttrValue(this.text,"text-decoration","underline")}o>r&&(o=r),a>n&&(a=n);var u=(r-o)/2;switch(this.options.align){case 0:u=10;break;case 2:u=r-10-o}this.setTextStyleValue(this.text,(n-a)/2,u,o,a),this.element.find(this.rootshapeJQueryId).attr("transform","translate("+this.getTranslateValue()+","+this.getTranslateValue()+")")}},getTransparency:function(){return this.transparency},setTransparency:function(t){t=this._util.parseNumber(t),this._firePaintRequest({transparency:t})},getEnabled:function(){return!this.disabled},setEnabled:function(t){t=this._util.parseBoolean(t),this.disabled=!t,this._firePaintRequest({enabled:t})},getSelected:function(){return this.toggle&&2==this.state?!0:!1},setSelected:function(t){3!=this.state&&(t=this._util.parseBoolean(t),this._firePaintRequest({selected:t}))},changeState:function(t){if(this.state=t,this.removeAttrValue(this.element.find(this.rootshapeJQueryId),"filter"),this.removeAttrValue(this.element.find("#icon"),"filter"),this.element.find(this.rootshapeJQueryId).attr("transform",this.normalTransformValue),this.element.find(this.rootshapeJQueryId).attr("class",this.normalClassValue),this.element.find(this.rootshapeJQueryId).css("cursor","pointer"),0==t?(this.element.find("#icon").attr("fill",this._util.parseColor(this.options.icon.color)),this.textColorValue=this.normalColorValue):1==t?this.options.hoverDefaultColor?(this.element.find("#icon").attr("fill",this._util.parseColor(this.options.icon.color)),this.textColorValue=this.normalColorValue):(this.element.find("#icon").attr("fill",this._util.parseColor(this.options.hoverIconColor)),this.textColorValue=this._util.parseColor(this.options.hoverFontColor)):2==t?this.options.downDefaultColor?(this.element.find("#icon").attr("fill",this._util.parseColor(this.options.icon.color)),this.textColorValue=this.normalColorValue):(this.element.find("#icon").attr("fill",this._util.parseColor(this.options.downIconColor)),this.textColorValue=this._util.parseColor(this.options.downFontColor)):3==t&&(this.options.disabledDefaultColor||(this.element.find("#icon").attr("fill",this._util.parseColor(this.options.disabledIconColor)),this.textColorValue=this._util.parseColor(this.options.disabledFontColor))),void 0!=this.filllist[t])this.element.find(this.rootshapeJQueryId).attr("style",this.normalShapeStyleValue),this.changeFillType(this.filllist[t].typeValue,this.stateFillValue[t],t);else switch(this.changeFillType(this.filllist[0].typeValue,this.stateFillValue[0],t),t){case 0:break;case 1:var e="",i=null;if("gradient"==this.filllist[0].typeValue&&this.filllist[0].stopList.length>1)this.replaceAttrValue(this.element.find(this.rootshapeJQueryId),"filter","url(#buttondarksvg)");else{if("gradient"==this.filllist[0].typeValue&&1==this.filllist[0].stopList.length){var s=this.checkWhite(this.filllist[0].stopList[0].color,t,!0);e=s}else if("solid"==this.filllist[0].typeValue){var s=this.filllist[0].solidColor;s||(s=this.getFillColor()),s=this.checkWhite(s,t,!0),e=s}else if("white"==this.filllist[0].typeValue){var r=this.getLineWeight(),s=this.getLineColor();0==r&&(s=this.normalColorValue),s=this.checkWhite(s,t,!0),e=s}else"none"==this.filllist[0].typeValue&&this.options.hoverDefaultColor&&(this.textColorValue=this.checkWhite(this.normalColorValue,t,!0));0!=e.length?this.element.find(this.rootshapeJQueryId).css("fill",e):this.element.find(this.rootshapeJQueryId).css("filter","url(#buttondarksvg)")}break;case 2:if("gradient"==this.filllist[0].typeValue&&this.filllist[0].stopList.length>1);else{var n="";if("gradient"==this.filllist[0].typeValue&&1==this.filllist[0].stopList.length){var s=this.checkWhite(this.filllist[0].stopList[0].color,t,!0);n=s}else if("solid"==this.filllist[0].typeValue){var s=this.filllist[0].solidColor;s||(s=this.getFillColor()),s=this.checkWhite(s,t,!0),n=s}else if("white"==this.filllist[0].typeValue){var r=this.getLineWeight(),s=this.getLineColor();0==r&&(s=this.normalColorValue),s=this.checkWhite(s,t,!0),n=s}else"none"==this.filllist[0].typeValue&&this.options.hoverDefaultColor&&(this.textColorValue=this.checkWhite(this.normalColorValue,t,!0));0!=n.length?this.element.find(this.rootshapeJQueryId).css("fill",n):this.element.find(this.rootshapeJQueryId).css("filter","url(#buttonlightsvg)")}break;case 3:this.replaceAttrValue(this.element.find(this.rootshapeJQueryId),"filter","url(#buttongarysvg)"),this.options.disabledDefaultColor&&(this.replaceAttrValue(this.element.find("#icon"),"filter","url(#buttongarysvg)"),this.textColorValue=this.colorLuminance(this.normalColorValue,-.05,!0)),this.element.find(this.rootshapeJQueryId).css("cursor","")}var o=this.scaleValue,a=(this.options._w+this.getSizeOffset())*o,l=(this.options._h+this.getSizeOffset())*o,h=a-20;if(this.textValue==this.options.text)this.drawText("shapetext",this.options.text,this.text,this.options.font,this.options.align,this.textColorValue,h,o,this.attr,void 0),htmlWidth=this.text.width(),htmlHeight=this.text.height();else{this.setTextStyleValue(this.text,0,0,a-20,l);var c=this.options.font.fontSize,u=c*o;this.options.font.fontSize=u,this.drawText("shapetext",this.textValue,this.text,this.options.font,this.options.align,this.textColorValue,-1*h),this.options.font.fontSize=c,htmlWidth=this.text.css("width").replace("px","")+1,htmlHeight=this.text.css("height").replace("px",""),this.options.underline&&this.replaceAttrValue(this.text,"text-decoration","underline")}var d=(a-htmlWidth)/2;switch(this.options.align){case 0:d=10;break;case 2:d=a-10-htmlWidth}var p=(l-htmlHeight)/2;htmlHeight>l&&(p=0),this.setTextStyleValue(this.text,p,d,htmlWidth,htmlHeight),this.element.find(this.rootshapeJQueryId).attr("transform","translate("+this.getTranslateValue()+","+this.getTranslateValue()+")")},checkWhite:function(t,e,i){if(1==e){var s=jQuery.Color(t).lightness();s+=.3*(1-s),s>1&&(s=1),t=jQuery.Color(t).lightness(s)}else if(2==e){var s=jQuery.Color(t).lightness();s-=.3*s,0>s&&(s=0),t=jQuery.Color(t).lightness(s)}return t},changeWhiteFillType:function(t,e){switch(this.textColorValue=this.textColorValue,e){case 0:this.setSolidFillColor(t),this.removeAttrValue(this.element.find(this.rootshapeJQueryId),"filter"),this.removeAttrValue(this.element.find("#icon"),"filter");break;case 1:this.setSolidFillColor(this.options.line),this.replaceAttrValue(this.element.find(this.rootshapeJQueryId),"filter","url(#buttonlightsvg)"),this.removeAttrValue(this.element.find("#icon"),"filter");break;case 2:this.setSolidFillColor(this.options.line),this.replaceAttrValue(this.element.find(this.rootshapeJQueryId),"filter","url(#buttondarksvg)"),this.removeAttrValue(this.element.find("#icon"),"filter");break;case 3:this.setSolidFillColor(t),this.replaceAttrValue(this.element.find(this.rootshapeJQueryId),"filter","url(#buttongarysvg)"),this.options.disabledDefaultColor&&(this.replaceAttrValue(this.element.find("#icon"),"filter","url(#buttongarysvg)"),this.textColorValue=this.colorLuminance(this.normalColorValue,-.05,!0));break;default:this.setSolidFillColor(t),this.removeAttrValue(this.element.find(this.rootshapeJQueryId),"filter"),this.removeAttrValue(this.element.find("#icon"),"filter")}},changeFillType:function(t,e,i){switch(this.clearFillColor(),t){case"gradient":this.element.find(this.rootshapeJQueryId).css("fill",this.fillMap[i]);break;case"white":if(e.split(" | ").length>1){var s=e.split(" | ")[0],r=e.split(" | ")[1];this.setSolidFillColor(r)}else this.setSolidFillColor(e);break;case"solid":if(e.split(" | ").length>1){var s=e.split(" | ")[0],n=e.split(" | ")[1];this.setSolidFillColor(n)}else this.setSolidFillColor(e);break;case"image":if(e.split(" | ").length>1)var s=e.split(" | ")[0],n=e.split(" | ")[1];this.setFillImage(i);break;case"none":this.element.find(this.rootshapeJQueryId).css("fill","url(#sb4FillNone)")}},hexToRgb:function(t){return t=this._util.parseColor(t),[t._rgba[0],t._rgba[1],t._rgba[2]]},colorLuminance:function(t,e,i){if(t=this._util.parseColor(t),i){var s=this.hexToRgb(t),r=(s[0]+s[1]+s[2])/3;if(t=this.rgbToHex(r,r,r),0==r){var n="#808080";return n}}t=String(t).replace(/[^0-9a-f]/gi,""),t.length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),e=e||0;var n="#",o,a;for(a=0;3>a;a++)o=parseInt(t.substr(2*a,2),16),o=Math.round(Math.min(Math.max(0,o+o*e),255)).toString(16),n+=("00"+o).substr(o.length);return n},componentToHex:function(t){var e=t.toString(16);return 1==e.length?"0"+e:e},rgbToHex:function(t,e,i){return"#"+this.componentToHex(t)+this.componentToHex(e)+this.componentToHex(i)},setTextStyleValue:function(t,e,i,s,r){var n="center";switch(this.options.align){case 0:n="left";break;case 1:n="center";break;case 2:n="right"}this.replaceAttrValue(t,"position","absolute"),this.removeAttrValue(t,"text-align"),null!=s&&this.replaceAttrValue(t,"width",s),null!=r&&this.replaceAttrValue(t,"height",r),null!=e&&this.replaceAttrValue(t,"top",e),null!=i&&this.replaceAttrValue(t,"left",i),this.replaceAttrValue(t,"text-align",n)},replaceAttrValue:function(t,e,i){if(!(t.length<1)){i=this._util.parseString(i);var s=t.attr("style");if(void 0==s&&(t.attr("style","position:absolute;"),s=t.attr("style")),-1==s.search(e+":absolute"))if(-1==s.search(e))s+="top"==e||"left"==e||"width"==e||"height"==e?e+":"+i+"px;":e+":"+i+";",t.attr("style",s);else{var r=s.substring(0,s.search(e)),n=s.substring(s.indexOf(";",s.search(e))+1,s.length+1);"top"==e||"left"==e||"width"==e||"height"==e?t.attr("style",r+e+":"+i+"px;"+n):t.attr("style",r+e+":"+i+";"+n)}}},removeAttrValue:function(t,e){var i=t.attr("style");if(!(t.length<1)&&(void 0==i&&(t.attr("style","position:absolute;"),i=t.attr("style")),-1!=i.search(e))){var s=i.substring(0,i.search(e)),r=i.substring(i.indexOf(";",i.search(e))+1,i.length+1);t.attr("style",s+r)}},highlight:function(t){var e=this.element.find(this.rootshapeJQueryId),i=this.element.find("#highlightshape");t?0==i.length&&(i=e.clone().appendTo(e.parent()),i.attr("id","highlightshape"),i.css("fill","#c77405"),i.css("opacity","0.5"),i.attr("class","notouch"),i.css("pointer-events","")):i.length>0&&i.remove()},getFxElement:function(){return this.element},_refreshFxElement:function(){for(var t=this.getFxElement().find("use"),e=0;e<t.length;e++){var i=t.eq(e);i.attr("xlink:href",i.attr("xlink:href"))}},_paintWidgetHide:function(t){this.changeState(this.disabled?3:0),this._super(t)},_paintWidgetShow:function(t){if(_.has(t,"enabled")&&(t.enabled?(this.disabled=!1,this.changeState(0)):(this.disabled=!0,this.changeState(3)),this.setScreenReaderElement(this.getTabElementMap())),_.has(t,"selected")&&this.toggle&&this.changeState(t.selected?2:0),_.has(t,"fillcolor")&&(this.filllist[0].typeValue="solid",this.stateFillValue[0]=-1!=this.stateFillValue[0].indexOf("style")?-1!=this.stateFillValue[0].indexOf("|")?this.stateFillValue[0].split("|")[0]+"| "+t.fillcolor:this.stateFillValue[0]+" | "+t.fillcolor:e),_.has(t,"linecolor")){var e=t.linecolor.toHexString(255).substring(0,7);this.element.find(this.rootshapeJQueryId).css("stroke",e)}if(_.has(t,"linewidth")){this.lineWidth=t.linewidth,this.element.find(this.rootshapeJQueryId).css("stroke-width",this.lineWidth);var i=$(this.rootshapeJQueryId).find("rect");if(0!=i.length){var s=i.eq(0);0==this.lineWidth?(s.attr("width",this.options._w),s.attr("height",this.options._w)):(s.attr("width",this.options._w-1),s.attr("height",this.options._w-1))}this.setScale(this.scaleValue)}if(_.has(t,"text")&&3!=this.state&&(this.text.empty(),this.textValue=t.text,this.setScale(this.scaleValue),this.setScreenReaderElement(this.getTabElementMap())),_.has(t,"textcolor")&&0==this.state){var e=t.textcolor.toHexString(255).substring(0,7);this.textColorValue=e,this.normalColorValue=this.textColorValue,this.setScale(this.scaleValue)}if(_.has(t,"transparency")){this.transparency=t.transparency;var r=1-this.transparency/100;this.textflow.css("opacity",r),this.setStyleTransparency(this.rootshapeId,r),this.setStyleTransparency("shadow",r),this.setStyleTransparency("icon",r)}3!=this.state&&(this.normalShapeStyleValue=this.element.find(this.rootshapeJQueryId).attr("style"),this.normalTransformValue=this.element.find(this.rootshapeJQueryId).attr("transform")),this._super(t)},_init:function(){this._debug("init called");var t=this;this.element.find(this.rootshapeJQueryId).click(function(){3!=t.state&&(void 0!=t.options.link&&""!=t.options.link&&t.handleLinkData(t.options.link),t.clkCnt++,t.fireEvent("onClick"))}),this.element.find(this.rootshapeJQueryId).on("vmousedown",function(){3!=t.state&&(t.toggle?(t.changeState(2==t.state?1:2),t.setScreenReaderElement(t.getTabElementMap())):t.changeState(2))}),this.element.find(this.rootshapeJQueryId).on("vmouseup",function(){3!=t.state&&(t.toggle||t.changeState(1))}),this.element.find(this.rootshapeJQueryId).dblclick(function(){3!=t.state&&t.fireEvent("onDoubleClick")}),this.element.find(this.rootshapeJQueryId).on("vmouseover",function(){3!=t.state&&(t.toggle?2!=t.state&&t.changeState(1):t.changeState(1),t.fireEvent("onRollover"))}),this.element.find(this.rootshapeJQueryId).on("vmouseout",function(){3!=t.state&&(t.toggle?2!=t.state&&t.changeState(0):t.changeState(0),t.fireEvent("onRollout"))})},getTabElementMap:function(){var t={};return t.texts=this.getTabElementLabel(),t.tabElements=this.createTabElement(),t},getTabElementLabel:function(){var t=[];return t.push(_.isEmpty(this.textValue)?this.options._n:this.textValue),t},changeDeviceButtonToggle:function(){var t=$("button",this.element),e=t.eq(0).attr("aria-pressed");e="false"==e?!0:!1,t.eq(0).attr("aria-pressed",e)},createTabElement:function(){var t=this.getScreenReaderTabElement();if(t){var e=t[0];return this.disabled?e.attr("disabled","disabled"):e.removeAttr("disabled"),this.toggle&&(2==this.state?e.attr("aria-pressed",!0):e.attr("aria-pressed",!1)),t}var i=[];this.tabDiv?this.tabDiv.empty():(this.tabDiv=$("<div>").prependTo(this.element),this.tabDiv.css("width","100%"),this.tabDiv.css("height","100%"),this.tabDiv.addClass("notouch"));var e=$("<button>").appendTo(this.tabDiv);this.disabled&&e.attr("disabled","disabled"),this.toggle&&(2==this.state?e.attr("aria-pressed",!0):e.attr("aria-pressed",!1));var s=this;return e.click(function(){3!=s.state&&(void 0!=s.options.link&&""!=s.options.link&&s.handleLinkData(s.options.link),s.toggle&&(s.changeState(2==s.state?1:2),s.setScreenReaderElement(s.getTabElementMap())),s.clkCnt++,s.fireEvent("onClick"))}),e.dblclick(function(){3!=s.state&&s.fireEvent("onDoubleClick")}),e.focus(function(t){s.fireEvent("onFocus")}),i.push(e),i},focus:function(){var t=this.getScreenReaderTabElement();if(t&&0!=t.length){var e=t[0];this.doSetFocus(e)}},getXAPIResult:function(){var t=this._super();return t.response=this.clkCnt+"",t},getPos:function(){var t=this._super();return t.left=t.left+this.getPosOffset(),t.top=t.top+this.getPosOffset(),t},setPos:function(t){var e=this._util.parsePosition(t),i={};i.left=Math.round(e[0])-this.getPosOffset(),i.top=Math.round(e[1])-this.getPosOffset(),this._super(i)},setStyleTransparency:function(t,e){this.element.find("#"+t).css("opacity",e)},_getLimitPos:function(){var t=this.getFxElement(),e;if(null!=t&&(e=null!=this.shadowdiv?this.shadowdiv:this.div),null!=e){var i=Number(e.css("left").replace("px","")),s=Number(e.css("top").replace("px","")),r=Number(e.css("left").replace("px",""))+Number(e.css("width").replace("px","")),n=Number(e.css("top").replace("px",""))+Number(e.css("height").replace("px","")),o=[];o.push(i),o.push(s),o.push(r),o.push(n),o=this._getMaxBounds(o,e);var a=[];return a.push(o[0]),a.push(o[1]),a}var a=[];return a.push(this.getPos().left),a.push(this.getPos().top),a},_getRealBounds:function(){var t=this.getFxElement(),e;if(null!=t&&(e=null!=this.shadowdiv?this.shadowdiv:this.div),null!=e){var i=Number(e.css("left").replace("px","")),s=Number(e.css("top").replace("px","")),r=Number(e.css("left").replace("px",""))+Number(e.css("width").replace("px","")),n=Number(e.css("top").replace("px",""))+Number(e.css("height").replace("px","")),o=[];o.push(i),o.push(s),o.push(r),o.push(n),o=this._getMaxBounds(o,e);var a=Number(t.css("left").replace("px",""))+o[0],l=Number(t.css("top").replace("px",""))+o[1],h=o[2]-o[0],c=o[3]-o[1],u=[];return u.push(a),u.push(l),u.push(h),u.push(c),u}var u=[];return u.push(this.getPos().left),u.push(this.getPos().top),u.push(this.getSize()[0]),u.push(this.getSize()[1]),u},getPosOffset:function(){return Math.floor(this.lineWidth/2)},getSizeOffset:function(){return 2*this.getPosOffset()},getTranslateValue:function(){return this.options.margin+this.lineWidth/2}}),a.getShortUIKey()}),define("sb4core/init-post",["sb4core/loplayer","image","sb4core/syscheck","sb4core/linkhandler","wgt/com.smartbuilder.axon.widget.frame/s","wgt/com.smartbuilder.axon.widget.slideset/s","wgt/com.smartbuilder.axon.widget.slide/s","wgt/com.smartbuilder.axon.widget.shape/s","wgt/com.smartbuilder.axon.widget.text.text/s","wgt/com.smartbuilder.axon.widget.text.richtext/s","wgt/com.smartbuilder.axon.widget.image/s","wgt/com.smartbuilder.axon.widget.button/s"],function(t,e,i){function s(t,e){function i(t,e){var i=[];for(k in t)i.push(k);return i.join(e)}if(!(t instanceof Date))return"";var s={M:t.getMonth()+1,d:t.getDate(),D:t.getDate(),h:t.getHours(),m:t.getMinutes(),s:t.getSeconds(),y:t.getFullYear(),Y:t.getFullYear()},r=i(s,"+|")+"+",n=new RegExp(r,"g");return e=e.replace(n,function(t){var e=s[t.slice(-1)],i=t.length;if(t.indexOf("y")<0&&t.indexOf("Y")<0)var i=Math.max(t.length,e.toString().length);var r=e.toString().length<t.length?"0".repeat(i):"";return(r+e).slice(-i)})}return SB4API.showLoading=function(){"none"==$("#fullscreen").css("display")&&$("#fullscreen").show()},SB4API.hideLoading=function(){"none"!=$("#fullscreen").css("display")&&$("#fullscreen").hide()},createjs.TagRequest.prototype._handleTimeout=function(){this._clean(),this.dispatchEvent(new createjs.Event("error"))},null==SB4API.functions&&(SB4API.functions={}),SB4API.functions.getTime=function(t,e){var i=parseInt(e);!isNaN(i)&&null!=e&&e.indexOf("Z")>0&&e.indexOf("T")>0&&(i=Date.parse(e)),isNaN(i)&&(i=(new Date).getTime());var r=new Date;return r.setTime(i),""==t||null==t?i:s(r,t)},SB4API.globalEventListenerMap={},SB4API.fireGlobalEvent=function(t,e){if(SB4API.topSB4EngienContext){var i=SB4API.topSB4EngienContext.get("[frame]"),s="flow";t="evt://"+t;var r={};r.broadcast=!1,r["[evtval]"]=e,r["[evt_ext_lesson]"]=!0;for(var n=0;n<i.engine.subEngines.length;n++)i.engine.subEngines[n].addEvent(s,t,r)}},SB4API.getGlobalVariable=function(t){var e=SB4API.topSB4EngienContext.get("[frame]");return e.engine.objctx.get("global "+t)},SB4API.setGlobalVariable=function(t,e){var i=SB4API.topSB4EngienContext.get("[frame]");return i.engine.objctx.add("global "+t,e)},SB4API.addGlobalEventListener=function(t,e){var i="flow.evt://"+t,s=SB4API.globalEventListenerMap[i];null==s?(s=[],s.push(e),SB4API.globalEventListenerMap[i]=s):s.push(e)},SB4API.removeGlobalEventListener=function(t,e){var i="flow.evt://"+t,s=SB4API.globalEventListenerMap[i];null!=s&&(SB4API.globalEventListenerMap[i]=_.without(s,e))},SB4API.onGlobalEventListener=function(t,e){var i=SB4API.globalEventListenerMap[t];i&&$.each(i,function(t,i){_.isFunction(i)&&i(e)})},t}),function(t){var e=document,i="appendChild",s="styleSheet",r=e.createElement("style");r.type="text/css",e.getElementsByTagName("head")[0][i](r),r[s]?r[s].cssText=t:r[i](e.createTextNode(t))}("div.com_smartbuilder_axon_widget_shape{}div.com_smartbuilder_axon_widget_text_richtext div p{margin-top:0;margin-bottom:0;}div.com_smartbuilder_axon_widget_text_richtext div ul{margin-top:0;margin-bottom:0;list-style-type:disc;}div.com_smartbuilder_axon_widget_image{width:auto;height:auto;}div.com_smartbuilder_axon_widget_button{}div.com_smartbuilder_axon_widget_button button{width:100%;height:100%;border:none;background-color:rgba(255,255,255,0);}div.com_smartbuilder_axon_widget_button button:focus{width:100%;height:100%;outline:solid 2px blue;#outline-offset:1px;background-color:rgba(255,255,0,0);}");